msgid ""
msgstr ""
"Language: ja_JP\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"
"X-Generator: jekyll-l10n\n"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid "ArC migrates to Gizmo 2"
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid "ArC got rewritten from Gizmo 1 to Gizmo 2. What does that mean for you?"
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid ""
"ArC is Quarkus's implementation of CDI Lite.\n"
"Gizmo is a simplified bytecode generation library.\n"
"What do they have in common?"
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid ""
"ArC has been using Gizmo 1 since approximately forever, but now that Gizmo 2 is shaping up, some Quarkus components have started migrating to it.\n"
"I have started rewriting ArC to Gizmo 2 a few months ago, when we felt like Gizmo 2 starts looking reasonable and some real-world experience was needed."
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid "This rewrite took several months, mostly because Gizmo 2 is a complete rewrite and rearchitecture of Gizmo 1 and ArC is a heavy user, but also because during the ArC rewrite, I found some Gizmo 2 issues and there were several back and forths."
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid ""
"To illustrate, I'll first go over the differences in Gizmo 1 and 2, and then detail how that affects ArC users.\n"
"Spoiler alert: there's no change that would affect Quarkus applications.\n"
"All changes are in the APIs that are only exposed to extensions (at build time)."
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid "Gizmo 1 vs Gizmo 2"
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid ""
"First off, Gizmo 1 is based on ASM and Gizmo 2 is based on the ClassFile API (not the one present in the JDK since link:https://openjdk.org/jeps/484[version 24], but the link:https://github.com/dmlloyd/jdk-classfile-backport[fork] maintained by David Lloyd, which supports Java 17).\n"
"The ClassFile API itself is very different to ASM, and since the ClassFile API structure guided the Gizmo 2 API structure, that is also very different."
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid "To quickly compare, this is how you generate a \"Hello, World!\" program with Gizmo 1:"
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid "And this is how you generate the same program with Gizmo 2:"
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid ""
"There are obvious surface-level differences in the API structure, but there are also deeper differences.\n"
"I'll mention one here just as an example: the way Gizmo represents and maintains values has changed significantly."
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid ""
"Gizmo 1 has the venerable `ResultHandle` class, which is almost always a local variable (even though the API doesn't let you assign to it; you have to use `AssignableResultHandle` for that).\n"
"This means you don't really have to care about order in which you produce values or about using them multiple times -- everything just works.\n"
"There's obvious overhead though: for each use of the value, it needs to be loaded from the variable to the stack."
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid "On the other hand, Gizmo 2 represents values as ``Expr``s, which are _not_ local variables:"
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid ""
"An `Expr` is a value that is, at the time of its creation, on top of the stack, nothing more.\n"
"This means the order of producing values suddenly matters and they may not be reused!\n"
"To create a local variable (`LocalVar`) out of an expression, you have to explicitly call a method:"
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid ""
"There are a lot more concepts not shown in these examples, which you can read about in the documentation.\n"
"The Gizmo 1 documentation is available at https://github.com/quarkusio/gizmo/blob/1.x/USAGE.adoc, while the Gizmo 2 documentation (not yet complete) is available at https://github.com/quarkusio/gizmo/blob/main/MANUAL.adoc."
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
#, fuzzy
msgid "ArC"
msgstr "アーク"

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid ""
"Back to ArC.\n"
"Today, all bytecode generation in ArC is based on Gizmo 2 (if you want the gory details, look at https://github.com/quarkusio/quarkus/pull/50708[this pull request]), and it's going to be released in Quarkus 3.30."
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid ""
"ArC has several public APIs that expose Gizmo types.\n"
"This means that the rewrite to Gizmo 2 includes breaking changes.\n"
"These are unlikely to impact users -- in fact, the number of affected places in the Quarkus core repository is surprisingly small.\n"
"However, in the interest of transparency, here's a full list of API breakages:"
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid "`BeanConfiguratorBase`: methods"
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid "were changed to"
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid "`ObserverConfigurator`: method"
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid "was changed to"
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid "`ContextConfigurator`: method"
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid "`BeanProcessor.Builder`: method"
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid ""
"Noone is expected to be affected by the last change, because that is in the ArC integration API, which should only be used by the Quarkus ArC extension.\n"
"The other changes are in APIs that could legitimately be used:"
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid "synthetic beans"
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid "synthetic observers"
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid "custom contexts"
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid ""
"As you see, all these changes are similar.\n"
"The Gizmo 1 variant takes a `Consumer<MethodCreator>` (or, in one case, a `Function<MethodCreator, ResultHandle>`).\n"
"The `MethodCreator` must be used to create the bytecode of the corresponding method:"
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid "`BeanConfiguratorBase.creator()`: create an instance of the synthetic bean"
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid "`BeanConfiguratorBase.destroyer()`: destroy an instance of the synthetic bean"
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid "`BeanConfiguratorBase.checkActive()`: check if the synthetic bean is currently active (niche use case, most likely unused outside of the core Quarkus repository)"
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid "`ObserverConfigurator.notify()`: notify the synthetic observer"
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid "`ContextConfigurator.creator()`: create a context object of the custom context"
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid ""
"The Gizmo 2 variants no longer take a Gizmo object.\n"
"Instead, they take an ArC interface that provides access to all the necessary Gizmo objects -- because more than 1 is necessary."
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid ""
"As mentioned above, most extensions should not be affected.\n"
"This is because higher-level APIs exist that do not expose bytecode generation; either they use classes that implement interfaces, or they accept results of recorder methods.\n"
"These higher-level APIs didn't change at all.\n"
"However, using the lower-level APIs is still permitted, so let's take a look at how we'd migrate a simple synthetic bean creation function from Gizmo 1 to Gizmo 2."
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid "Here's a simple synthetic bean registered using `SyntheticBeanBuildItem`:"
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid "The `Consumer` here accepts a `MethodCreator` that provides direct access to its parameters as well as to the class, from which one can read the fields."
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid "After the rewrite to Gizmo 2, the code looks like:"
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid ""
"The `Consumer` accepts `CreateGeneration` that provides access to the `BlockCreator` to generate bytecode (`createMethod()`) and a number of necessary variables.\n"
"In this example, we use the `paramsMap()` method to acccess the parameter map."
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid "The other APIs have changed in the same manner: instead of `MethodCreator`, the `Consumer` accepts `*Generation` which provides access to the `BlockCreator` and the necessary variables."
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid ""
"One might ask: why does the new API provide access to a `BlockCreator` and not to a `MethodCreator`, which clearly still exists in Gizmo 2?\n"
"And it would be a good question.\n"
"The answer, as it turns out, is efficiency.\n"
"The previous API that did provide access to a `MethodCreator` required generating a whole new method that would only host the user-generated code.\n"
"The new API that _doesn't_ provide access to a `MethodCreator` allows embedding the user-generated code into a method that contains other, ArC-generated code.\n"
"Thus, the number of methods in the generated classes is smaller and the generated code is more compact."
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid "Conclusion"
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid ""
"Gizmo 2 is an evolution (some might say _revolution_) of Gizmo 1, the simplified bytecode generation library used by all of Quarkus.\n"
"ArC is a heavy user of Gizmo and it just recently migrated to Gizmo 2.\n"
"There are some breaking changes that might affect Quarkus extensions (not applications)."
msgstr ""

#: _posts/2025-11-03-arc-migrates-to-gizmo2.adoc
msgid ""
"In this post, we reviewed the API breakages and showed a simple migration scenario.\n"
"Hopefully, your extensions are not affected, because they use the higher-level APIs, but if they are, you'll need to migrate as well.\n"
"Then, your extension will only be compatible with Quarkus 3.30 and above; it will stop working with previous versions.\n"
"Plan accordingly."
msgstr ""
