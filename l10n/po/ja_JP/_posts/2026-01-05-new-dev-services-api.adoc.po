msgid ""
msgstr ""
"Language: ja_JP\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"
"X-Generator: jekyll-l10n\n"

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "A Better Way of Creating Dev Services"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "A new Dev Services API in Quarkus 3.25 fixes port conflicts and excessive resource usage in test suites, while providing a simpler programming model for extension authors."
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid ""
"In Quarkus 3.25, a new API for creating https://quarkus.io/guides/dev-services[Dev Services] was introduced.\n"
"This new model fixes a problem where all Dev Services for all tests would start in the JUnit discovery phase, potentially causing port conflicts, configuration cross-talk, and excessive resource usage.\n"
"This issue was a side effect of the link:/blog/test-classloading-rewrite[test classloading rewrite] in Quarkus 3.22.\n"
"As well as reducing resource consumption, we also hope the API makes it simpler for extension authors to create Dev Services, and moves some of the heavy lifting around managing discovery and container re-use to Quarkus core."
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "What changes for users?"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "No action is needed for users."
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "If you have test suites which use multiple profiles or test resources, you should find that you no longer see duplicate containers active at the same time. The containers should launch one after the other."
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid ""
"However, this depends on the extension, as each needs to be converted to the new model. The Redis, Lambda, Narayana, and Kafka extensions have been converted so far. You can track progress on conversions by following the sub-issues in https://github.com/quarkusio/quarkus/issues/45785[#45785].\n"
"As a workaround, if extensions you depend on have not yet been converted, splitting conflicting tests into separate projects should fix symptoms."
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "As always, if you spot issues or oddities, please let us know on https://quarkusio.zulipchat.com/[zulip] or https://github.com/quarkusio/quarkus/issues[raise an issue]."
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "Background"
msgstr "背景"

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "All dev services using the old API start in the JUnit discovery phase (as of Quarkus 3.22). This is because they are started during https://quarkus.io/guides/reaugmentation#what-is-augmentation[the augmentation phase], along with bytecode manipulation and other application initialization steps. When the testing design changed, all augmentation happened at the beginning of the test run, during the JUnit discovery phase. This means all Dev Services also start at the beginning of the test run. If several test classes with different Dev Service configuration are augmented before any tests are run, multiple differently-configured Dev Services may be running at the same time."
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "In the new model, Dev Services are started after the augmentation but before the application's actual launch."
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "What changes for extension owners?"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "The new Dev Services model maintains backwards compatibility with the old one, so extension owners don't _need_ to do anything. In fact, for the first few releases of the new model, we recommended extension owners definitely did not do anything, while the API stabilised."
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "Now is a good time for extensions to start moving, so they can take advantage of the more concise programming model and reduced resource usage. This will also resolve some deprecation warnings triggered by the old model. Be aware that extensions which have moved to the new API will no longer work with old versions of Quarkus. 3.25 would be the minimum possible version, and we would recommend setting 3.27 or 3.28 as the minimum version (more on that below)."
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "Principles of the new design"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "Dev Services are prepped at build time, but the actual `start()` call happens post-build, pre-runtime"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "Do not use static variables in the extension processor"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "Dev Service creation is handled by a builder (and there are different builders for connecting to an externally-managed instance and creating a new service)"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "Config which is only known after the service is started can be passed in using a `configProvider()`"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "Migration checklist"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "Update your extension's build file so it depends on both the `quarkus-devservices` runtime and `quarkus-devservices-deployment` modules (but see link:#version-dilemma[the discussion of choosing a Quarkus version] for implications of this)."
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "Provide link:#startable[an implementation] of `io.quarkus.deployment.builditem.Startable` which has methods for starting and stopping the new service. For container-based services, extending `GenericContainer` and implementing `Startable` is a good pattern."
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "Instead of directly constructing a `DevServicesResultBuildItem`, switch to use the `discovered()` and `owned()` link:#the-builder[builders] on `DevServicesResultBuildItem`"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "It is not necessary to call all methods on the builder, but either for owned services, `startable()`, `serviceName()`, `configProvider()`, and link:#eligibility-for-reuse[`serviceConfig()`] are almost always needed"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "Check code for anti-patterns"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "Extension code should never stop or start the Dev Service"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "Remove shutdown listeners; cleanup should be handled in the `stop()` method of the service's `Startable`"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "The `RunningDevService` type should never be used in the new model"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "Remove link:#static-fields[static variables] in the extension processor (such as pointers to a service instance)"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "Do not try and set configuration for accessing the new service directly using system properties or other overrides; use `configProvider()` instead"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "More migration details"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "Get rid of static fields on the extension processor"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "Extension authors should not rely on static variables for cross-instance communication. They should not assume that the invocation order of processors will be the same as the run order of applications."
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid ""
"The https://quarkus.io/guides/writing-extensions#injection[extension writing guide] says “State should only be communicated between build steps by way of build items, even if the steps are on the same class.”\n"
"However, almost every Dev Service implementation broke this rule, and used a static field to track previously-created services."
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "A good heuristic when migrating to the new model is that all static fields should go away. For example, remove all fields like these ones:"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "Deciding whether to re-use or replace a service is now link:#eligibility-for-reuse[handled centrally], based on a diff of the configuration."
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "Get rid of shutdown logic"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "Because service lifecycle is handled centrally, any shutdown listeners or other logic for stopping services should also be removed."
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "Remove any references to `RunningDevService`"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "Because the processor does not handle starting the service, it should never return a `RunningDevService`."
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "Use the builder"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid ""
"Instead of direct construction, use the new builder API. Choose `owned()` for services which are to be created,\n"
"or `discovered()` to register externally-managed services which have been discovered."
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "For example,"
msgstr "例えば"

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "Eligibility for re-use"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "How does the central lifecycle management decide whether a service can be re-used? This is based on 'sameness keys' (the config objects) passed in to the builder to use as the basis for the comparison."
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "The key method is `.serviceConfig(myConfig)`. The current config is compared reflectively to the config of running services each restart."
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "The `Startable`"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid ""
"In order to support lazy starting, pass an implementation of `Startable` to the builder.\n"
"(In case it's not obvious, do *not* call `start()` on your `Startable`. The Quarkus infrastructure will start your service at the appropriate time.)\n"
"(In case it's not obvious, do *not* call `start()` on your `Startable`. The Quarkus infrastructure will start your service at the appropriate time.)"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid ""
"For container-based services, it's usually convenient to extend `GenericContainer`.\n"
"In that case, there's not even any need to implement `start()`.\n"
"Most Dev Services implementations already provide a subclass of `GenericContainer`, so the diff is just to add `implements Startable` and then add a `close()` method. The `close` method can delegate to the superclass."
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "Dependency changes and setting a minimum Quarkus version"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid ""
"This bit is a bit awkward, unfortunately! In Quarkus 3.28, a new `devservices` runtime module was introduced. Most extensions have both a deployment and a runtime module, but historically, Dev Services only had a deployment module. The associated runtime classes lived in other modules. A runtime module was added in 3.28. Because it was a potentially disruptive change, it was done post-LTS. That seemed like a good idea, but it had some unexpected consequences.\n"
"The introduction of the new module was done in a way which preserved backwards compatibility, but not forward compatibility. That means extensions built against 3.27 will work with the 3.27 LTS, but not 3.28 or later versions. Extensions built with 3.28 will work with 3.27, and also 3.28 and later versions."
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "For this reason, you should either create branches for 3.27 and 3.28+ versions of the extension, or just build against 3.28. If you build against 3.28, you will need to manually set the minimum Quarkus version in the extension metadata, so that the Quarkus tooling recognises the extension as compatible with 3.27."
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "If you do decide to build against 3.28, add the following to the `pom.xml`:"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "FAQs"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "How can I have a build step do something after a dev service is started?"
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid ""
"This isn’t possible, because a dev service would never be started in the build phase. However, the `postStartHook` on the builder allows you to take actions once the dev service is started.\n"
"To pass configuration to the application, you can\n"
"https://quarkus.io/guides/writing-extensions#injecting-configuration-into-recorders[use recorders]."
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "Examples"
msgstr "例"

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "Sometimes it's easier to see what needs to be done in a diff."
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "For an example using a dev service which isn’t container-based, see the https://github.com/quarkusio/quarkus/pull/48753/files[Lambda conversion]. For a more complex conversion which uses compose, reuses existing external containers, and does post-start configuration, see just the `KafkaDevServicesProcessor` part of the https://github.com/quarkusio/quarkus/pull/48445/files#diff-77328c7968b5b6e5280c55994dd56cd1da637e84b1fecd751d6130e78840aefd[Kafka conversion]."
msgstr ""

#: _posts/2026-01-05-new-dev-services-api.adoc
msgid "The https://github.com/orgs/quarkusio/projects/49[working group for Dev Services lifecycle] is still underway, and welcomes contributions."
msgstr ""
