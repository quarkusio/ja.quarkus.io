<!DOCTYPE html>
<html lang="ja">







<head>
  <title>OpenID Connect (OIDC) ベアラートークン認証 - 3.2 - Quarkus</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="
  connect-src 'self' https://dpm.demdex.net https://adobedc.demdex.net https://analytics.ossupstream.org/ https://search.quarkus.io https://smetrics.redhat.com; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval'
      
      https://assets.adobedtm.com
      js.bizographics.com
      https://www.redhat.com
      https://static.redhat.com
      https://app.requestly.io/
      jsonip.com
      https://ajax.googleapis.com
      https://use.fontawesome.com
      http://www.youtube.com
      http://www.googleadservices.com
      https://googleads.g.doubleclick.net
      https://giscus.app
      https://analytics.ossupstream.org/
      https://app.mailjet.com;

  style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; 
  img-src 'self' * data:; 
  media-src 'self'; 
  frame-src https://redhat.demdex.net https://www.youtube.com https://player.restream.io https://app.mailjet.com http://xy0p2.mjt.lu https://mj.quarkus.io https://giscus.app; 
  base-uri 'none'; 
  object-src 'none'; 
  form-action 'none'; 
  font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/version/3.2/guides/security-oidc-bearer-token-authentication" />
  <meta property="og:title" content="OpenID Connect (OIDC) ベアラートークン認証 - 3.2" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/security-oidc-bearer-token-authentication">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
  
  
  
  
  <link rel="alternate" hreflang="x-default" href="https://quarkus.io/" />  
  <script src="/assets/javascript/tracking.js"></script>
  
  <script src="/assets/javascript/colormode.js" type="text/javascript"></script>

</head>

<body class="guides">

  


<div class="grid-wrapper communitysite">
  <div class="grid__item width-12-12">The <a href="https://quarkus.io/version/3.2/guides/security-oidc-bearer-token-authentication">English version of quarkus.io</a> is the official project site. Translated sites are community supported on a best-effort basis.</div>
</div>


  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
        <div class="logo-wrapper">
           <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
        </div>
    <label class="nav-toggle" for="checkbox"> <i class="fa fa-bars"></i>
</label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="#">Why<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">QUARKUSとは何か?</a></li>
          <li><a href="/developer-joy" class="">開発者満足</a></li>
          <li><a href="/performance" class="">パフォーマンス</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">標準</a></li>
          <li><a href="/versatility" class="">多用途性</a></li>
          <li><a href="/container-first" class="">コンテナ・ファースト</a></li>
          <li><a href="/spring" class="">USING SPRING?</a></li>
          <li class="tertiarydropdown">
            <span href="#">AI<i class="fas fa-chevron-down"></i></span>
            <ul class="tertiarymenu">
              <li><a href="/ai" class="">AI OVERVIEW</a></li>
              <li><a href="/java-for-ai" class="">JAVA FOR AI</a></li>
              <li><a href="/quarkus-for-ai" class="">WHY QUARKUS FOR AI</a></li>
              <li><a href="/ai-blueprints" class="">AI BLUEPRINTS</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="#">Learn<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">入門</a></li>
          <li><a href="/guides" class="active">ドキュメント</a></li>
          <li><a href="/userstories/" class="">ユーザーストーリー</a></li>  
          <li><a href="/qtips" class="">"Q" Tipsビデオ</a></li>          
          <li><a href="/books" class="">書籍</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="#">Extensions<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          
          <!-- Note that quarkus.io is hardcoded here, because it is the only url which supports extensions -->
<li><a href="https://quarkus.io/extensions/" class="">エクステンションを探す</a></li>
          <li><a href="/faq/#what-is-a-quarkus-extension" class="">エクステンションの使用</a></li>
          <li><a href="/guides/writing-extensions" class="">エクステンションの作成</a></li>
          <li><a href="https://hub.quarkiverse.io" class="">エクステンションの共有</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="#">Community<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">サポート</a></li>
          <li><a href="/blog" class="">ブログ</a></li>
          <li><a href="/discussion" class="">ディスカッション</a></li>
          <li><a href="/working-groups" class="">ワーキンググループ</a></li>
          <li><a href="/insights" class="">ポッドキャスト</a></li>
          <li><a href="/events" class="">イベント</a></li>
          <li><a href="/newsletter" class="">ニュースレター</a></li>
          <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" class="">ロードマップ</a></li>
          <li><a href="/benefactors" class="">BENEFACTORS</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary
white">コーディングを開始</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/version/3.2/guides/security-oidc-bearer-token-authentication" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://pt.quarkus.io/version/3.2/guides/security-oidc-bearer-token-authentication">ポルトガル（BR）</a></li>
          <li><a href="https://es.quarkus.io/version/3.2/guides/security-oidc-bearer-token-authentication">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/version/3.2/guides/security-oidc-bearer-token-authentication">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/version/3.2/guides/security-oidc-bearer-token-authentication">日本語</a></li>
          </ul>
      </li>
      <li>
        <span href="#" class="modeswitcher" id='theme-toggle'><i class="fas
fa-sun"></i><i class="fas fa-moon"></i><i class="fas fa-cog"></i></span>
      </li>
    </ul>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    







<section class="full-width-version-bg flexfilterbar guides">
  <div class="guideflexcontainer">
    <div class="docslink">
      <a class="returnlink" href="/version/3.2/guides/"> Back to Guides</a>
    </div>
    <div class="flexlabel">
      <label>バージョン:</label>
    </div>
    <div class="guidepulldown version">
    <select id="guide-version-dropdown">
      
        
        
        <option value="main" >Main - SNAPSHOT</option>
        
        
        
        <option value="latest" >3.28.4 - Latest</option>
        
        
        
        <option value="3.27" >3.27</option>
        
        
        
        <option value="3.20" >3.20</option>
        
        
        
        <option value="3.15" >3.15</option>
        
        
        
        <option value="3.8" >3.8</option>
        </select>
    </div>
  </div>
</section>

<div class="guide">
  <div class="grid-wrapper">
    <div class="grid__item width-8-12 width-12-12-m">
      
      <h1 class="text-caps">OpenID Connect (OIDC) ベアラートークン認証 </h1>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus OpenID Connect（OIDC）エクステンションを使用することで、ベアラートークン認証を使って、アプリケーション内のJakarta REST（旧称JAX-RS）エンドポイントへのHTTPアクセスを保護できます。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="overview-of-the-bearer-token-authentication-mechanism-in-quarkus"><a class="anchor" href="#overview-of-the-bearer-token-authentication-mechanism-in-quarkus"></a>Quarkusのベアラートークン認証メカニズムの概要</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quarkusは、Quarkus OpenID Connect（OIDC）エクステンションを通じて、ベアラートークン認証メカニズムをサポートしています。</p>
</div>
<div class="paragraph">
<p>ベアラートークンは、 <a href="https://www.keycloak.org">Keycloak</a> などのOIDCやOAuth2.0に準拠した認可サーバーで発行されます。</p>
</div>
<div class="paragraph">
<p>ベアラ・トークン認証とは、ベアラ・トークンの存在と有効性に基づいて HTTP 要求を認可するプロセスです。
ベアラートークンは呼び出しの主体に関する情報を提供し、HTTP リソースにアクセスできるかどうかを決定するために使われます。</p>
</div>
<div class="paragraph">
<p>以下の図に、Quarkusのベアラートークン認証メカニズムの概要を示します：</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/security-bearer-token-authorization-mechanism-1.png" alt="Bearer token authentication" width="60%">
</div>
<div class="title">Figure 1. Quarkusのシングルページアプリケーションにおけるベアラー認証メカニズム</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Quarkusサービスでは、OpenID Connectプロバイダーから検証キーを取得します。検証キーは、Bearerアクセストークンの署名を検証するために使用されます。</p>
</li>
<li>
<p>Quarkusユーザーは、シングルページアプリケーションにアクセスします。</p>
</li>
<li>
<p>シングルページアプリケーションでは、Authorization Code Flowを使用してユーザーを認証し、OpenID Connectプロバイダーからトークンを取得します。</p>
</li>
<li>
<p>シングルページアプリケーションでは、アクセストークンを使用して、Quarkusサービスからサービスデータを取得します。</p>
</li>
<li>
<p>Quarkusサービスは、検証キーを使用してBearerアクセストークンの署名を検証し、トークンの有効期限やその他のクレームをチェックし、トークンが有効であればリクエストを続行させ、サービス応答をシングルページアプリケーションに返します。</p>
</li>
<li>
<p>シングルページアプリケーションは、同じデータをQuarkusユーザーに返します。</p>
</li>
</ol>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/security-bearer-token-authorization-mechanism-2.png" alt="Bearer token authentication" width="60%">
</div>
<div class="title">Figure 2. JavaまたはコマンドラインクライアントによるQuarkusのベアラートークン認証メカニズム</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Quarkusサービスでは、OpenID Connectプロバイダーから検証キーを取得します。検証キーは、Bearerアクセストークンの署名を検証するために使用されます。</p>
</li>
<li>
<p>クライアントは、OpenID Connectプロバイダからアクセストークンを取得するために、クライアントIDとシークレットを必要とする <code>client_credentials</code> 、またはクライアントID、シークレット、ユーザー名、パスワードも必要とするpassword grantを使用します。</p>
</li>
<li>
<p>クライアントはアクセストークンを使用して、Quarkusサービスからサービスデータを取得します。</p>
</li>
<li>
<p>Quarkusサービスは、検証キーを使用してBearerアクセストークンの署名を検証し、トークンの有効期限やその他のクレームをチェックし、トークンが有効であればリクエストの実行を許可し、サービスレスポンスをクライアントに返します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>OpenID Connect認可コードフローを使用してユーザーを認証および認可する必要がある場合は、 <a href="security-oidc-code-flow-authentication">Webアプリケーションを保護するためのOIDCコードフロー</a> メカニズムを参照してください。また、Keycloakとベアラートークンを使用する場合は、 <a href="security-keycloak-authorization">Keycloakを使用して認証を一元化</a> するを参照してください。</p>
</div>
<div class="paragraph">
<p>OIDCベアラートークン認証を使用してサービスアプリケーションを保護する方法については、 <a href="security-oidc-bearer-token-authentication-tutorial">OIDCベアラートークン認証チュートリアル</a> を参照してください。</p>
</div>
<div class="paragraph">
<p>OIDC認可コードフロー認証を使用してWebアプリケーションを保護したい場合は、 <a href="security-oidc-code-flow-authentication-concept">OIDC認可コードフロー</a> 認証を参照してください。</p>
</div>
<div class="paragraph">
<p>マルチテナントへの対応方法については、 <a href="security-openid-connect-multitenancy">OpenID Connect (OIDC) マルチテナンシーの使用</a> ガイドをお読みください。</p>
</div>
<div class="sect2">
<h3 id="accessing-jwt-claims"><a class="anchor" href="#accessing-jwt-claims"></a>JWT クレームへのアクセス</h3>
<div class="paragraph">
<p>JWT トークンクレームにアクセスする必要がある場合は、 <code>JsonWebToken</code> を注入できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.security.openid.connect;

import org.eclipse.microprofile.jwt.JsonWebToken;
import jakarta.inject.Inject;
import jakarta.annotation.security.RolesAllowed;
import jakarta.ws.rs.GET;
import jakarta.ws.rs.Path;
import jakarta.ws.rs.Produces;
import jakarta.ws.rs.core.MediaType;

@Path("/api/admin")
public class AdminResource {

    @Inject
    JsonWebToken jwt;

    @GET
    @RolesAllowed("admin")
    @Produces(MediaType.TEXT_PLAIN)
    public String admin() {
        return "Access for subject " + jwt.getSubject() + " is granted";
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>JsonWebToken</code> の注入は、 <code>@ApplicationScoped</code>、 <code>@Singleton</code>、および <code>@RequestScoped</code> スコープでサポートされていますが、個々のクレームがシンプル型として注入される場合は、 <code>@RequestScoped</code> の使用が必要です。 <a href="security-jwt を参照してください。詳細については、 xref:security-jwt#supported-injection-scopes">JsonWebToken およびクレームの注入スコープのサポート</a> を参照してください。</p>
</div>
</div>
<div class="sect2">
<h3 id="user-info"><a class="anchor" href="#user-info"></a>ユーザー情報</h3>
<div class="paragraph">
<p>Set <code>quarkus.oidc.authentication.user-info-required=true</code> if a UserInfo JSON object from the OIDC userinfo endpoint has to be requested.
A request will be sent to the OpenID Provider UserInfo endpoint and  an <code>io.quarkus.oidc.UserInfo</code> (a simple <code>jakarta.json.JsonObject</code> wrapper) object will be created.
<code>io.quarkus.oidc.UserInfo</code> can be either injected or accessed as a SecurityIdentity <code>userinfo</code> attribute.</p>
</div>
</div>
<div class="sect2">
<h3 id="config-metadata"><a class="anchor" href="#config-metadata"></a>設定メタデータ</h3>
<div class="paragraph">
<p>現在のテナントが検出した <a href="https://openid.net/specs/openid-connect-discovery-1_0.html#ProviderMetadata">OpenID Connect 設定メタデータ</a> は <code>io.quarkus.oidc.OidcConfigurationMetadata</code> で表され、 <code>SecurityIdentity</code> <code>configuration-metadata</code> 属性として注入またはアクセスが可能です。</p>
</div>
<div class="paragraph">
<p>エンドポイントがパブリックの場合、デフォルトのテナントの <code>OidcConfigurationMetadata</code> が注入されます。</p>
</div>
</div>
<div class="sect2">
<h3 id="token-claims-and-securityidentity-roles"><a class="anchor" href="#token-claims-and-securityidentity-roles"></a>トークンクレームとセキュリティーアイデンティティロール</h3>
<div class="paragraph">
<p>SecurityIdentity ロールは、検証済みの JWT アクセストークンから以下のようにマッピングすることができます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>quarkus.oidc.roles.role-claim-path</code> プロパティーが設定されており、一致する配列または文字列のクレームが見つかった場合、このクレームからロールが抽出されます。例えば、 <code>customroles</code>、 <code>customroles/array</code>、 <code>scope</code>、 <code>"http://namespace-qualified-custom-claim"/roles</code>、 <code>"http://namespace-qualified-roles"</code> などです。</p>
</li>
<li>
<p><code>groups</code> クレームが利用可能な場合は、その値が使用されます。</p>
</li>
<li>
<p><code>realm_access/roles</code> または <code>resource_access/client_id/roles</code> (ここで <code>client_id</code> は <code>quarkus.oidc.client-id</code> プロパティーの値)クレームが利用可能な場合は、その値が使用されます。このチェックは、Keycloakが発行するトークンをサポートします。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>トークンが不透明(バイナリー)の場合は、リモートトークンイントロスペクションレスポンスの <code>scope</code> プロパティーが使用されます。</p>
</div>
<div class="paragraph">
<p>UserInfoがロールのソースである場合は、 <code>quarkus.oidc.authentication.user-info-required=true</code> と <code>quarkus.oidc.roles.source=userinfo</code> 、必要に応じて <code>quarkus.oidc.roles.role-claim-path</code> を設定します。</p>
</div>
<div class="paragraph">
<p>さらに、カスタム <code>SecurityIdentityAugmentor</code> をロールの追加に使用することもできます。詳しくは、 <a href="security-customization#security-identity-customization">Security Identityのカスタマイズ</a> を参照してください。</p>
</div>
</div>
<div class="sect2">
<h3 id="token-verification-introspection"><a class="anchor" href="#token-verification-introspection"></a>トークンの検証とイントロスペクション</h3>
<div class="paragraph">
<p>トークンが JWT トークンの場合、デフォルトでは、OpenID Connect プロバイダーの JWK エンドポイントから取得したローカルの <code>JsonWebKeySet</code> からの <code>JsonWebKey</code> (JWK) キーで検証されます。トークンのキー識別子 <code>kid</code> ヘッダー値は、一致する JWK キーを見つけるために使用されます。一致する <code>JWK</code> がローカルで利用できない場合、 <code>JsonWebKeySet</code> は、JWK エンドポイントから現在のキーセットを取得することによって更新されます。 <code>JsonWebKeySet</code> の更新は、 <code>quarkus.oidc.token.forced-jwk-refresh-interval</code> (デフォルトは 10 分) の期限が切れた後にのみ繰り返すことができます。更新後に一致する <code>JWK</code> が利用できない場合、JWT トークンは OpenID Connectプロバイダーのトークンイントロスペクションエンドポイントに送信されます。</p>
</div>
<div class="paragraph">
<p>トークンが不透明な場合 (バイナリートークンまたは暗号化された JWT トークンの場合があります)、常に OpenID Connectプロバイダーのトークンイントロスペクションエンドポイントに送信されます。</p>
</div>
<div class="paragraph">
<p>JWT トークンのみを使用していて、一致する <code>JsonWebKey</code> が常に使用可能になると予想される場合 (おそらくキーセットの更新後)、トークンのイントロスペクションを無効にする必要があります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.oidc.token.allow-jwt-introspection=false
quarkus.oidc.token.allow-opaque-token-introspection=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>ただし、JWT トークンをイントロスペクションのみで検証する必要がある場合があります。イントロスペクションエンドポイントアドレスのみを設定することで強制できます。たとえば、Keycloak の場合は、次のように設定できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.oidc.auth-server-url=http://localhost:8180/realms/quarkus
quarkus.oidc.discovery-enabled=false
# Token Introspection endpoint: http://localhost:8180/realms/quarkus/protocol/openid-connect/tokens/introspect
quarkus.oidc.introspection-path=/protocol/openid-connect/tokens/introspect</code></pre>
</div>
</div>
<div class="paragraph">
<p>JWTトークンがリモートでイントロスペクションされるだけのこの間接的な実施方法の利点は、2つのリモートコールが避けられることです。リモートOIDCメタデータディスカバリー呼出と、続く使用されない検証キーを取得する別のリモートコールを避けることが出来ます。一方欠点として、ユーザーがイントロスペクションエンドポイントアドレスを知って、それを手動で構成する必要があることです。</p>
</div>
<div class="paragraph">
<p>別のアプローチは、OIDCメタデータのディスカバリーは許可するが（これはデフォルトのオプション）、リモートJWTイントロスペクションのみが実行されることを要求することです:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.oidc.auth-server-url=http://localhost:8180/realms/quarkus
quarkus.oidc.token.require-jwt-introspection-only=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>この方法の利点は、設定がシンプルでわかりやすいことですが、欠点は、イントロスペクションのエンドポイントアドレスを発見するために、リモートOIDCメタデータディスカバリー呼び出しが必要なことです（検証キーもフェッチされない）。</p>
</div>
<div class="paragraph">
<p>Note that <code>io.quarkus.oidc.TokenIntrospection</code> (a simple <code>jakarta.json.JsonObject</code> wrapper) object will be created and can be either injected or accessed as a SecurityIdentity <code>introspection</code> attribute if either JWT or opaque token has been successfully introspected.</p>
</div>
</div>
<div class="sect2">
<h3 id="token-introspection-userinfo-cache"><a class="anchor" href="#token-introspection-userinfo-cache"></a>トークンイントロスペクションと UserInfo キャッシュ</h3>
<div class="paragraph">
<p>すべての不透明な、場合によっては JWT Bearer アクセストークンは、リモートで検査する必要があります。 <code>UserInfo</code> も必要な場合は、同じアクセストークンを使用して OpenID Connectプロバイダーへのリモート呼び出しを再度実行します。したがって、 <code>UserInfo</code> が必要で、現在のアクセストークンが不透明な場合、そのようなトークンごとに 2 つのリモート呼び出しが行われます。1 つはそれを検査し、もう 1 つは UserInfo を取得します。トークンが JWT の場合、通常は UserInfo を取得するには、1 回のリモート呼び出しだけが必要になります。</p>
</div>
<div class="paragraph">
<p>着信ベアラーまたはコードフローアクセストークンごとに最大 2 つのリモート呼び出しを行うコストが、問題になる場合があります。</p>
</div>
<div class="paragraph">
<p>本番環境でこれに当てはまる場合は、トークンのイントロスペクションと <code>UserInfo</code> データを短時間、たとえば 3 - 5 分間キャッシュすることをお勧めします。</p>
</div>
<div class="paragraph">
<p><code>quarkus-oidc</code> は <code>quarkus.oidc.TokenIntrospectionCache</code> と <code>quarkus.oidc.UserInfoCache</code> インターフェイスを提供します。これらは <code>@ApplicationScoped</code> キャッシュ実装を実装するために使用できます。これらは <code>quarkus.oidc.TokenIntrospection</code> や <code>quarkus.oidc.UserInfo</code> オブジェクトを取得および保存するのに使用できます。以下に例を示します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ApplicationScoped
@Alternative
@Priority(1)
public class CustomIntrospectionUserInfoCache implements TokenIntrospectionCache, UserInfoCache {
...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>各 OIDC テナントは、ブール値 <code>quarkus.oidc."tenant".allow-token-introspection-cache</code> および <code>quarkus.oidc."tenant".allow-user-info-cache</code> プロパティーを使用して、その <code>quarkus.oidc.TokenIntrospection</code> や <code>quarkus.oidc.UserInfo</code> データを保存することを許可または拒否できます。</p>
</div>
<div class="paragraph">
<p>さらに、 <code>quarkus-oidc</code> は、 <code>quarkus.oidc.TokenIntrospectionCache</code> および <code>quarkus.oidc.UserInfoCache</code> インターフェイスの両方を実装するシンプルなデフォルトのメモリーベースのトークンキャッシュを提供します。</p>
</div>
<div class="paragraph">
<p>これは、次のようにアクティブ化および設定できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"># 'max-size' is 0 by default so the cache can be activated by setting 'max-size' to a positive value.
quarkus.oidc.token-cache.max-size=1000
# 'time-to-live' specifies how long a cache entry can be valid for and will be used by a cleanup timer.
quarkus.oidc.token-cache.time-to-live=3M
# 'clean-up-timer-interval' is not set by default so the cleanup timer can be activated by setting 'clean-up-timer-interval'.
quarkus.oidc.token-cache.clean-up-timer-interval=1M</code></pre>
</div>
</div>
<div class="paragraph">
<p>デフォルトのキャッシュはトークンをキーとして使用し、各エントリーは <code>TokenIntrospection</code> や <code>UserInfo</code> を持つことができます。 <code>max-size</code> のエントリー数までしか保持しません。新しいエントリーを追加するときにキャッシュがいっぱいな場合、期限切れのエントリーを 1 つ削除して、スペースを見つけようとします。さらに、クリーンアップタイマーがアクティブになっている場合は、期限切れのエントリーを定期的にチェックして削除します。</p>
</div>
<div class="paragraph">
<p>デフォルトのキャッシュ実装を試すか、カスタム実装を登録してください。</p>
</div>
</div>
<div class="sect2">
<h3 id="jwt-claim-verification"><a class="anchor" href="#jwt-claim-verification"></a>JSON Web トークンのクレーム検証</h3>
<div class="paragraph">
<p>ベアラのJWTトークンの署名が検証され、 <code>expires at</code> ( <code>exp</code>) のクレームが確認されると、次に <code>iss</code> ( <code>issuer</code>) クレーム値が検証されます。</p>
</div>
<div class="paragraph">
<p>デフォルトでは、 <code>iss</code> クレーム値は、well-knownプロバイダの設定で発見された <code>issuer</code> プロパティと比較されます。しかし、 <code>quarkus.oidc.token.issuer</code> プロパティが設定されている場合は、代わりに <code>iss</code> クレーム値がそれと比較されます。</p>
</div>
<div class="paragraph">
<p>場合によっては、この <code>iss</code> クレームの検証がうまくいかないことがあります。例えば、発見された <code>issuer</code> プロパティに内部の HTTP/IP アドレスが含まれている一方で、トークン <code>iss</code> クレーム値に外部の HTTP/IP アドレスが含まれている場合です。あるいは、発見された <code>issuer</code> プロパティにテンプレートのテナント変数が含まれているが、トークン <code>iss</code> クレーム値には完全なテナント固有の発行者の値が含まれている場合です。</p>
</div>
<div class="paragraph">
<p>このような場合には、 <code>quarkus.oidc.token.issuer=any</code> を設定して、issuer検証を省略することを検討してください。なお、この設定は推奨されておらず、他に選択肢がない場合を除き、避けるべきです。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Keycloakを使用していて、ホストアドレスが異なるために発行者検証エラーが発生する場合は、Keycloakに <code>KEYCLOAK_FRONTEND_URL</code> プロパティを設定して、同じホストアドレスが使用されるようにしてください。</p>
</li>
<li>
<p>If the <code>iss</code> property is tenant specific in a multi-tenant deployment then you can use the <code>SecurityIdentity</code> <code>tenant-id</code> attribute to check the issuer is correct in the endpoint itself or the custom Jakarta REST filter, for example:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import jakarta.inject.Inject;
import jakarta.ws.rs.container.ContainerRequestContext;
import jakarta.ws.rs.container.ContainerRequestFilter;
import jakarta.ws.rs.ext.Provider;

import org.eclipse.microprofile.jwt.JsonWebToken;
import io.quarkus.oidc.OidcConfigurationMetadata;
import io.quarkus.security.identity.SecurityIdentity;

@Provider
public class IssuerValidator implements ContainerRequestFilter {
    @Inject
    OidcConfigurationMetadata configMetadata;

    @Inject JsonWebToken jwt;
    @Inject SecurityIdentity identity;

    public void filter(ContainerRequestContext requestContext) {
        String issuer = configMetadata.getIssuer().replace("{tenant-id}", identity.getAttribute("tenant-id"));
        if (!issuer.equals(jwt.getIssuer())) {
            requestContext.abortWith(Response.status(401).build());
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>なお、トークン <code>aud</code> ( <code>audience</code>) のクレーム値を検証するために <code>quarkus.oidc.token.audience</code> プロパティを使用することも推奨します。</p>
</div>
</div>
<div class="sect2">
<h3 id="single-page-applications"><a class="anchor" href="#single-page-applications"></a>シングルページアプリケーション</h3>
<div class="paragraph">
<p>シングルページアプリケーション (SPA) は通常、 <code>XMLHttpRequest</code> (XHR) と OpenID Connect プロバイダーが提供する JavaScript ユーティリティーコードを使用してBearer Tokenを取得し、それを使用してQuarkus <code>service</code> アプリケーションにアクセスします。</p>
</div>
<div class="paragraph">
<p>例えば、 <code>keycloak.js</code> を使用してユーザーを認証し、SPA から期限切れのトークンをリフレッシュする方法は以下の通りです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;keycloak-spa&lt;/title&gt;
    &lt;script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"&gt;&lt;/script&gt;
    &lt;script src="http://localhost:8180/js/keycloak.js"&gt;&lt;/script&gt;
    &lt;script&gt;
        var keycloak = new Keycloak();
        keycloak.init({onLoad: 'login-required'}).success(function () {
            console.log('User is now authenticated.');
        }).error(function () {
            window.location.reload();
        });
        function makeAjaxRequest() {
            axios.get("/api/hello", {
                headers: {
                    'Authorization': 'Bearer ' + keycloak.token
                }
            })
            .then( function (response) {
                console.log("Response: ", response.status);
            }).catch(function (error) {
                console.log('refreshing');
                keycloak.updateToken(5).then(function () {
                    console.log('Token refreshed');
                }).catch(function () {
                    console.log('Failed to refresh token');
                    window.location.reload();
                });
            });
    }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;button onclick="makeAjaxRequest()"&gt;Request&lt;/button&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cross-origin-resource-sharing"><a class="anchor" href="#cross-origin-resource-sharing"></a>クロスオリジンリソース共有</h3>
<div class="paragraph">
<p>別のドメインで動作する Single Page Application から OpenID Connect <code>service</code> アプリケーションを利用する場合は、CORS (Cross-Origin Resource Sharing) を設定する必要があります。詳細については、 <a href="http-reference.html#cors-filter">HTTP CORSのドキュメント</a>を参照してください。</p>
</div>
</div>
<div class="sect2">
<h3 id="provider-endpoint-configuration"><a class="anchor" href="#provider-endpoint-configuration"></a>プロバイダーエンドポイント設定</h3>
<div class="paragraph">
<p>OIDC <code>service</code> アプリケーションは、OpenID Connect プロバイダのトークン、 <code>JsonWebKey</code> (JWK) セット、そして時には <code>UserInfo</code> とイントロスペクションのエンドポイントアドレスを知る必要があります。</p>
</div>
<div class="paragraph">
<p>デフォルトでは、設定された <code>quarkus.oidc.auth-server-url</code> に <code>/.well-known/openid-configuration</code> パスを追加することで検出されます。</p>
</div>
<div class="paragraph">
<p>また、ディスカバリーエンドポイントが利用できない場合や、ディスカバリーエンドポイントのラウンドトリップを節約したい場合は、ディスカバリーを無効にして、相対パスの値で設定することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.oidc.auth-server-url=http://localhost:8180/realms/quarkus
quarkus.oidc.discovery-enabled=false
# Token endpoint: http://localhost:8180/realms/quarkus/protocol/openid-connect/token
quarkus.oidc.token-path=/protocol/openid-connect/token
# JWK set endpoint: http://localhost:8180/realms/quarkus/protocol/openid-connect/certs
quarkus.oidc.jwks-path=/protocol/openid-connect/certs
# UserInfo endpoint: http://localhost:8180/realms/quarkus/protocol/openid-connect/userinfo
quarkus.oidc.user-info-path=/protocol/openid-connect/userinfo
# Token Introspection endpoint: http://localhost:8180/realms/quarkus/protocol/openid-connect/tokens/introspect
quarkus.oidc.introspection-path=/protocol/openid-connect/tokens/introspect</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="token-propagation"><a class="anchor" href="#token-propagation"></a>トークンの伝播</h3>
<div class="paragraph">
<p>下流サービスへのベアラアクセストークンの伝播については、<a href="security-openid-connect-client-reference#token-propagation">トークン伝播</a> の項を参照してください。</p>
</div>
</div>
<div class="sect2">
<h3 id="oidc-provider-authentication"><a class="anchor" href="#oidc-provider-authentication"></a>Oidc プロバイダークライアント認証</h3>
<div class="paragraph">
<p><code>quarkus.oidc.runtime.OidcProviderClient</code> is used when a remote request to an OpenID Connect Provider has to be done. If the bearer token has to be introspected then <code>OidcProviderClient</code> has to authenticate to the OpenID Connect Provider. Please see <a href="security-oidc-code-flow-authentication#oidc-provider-client-authentication">OidcProviderClient Authentication</a> for more information about all the supported authentication options.</p>
</div>
</div>
<div class="sect2">
<h3 id="integration-testing"><a class="anchor" href="#integration-testing"></a>テスト</h3>
<div class="paragraph">
<p>テストプロジェクトに以下の依存関係を追加することから始めます。</p>
</div>
<div class="listingblock primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.rest-assured&lt;/groupId&gt;
    &lt;artifactId&gt;rest-assured&lt;/artifactId&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-junit5&lt;/artifactId&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-target-sync-gradle">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">testImplementation("io.rest-assured:rest-assured")
testImplementation("io.quarkus:quarkus-junit5")</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="integration-testing-wiremock"><a class="anchor" href="#integration-testing-wiremock"></a>Wiremock</h4>
<div class="paragraph">
<p>テストプロジェクトに以下の依存関係を追加します。</p>
</div>
<div class="listingblock primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-test-oidc-server&lt;/artifactId&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-target-sync-gradle">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">testImplementation("io.quarkus:quarkus-test-oidc-server")</code></pre>
</div>
</div>
<div class="paragraph">
<p>RESTテストエンドポイントを用意し、例えば以下のように <code>application.properties</code> を設定します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"># keycloak.url is set by OidcWiremockTestResource
quarkus.oidc.auth-server-url=${keycloak.url}/realms/quarkus/
quarkus.oidc.client-id=quarkus-service-app
quarkus.oidc.application-type=service</code></pre>
</div>
</div>
<div class="paragraph">
<p>最後に、例えば次のようにテストコードを書きます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import static org.hamcrest.Matchers.equalTo;

import java.util.Set;

import org.junit.jupiter.api.Test;

import io.quarkus.test.common.QuarkusTestResource;
import io.quarkus.test.junit.QuarkusTest;
import io.quarkus.test.oidc.server.OidcWiremockTestResource;
import io.restassured.RestAssured;
import io.smallrye.jwt.build.Jwt;

@QuarkusTest
@QuarkusTestResource(OidcWiremockTestResource.class)
public class BearerTokenAuthorizationTest {

    @Test
    public void testBearerToken() {
        RestAssured.given().auth().oauth2(getAccessToken("alice", Set.of("user")))
            .when().get("/api/users/me")
            .then()
            .statusCode(200)
            // the test endpoint returns the name extracted from the injected SecurityIdentity Principal
            .body("userName", equalTo("alice"));
    }

    private String getAccessToken(String userName, Set&lt;String&gt; groups) {
        return Jwt.preferredUserName(userName)
                .groups(groups)
                .issuer("https://server.example.com")
                .audience("https://service.example.com")
                .sign();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>quarkus-test-oidc-server</code> エクステンションには、 <code>JSON Web Key</code> (<code>JWK</code>) 形式の署名 RSA 秘密鍵ファイルが含まれており、 <code>smallrye.jwt.sign.key.location</code> 設定プロパティーでそれをポイントすることに注意してください。引数なしの <code>sign ()</code> 操作を使用してトークンに署名できます。</p>
</div>
<div class="paragraph">
<p><code>quarkus-oidc</code> <code>service</code> アプリケーションを <code>OidcWiremockTestResource</code> でテストすると、通信チャネルまで Wiremock HTTP スタブに対してテストされるため、最高のカバレッジが得られます。 <code>OidcWiremockTestResource</code> は今後、より複雑なベアラートークンのテストシナリオをサポートするために拡張される予定です。</p>
</div>
<div class="paragraph">
<p>現在 <code>OidcWiremockTestResource</code> でサポートされていない Wiremock スタブを定義するテストがすぐに必要な場合は、テストクラスに注入された <code>WireMockServer</code> インスタンスを介して行うことができます。次に例を示します。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Wiremock サーバーはテストを実行している JVM で実行されており、Quarkus アプリケーションを実行している Docker コンテナーからはアクセスできないため、 <code>OidcWiremockTestResource</code> は Docker コンテナーに対して <code>@QuarkusIntegrationTest</code> では機能しません。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package io.quarkus.it.keycloak;

import static com.github.tomakehurst.wiremock.client.WireMock.matching;
import static org.hamcrest.Matchers.equalTo;

import org.junit.jupiter.api.Test;

import com.github.tomakehurst.wiremock.WireMockServer;
import com.github.tomakehurst.wiremock.client.WireMock;

import io.quarkus.test.junit.QuarkusTest;
import io.quarkus.test.oidc.server.OidcWireMock;
import io.restassured.RestAssured;

@QuarkusTest
public class CustomOidcWireMockStubTest {

    @OidcWireMock
    WireMockServer wireMockServer;

    @Test
    public void testInvalidBearerToken() {
        wireMockServer.stubFor(WireMock.post("/auth/realms/quarkus/protocol/openid-connect/token/introspect")
                .withRequestBody(matching(".*token=invalid_token.*"))
                .willReturn(WireMock.aResponse().withStatus(400)));

        RestAssured.given().auth().oauth2("invalid_token").when()
                .get("/api/users/me/bearer")
                .then()
                .statusCode(401)
                .header("WWW-Authenticate", equalTo("Bearer"));
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="integration-testing-keycloak-devservices"><a class="anchor" href="#integration-testing-keycloak-devservices"></a>Dev Services for Keycloak</h4>
<div class="paragraph">
<p>Keycloak に対する統合テストには、<a href="security-openid-connect-dev-services">Dev Services for Keycloak</a> を使用することをお勧めします。 <code>Dev Services for Keycloak</code> は、テストコンテナーを起動して初期化します。これにより、 <code>quarkus</code> レルム、 <code>quarkus-app</code> クライアント (<code>secret</code> シークレット) が作成され、 <code>alice</code> (<code>admin</code> および <code>user</code> ロール) および <code>bob</code> (<code>user</code> ロール) ユーザーが追加されます。これらのプロパティーはすべてカスタマイズできます。</p>
</div>
<div class="paragraph">
<p>まず、次の依存関係を追加する必要があります。</p>
</div>
<div class="listingblock primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-test-keycloak-server&lt;/artifactId&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-target-sync-gradle">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">testImplementation("io.quarkus:quarkus-test-keycloak-server")</code></pre>
</div>
</div>
<div class="paragraph">
<p>これは、アクセストークンを取得するためのテストで使用できるユーティリティークラス <code>io.quarkus.test.keycloak.client.KeycloakTestClient</code> を提供します。</p>
</div>
<div class="paragraph">
<p>次に、 <code>application.properties</code> を準備します。完全に空の <code>application.properties</code> から始めることができます。これは、 <code>Dev Services for Keycloak</code> が実行中のテストコンテナーをポイントする <code>quarkus.oidc.auth-server-url</code> ならびに <code>quarkus.oidc.client-id=quarkus-app</code> および <code>quarkus.oidc.credentials.secret=secret</code> を登録するためです。</p>
</div>
<div class="paragraph">
<p>ただし、必要なすべての <code>quarkus-oidc</code> プロパティーがすでに設定されている場合は、 <code>quarkus.oidc.auth-server-url</code> を <code>Dev Services for Keycloak</code> の <code>prod</code> プロファイルに関連付けるだけでコンテナーを起動できます。以下に例を示します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">%prod.quarkus.oidc.auth-server-url=http://localhost:8180/realms/quarkus</code></pre>
</div>
</div>
<div class="paragraph">
<p>テストを実行する前にカスタムレルムファイルを Keycloak にインポートする必要がある場合は、次のように <code>Dev Services for Keycloak</code> を設定できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">%prod.quarkus.oidc.auth-server-url=http://localhost:8180/realms/quarkus
quarkus.keycloak.devservices.realm-path=quarkus-realm.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>最後に、JVM モードで実行されるテストを作成します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.security.openid.connect;

import io.quarkus.test.junit.QuarkusTest;
import io.quarkus.test.keycloak.client.KeycloakTestClient;
import io.restassured.RestAssured;
import org.junit.jupiter.api.Test;

@QuarkusTest
public class BearerTokenAuthenticationTest {

    KeycloakTestClient keycloakClient = new KeycloakTestClient();

    @Test
    public void testAdminAccess() {
        RestAssured.given().auth().oauth2(getAccessToken("alice"))
                .when().get("/api/admin")
                .then()
                .statusCode(200);
        RestAssured.given().auth().oauth2(getAccessToken("bob"))
                .when().get("/api/admin")
                .then()
                .statusCode(403);
    }

    protected String getAccessToken(String userName) {
        return keycloakClient.getAccessToken(userName);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>および、ネイティブモードで以下を実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.security.openid.connect;

import io.quarkus.test.junit.QuarkusIntegrationTest;

@QuarkusIntegrationTest
public class NativeBearerTokenAuthenticationIT extends BearerTokenAuthenticationTest {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>初期化および設定方法の詳細については、<a href="security-openid-connect-dev-services">Dev Services for Keycloak</a> を参照してください。</p>
</div>
</div>
<div class="sect3">
<h4 id="integration-testing-keycloak"><a class="anchor" href="#integration-testing-keycloak"></a>KeycloakTestResourceLifecycleManager</h4>
<div class="paragraph">
<p>Keycloakとの統合テストが必要な場合は、 <a href="#integration-testing-keycloak-devservices">Dev Services For Keycloak</a> で行うことが推奨されます。 <code>Dev Services for Keycloak</code> を使用しない正当な理由がある場合にのみ、テストに <code>KeycloakTestResourceLifecycleManager</code> を使用してください。</p>
</div>
<div class="paragraph">
<p>以下の依存関係を追加することから始めます。</p>
</div>
<div class="listingblock primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-test-keycloak-server&lt;/artifactId&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-target-sync-gradle">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">testImplementation("io.quarkus:quarkus-test-keycloak-server")</code></pre>
</div>
</div>
<div class="paragraph">
<p>これは、Keycloak コンテナーを開始する <code>io.quarkus.test.common.QuarkusTestResourceLifecycleManager</code> の実装である <code>io.quarkus.test.keycloak.server.KeycloakTestResourceLifecycleManager</code> を提供します。</p>
</div>
<div class="paragraph">
<p>そして、Maven Surefire プラグインを次のように設定します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
    &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
    &lt;configuration&gt;
        &lt;systemPropertyVariables&gt;
            &lt;!-- or, alternatively, configure 'keycloak.version' --&gt;
            &lt;keycloak.docker.image&gt;${keycloak.docker.image}&lt;/keycloak.docker.image&gt;
            &lt;!--
              Disable HTTPS if required:
              &lt;keycloak.use.https&gt;false&lt;/keycloak.use.https&gt;
            --&gt;
        &lt;/systemPropertyVariables&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>(同様に、ネイティブイメージでテストする場合は <code>maven.failsafe.plugin</code>)。</p>
</div>
<div class="paragraph">
<p>RESTテストエンドポイントを用意し、例えば以下のように <code>application.properties</code> を設定します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"># keycloak.url is set by KeycloakTestResourceLifecycleManager
quarkus.oidc.auth-server-url=${keycloak.url}/realms/quarkus/
quarkus.oidc.client-id=quarkus-service-app
quarkus.oidc.credentials=secret
quarkus.oidc.application-type=service</code></pre>
</div>
</div>
<div class="paragraph">
<p>最後に、例えば次のようにテストコードを書きます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import static io.quarkus.test.keycloak.server.KeycloakTestResourceLifecycleManager.getAccessToken;
import static org.hamcrest.Matchers.equalTo;

import org.hamcrest.Matchers;
import org.junit.jupiter.api.Test;

import io.quarkus.test.common.QuarkusTestResource;
import io.quarkus.test.junit.QuarkusTest;
import io.quarkus.test.keycloak.server.KeycloakTestResourceLifecycleManager;
import io.restassured.RestAssured;

@QuarkusTest
@QuarkusTestResource(KeycloakTestResourceLifecycleManager.class)
public class BearerTokenAuthorizationTest {

    @Test
    public void testBearerToken() {
        RestAssured.given().auth().oauth2(getAccessToken("alice"))))
            .when().get("/api/users/preferredUserName")
            .then()
            .statusCode(200)
            // the test endpoint returns the name extracted from the injected SecurityIdentity Principal
            .body("userName", equalTo("alice"));
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>KeycloakTestResourceLifecycleManager</code> は <code>alice</code> と <code>admin</code> ユーザーを登録します。ユーザー <code>alice</code> にはデフォルトで <code>user</code> ロールしかありませんが、 <code>keycloak.token.user-roles</code> システムプロパティーでカスタマイズできます。ユーザー <code>admin</code> にはデフォルトで <code>user</code> と <code>admin</code> ロールがありますが、 <code>keycloak.token.admin-roles</code> システムプロパティーでカスタマイズできます。</p>
</div>
<div class="paragraph">
<p>デフォルトでは、 <code>KeycloakTestResourceLifecycleManager</code> は HTTPS を使用して Keycloak インスタンスを初期化しますが、 <code>keycloak.use.https=false</code> で無効にできます。デフォルトのレルム名は <code>quarkus</code> で、クライアント ID <code>quarkus-service-app</code> は、必要に応じて値をカスタマイズするために <code>keycloak.realm</code> および <code>keycloak.service.client</code> システムプロパティーを設定します。</p>
</div>
</div>
<div class="sect3">
<h4 id="integration-testing-public-key"><a class="anchor" href="#integration-testing-public-key"></a>ローカル公開鍵</h4>
<div class="paragraph">
<p>また、 <code>quarkus-oidc</code> <code>service</code> アプリケーションのテストに、ローカルのインライン公開鍵を使用することもできます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.oidc.client-id=test
quarkus.oidc.public-key=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAlivFI8qB4D0y2jy0CfEqFyy46R0o7S8TKpsx5xbHKoU1VWg6QkQm+ntyIv1p4kE1sPEQO73+HY8+Bzs75XwRTYL1BmR1w8J5hmjVWjc6R2BTBGAYRPFRhor3kpM6ni2SPmNNhurEAHw7TaqszP5eUF/F9+KEBWkwVta+PZ37bwqSE4sCb1soZFrVz/UT/LF4tYpuVYt3YbqToZ3pZOZ9AX2o1GCG3xwOjkc4x0W7ezbQZdC9iftPxVHR8irOijJRRjcPDtA6vPKpzLl6CyYnsIYPd99ltwxTHjr3npfv/3Lw50bAkbT4HeLFxTx4flEoZLKO/g0bAoV2uqBhkA9xnQIDAQAB

smallrye.jwt.sign.key.location=/privateKey.pem</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>integration-tests/oidc-tenancy</code> から <code>main</code> のQuarkusリポジトリに <code>privateKey.pem</code> をコピーし、上記 <code>Wiremock</code> のセクションと同様のテストコードを使用してJWTトークンを生成します。必要であれば、独自のテストキーを使用することもできます。</p>
</div>
<div class="paragraph">
<p>このアプローチは、Wiremockのアプローチと比較して、より限定された範囲をカバーします。例えば、リモート通信コードはカバーされません。</p>
</div>
</div>
<div class="sect3">
<h4 id="integration-testing-security-annotation"><a class="anchor" href="#integration-testing-security-annotation"></a>TestSecurity アノテーション</h4>
<div class="paragraph">
<p><code>@TestSecurity</code> および <code>@OidcSecurity</code> アノテーションを使用して、注入された <code>JsonWebToken</code> ならびに <code>UserInfo</code> および <code>OidcConfigurationMetadata</code> に依存する <code>service</code> アプリケーションエンドポイントコードをテストできます。</p>
</div>
<div class="paragraph">
<p>以下の依存関係を追加します。</p>
</div>
<div class="listingblock primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-test-security-oidc&lt;/artifactId&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-target-sync-gradle">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">testImplementation("io.quarkus:quarkus-test-security-oidc")</code></pre>
</div>
</div>
<div class="paragraph">
<p>次のようなテストコードを作成します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import static org.hamcrest.Matchers.is;
import org.junit.jupiter.api.Test;
import io.quarkus.test.common.http.TestHTTPEndpoint;
import io.quarkus.test.junit.QuarkusTest;
import io.quarkus.test.security.TestSecurity;
import io.quarkus.test.security.oidc.Claim;
import io.quarkus.test.security.oidc.ConfigMetadata;
import io.quarkus.test.security.oidc.OidcSecurity;
import io.quarkus.test.security.oidc.OidcConfigurationMetadata;
import io.quarkus.test.security.oidc.UserInfo;
import io.restassured.RestAssured;

@QuarkusTest
@TestHTTPEndpoint(ProtectedResource.class)
public class TestSecurityAuthTest {

    @Test
    @TestSecurity(user = "userOidc", roles = "viewer")
    public void testOidc() {
        RestAssured.when().get("test-security-oidc").then()
                .body(is("userOidc:viewer"));
    }

    @Test
    @TestSecurity(user = "userOidc", roles = "viewer")
    @OidcSecurity(claims = {
            @Claim(key = "email", value = "user@gmail.com")
    }, userinfo = {
            @UserInfo(key = "sub", value = "subject")
    }, config = {
            @ConfigMetadata(key = "issuer", value = "issuer")
    })
    public void testOidcWithClaimsUserInfoAndMetadata() {
        RestAssured.when().get("test-security-oidc-claims-userinfo-metadata").then()
                .body(is("userOidc:viewer:user@gmail.com:subject:issuer"));
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>ここで、 <code>ProtectedResource</code> クラスは次のようになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.quarkus.oidc.OidcConfigurationMetadata;
import io.quarkus.oidc.UserInfo;
import org.eclipse.microprofile.jwt.JsonWebToken;

@Path("/service")
@Authenticated
public class ProtectedResource {

    @Inject
    JsonWebToken accessToken;
    @Inject
    UserInfo userInfo;
    @Inject
    OidcConfigurationMetadata configMetadata;

    @GET
    @Path("test-security-oidc")
    public String testSecurityOidc() {
        return accessToken.getName() + ":" + accessToken.getGroups().iterator().next();
    }

    @GET
    @Path("test-security-oidc-claims-userinfo-metadata")
    public String testSecurityOidcWithClaimsUserInfoMetadata() {
        return accessToken.getName() + ":" + accessToken.getGroups().iterator().next()
                + ":" + accessToken.getClaim("email")
                + ":" + userInfo.getString("sub")
                + ":" + configMetadata.get("issuer");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@TestSecurity</code> アノテーションは常に使用する必要があり、その <code>user</code> プロパティーは <code>JsonWebToken.getName()</code> として返され、 <code>roles</code> プロパティーは <code>JsonWebToken.getGroups()</code> として返されることに注意してください。 <code>@OidcSecurity</code> アノテーションはオプションであり、追加のトークンクレームおよび <code>UserInfo</code> プロパティーと <code>OidcConfigurationMetadata</code> プロパティーを設定するために使用できます。さらに、 <code>quarkus.oidc.token.issuer</code> プロパティーが設定されている場合、 <code>OidcConfigurationMetadata</code> <code>issuer</code> プロパティー値として使用されます。</p>
</div>
<div class="paragraph">
<p>不透明なトークンを使用する場合は、次のようにテストできます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import static org.hamcrest.Matchers.is;
import org.junit.jupiter.api.Test;
import io.quarkus.test.common.http.TestHTTPEndpoint;
import io.quarkus.test.junit.QuarkusTest;
import io.quarkus.test.security.TestSecurity;
import io.quarkus.test.security.oidc.OidcSecurity;
import io.quarkus.test.security.oidc.TokenIntrospection;
import io.restassured.RestAssured;

@QuarkusTest
@TestHTTPEndpoint(ProtectedResource.class)
public class TestSecurityAuthTest {

    @Test
    @TestSecurity(user = "userOidc", roles = "viewer")
    @OidcSecurity(introspectionRequired = true,
        introspection = {
            @TokenIntrospection(key = "email", value = "user@gmail.com")
        }
    )
    public void testOidcWithClaimsUserInfoAndMetadata() {
        RestAssured.when().get("test-security-oidc-claims-userinfo-metadata").then()
                .body(is("userOidc:viewer:userOidc:viewer"));
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>ここで、 <code>ProtectedResource</code> クラスは次のようになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.quarkus.oidc.TokenIntrospection;
import io.quarkus.security.identity.SecurityIdentity;

@Path("/service")
@Authenticated
public class ProtectedResource {

    @Inject
    SecurityIdentity securityIdentity;
    @Inject
    TokenIntrospection introspection;

    @GET
    @Path("test-security-oidc-opaque-token")
    public String testSecurityOidcOpaqueToken() {
        return securityIdentity.getPrincipal().getName() + ":" + securityIdentity.getRoles().iterator().next()
            + ":" + introspection.getString("username")
            + ":" + introspection.getString("scope")
            + ":" + introspection.getString("email");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@TestSecurity</code> <code>user</code> および <code>roles</code> 属性は <code>TokenIntrospection</code> <code>username</code> および <code>scope</code> プロパティーとして使用可能で、 <code>io.quarkus.test.security.oidc.TokenIntrospection</code> を使用してさらに <code>email</code> などのイントロスペクション応答プロパティーを追加できることに注意してください。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>@TestSecurity</code> と <code>@OidcSecurity</code> は、例えばこのようにメタアノテーションで組み合わせることができます:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @Retention(RetentionPolicy.RUNTIME)
    @Target({ ElementType.METHOD })
    @TestSecurity(user = "userOidc", roles = "viewer")
    @OidcSecurity(introspectionRequired = true,
        introspection = {
            @TokenIntrospection(key = "email", value = "user@gmail.com")
        }
    )
    public @interface TestSecurityMetaAnnotation {

    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>これは、同じセキュリティ設定のセットを複数のテストメソッドで使用する必要がある場合に特に便利です。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="how-to-check-the-errors-in-the-logs"><a class="anchor" href="#how-to-check-the-errors-in-the-logs"></a>ログでエラーを確認する方法</h3>
<div class="paragraph">
<p>トークン検証エラーの詳細を確認するには、 <code>io.quarkus.oidc.runtime.OidcProvider</code> <code>TRACE</code> レベルのログを有効にしてください。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.log.category."io.quarkus.oidc.runtime.OidcProvider".level=TRACE
quarkus.log.category."io.quarkus.oidc.runtime.OidcProvider".min-level=TRACE</code></pre>
</div>
</div>
<div class="paragraph">
<p>OidcProvider クライアント初期化エラーの詳細を確認するには、 <code>io.quarkus.oidc.runtime.OidcRecorder</code> <code>TRACE</code> レベルのログを有効にしてください。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.log.category."io.quarkus.oidc.runtime.OidcRecorder".level=TRACE
quarkus.log.category."io.quarkus.oidc.runtime.OidcRecorder".min-level=TRACE</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="external-and-internal-access-to-openid-connect-provider"><a class="anchor" href="#external-and-internal-access-to-openid-connect-provider"></a>OpenID Connect プロバイダーへの外部および内部アクセス</h3>
<div class="paragraph">
<p>Note that the OpenID Connect Provider externally accessible token and other endpoints may have different HTTP(S) URLs compared to the URLs auto-discovered or configured relative to <code>quarkus.oidc.auth-server-url</code> internal URL. For example, if your SPA acquires a token from an external token endpoint address and sends it to Quarkus as a bearer token then an issuer verification failure may be reported by the endpoint.</p>
</div>
<div class="paragraph">
<p>このような場合、Keycloak を使用する場合は、外部からアクセス可能なベース URL に設定された <code>KEYCLOAK_FRONTEND_URL</code> システムプロパティーで起動してください。他の Openid Connect プロバイダーと連携している場合は、プロバイダーのドキュメントを確認してください。</p>
</div>
</div>
<div class="sect2">
<h3 id="how-to-use-client-id-property"><a class="anchor" href="#how-to-use-client-id-property"></a>'client-id' プロパティーの使用方法</h3>
<div class="paragraph">
<p><code>quarkus.oidc.client-id</code> プロパティーは、現在のBearer Tokenを要求した OpenIDConnect クライアントを識別します。これは、ブラウザーで実行されている SPA アプリケーション、またはアクセストークンを Quarkus <code>service</code> アプリケーションに伝播する Quarkus <code>web-app</code> 機密クライアントアプリケーションの場合があります。</p>
</div>
<div class="paragraph">
<p>このプロパティーは、 <code>service</code> アプリケーションがトークンをリモートで検査することが期待される場合に必要です。これは不透明なトークンの場合は常に当てはまります。ローカルの Json Web Key トークン検証のみが使用される場合、このプロパティーはオプションです。</p>
</div>
<div class="paragraph">
<p>それでも、エンドポイントがリモートイントロスペクションエンドポイントへのアクセスを必要としない場合でも、このプロパティーを設定することをお勧めします。その背後にある理由は、 <code>client-id</code> が設定されている場合、トークンオーディエンスを検証するために使用でき、トークンの検証が失敗したときにログに含まれるため、長い期間分析対象となる特定のクライアントに発行されたトークンのトレーサビリティが向上するためです。</p>
</div>
<div class="paragraph">
<p>たとえば、OpenID Connect プロバイダーがトークンオーディエンスを設定する場合、次の設定パターンが推奨されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"># Set client-id
quarkus.oidc.client-id=quarkus-app
# Token audience claim must contain 'quarkus-app'
quarkus.oidc.token.audience=${quarkus.oidc.client-id}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.client-id</code> を設定したが、エンドポイントが OpenID Connect プロバイダーエンドポイントの 1 つへのリモートアクセスを必要としない場合は (イントロスペクション、トークン取得など)、 <code>quarkus.oidc.credentials</code> または同様のプロパティーでクライアントシークレットを設定しないでください。使用されないためです。</p>
</div>
<div class="paragraph">
<p>Quarkus の <code>web-app</code> アプリケーションには、常に <code>quarkus.oidc.client-id</code> プロパティーが必要である点に注意してください。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="references"><a class="anchor" href="#references"></a>参照</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="security-oidc-configuration-properties-reference">OIDC設定プロパティ</a></p>
</li>
<li>
<p><a href="security-oidc-bearer-token-authentication-tutorial">OIDCベアラートークン認証によるサービスアプリケーションの保護</a></p>
</li>
<li>
<p><a href="security-protect-service-applications-by-using-oidc-bearer-authentication-how-to">Protect service applications by using OIDC Bearer token authentication</a></p>
</li>
<li>
<p><a href="https://www.keycloak.org/documentation.html">Keycloak Documentation</a></p>
</li>
<li>
<p><a href="https://openid.net/connect/">OpenID Connect</a></p>
</li>
<li>
<p><a href="https://tools.ietf.org/html/rfc7519">JSON Web Token</a></p>
</li>
<li>
<p><a href="security-openid-connect-client-reference">OpenID Connect and OAuth2 Client and Filters Reference Guide</a></p>
</li>
<li>
<p><a href="security-openid-connect-dev-services">Dev Services for Keycloak</a></p>
</li>
<li>
<p><a href="security-jwt-build">JSONウェブトークン (JWT) のビルド、署名、暗号化</a></p>
</li>
<li>
<p><a href="security-authentication-mechanisms#oidc-jwt-oauth2-comparison">OpenID Connect、SmallRye JWT、OAuth2の認証メカニズムの選択</a></p>
</li>
<li>
<p><a href="security-authentication-mechanisms#combining-authentication-mechanisms">認証メカニズムの組み合わせ</a></p>
</li>
<li>
<p><a href="security-overview">Quarkus Securityの概要</a></p>
</li>
<li>
<p><a href="security-keycloak-admin-client">Quarkus Keycloak Adminクライアント</a></p>
</li>
</ul>
</div>
</div>
</div>
    </div>
    <div class="grid__item width-4-12 width-12-12-m tocwrapper">
      <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#overview-of-the-bearer-token-authentication-mechanism-in-quarkus">Quarkusのベアラートークン認証メカニズムの概要</a>
<ul class="sectlevel2">
<li><a href="#accessing-jwt-claims">JWT クレームへのアクセス</a></li>
<li><a href="#user-info">ユーザー情報</a></li>
<li><a href="#config-metadata">設定メタデータ</a></li>
<li><a href="#token-claims-and-securityidentity-roles">トークンクレームとセキュリティーアイデンティティロール</a></li>
<li><a href="#token-verification-introspection">トークンの検証とイントロスペクション</a></li>
<li><a href="#token-introspection-userinfo-cache">トークンイントロスペクションと UserInfo キャッシュ</a></li>
<li><a href="#jwt-claim-verification">JSON Web トークンのクレーム検証</a></li>
<li><a href="#single-page-applications">シングルページアプリケーション</a></li>
<li><a href="#cross-origin-resource-sharing">クロスオリジンリソース共有</a></li>
<li><a href="#provider-endpoint-configuration">プロバイダーエンドポイント設定</a></li>
<li><a href="#token-propagation">トークンの伝播</a></li>
<li><a href="#oidc-provider-authentication">Oidc プロバイダークライアント認証</a></li>
<li><a href="#integration-testing">テスト</a></li>
<li><a href="#how-to-check-the-errors-in-the-logs">ログでエラーを確認する方法</a></li>
<li><a href="#external-and-internal-access-to-openid-connect-provider">OpenID Connect プロバイダーへの外部および内部アクセス</a></li>
<li><a href="#how-to-use-client-id-property">'client-id' プロパティーの使用方法</a></li>
</ul>
</li>
<li><a href="#references">参照</a></li>
</ul></div>
    </div>
  </div>
  </div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license. <i class='fab fa-creative-commons'></i><i class='fab fa-creative-commons-by'></i> <a href='https://creativecommons.org/licenses/by/3.0/' target='_blank'>CC by 3.0</a><br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>ナビゲーション</span>
        <ul class="footer-links">
          
          
            <li><a href="/" target="_blank">ホーム</a></li>
          
          
          
            <li><a href="/about" target="_blank">Quarkusについて</a></li>
          
          
          
            <li><a href="/blog" target="_blank">ブログ</a></li>
          
          
          
            <li><a href="/insights" target="_blank">ポッドキャスト</a></li>
          
          
          
            <li><a href="/events" target="_blank">イベント</a></li>
          
          
          
            <li><a href="/newsletter" target="_blank">ニュースレター</a></li>
          
          
          
            <li><a href="/userstories" target="_blank">ユーザーストーリー</a></li>
          
          
          
            <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" target="_blank">ロードマップ</a></li>
          
          
          
            <li><a href="/security" target="_blank">セキュリティ&nbsp;ポリシー</a></li>
          
          
          
            <li><a href="/usage" target="_blank">使用方法</a></li>
          
          
          
            <li><a href="/brand" target="_blank">Brand</a></li>
          
          
          
            <li><a href="/desktopwallpapers" target="_blank">Wallpapers</a></li>
          
          
          
            <li><a href="https://www.redhat.com/en/about/privacy-policy" target="_blank">Privacy Policy</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>フォローする</span>
        <ul class="footer-links">
          
          
            <li><a href="https://x.com/quarkusio" target="_blank">X</a></li>
          
          
          
            <li><a href="https://bsky.app/profile/quarkus.io" target="_blank">Bluesky</a></li>
          
          
          
            <li><a rel="me" href="https://fosstodon.org/@quarkusio" target="_blank">Mastodon</a></li>
            
          
          
            <li><a href="https://www.threads.com/@quarkusio" target="_blank">Threads</a></li>
          
          
          
            <li><a href="https://www.facebook.com/quarkusio" target="_blank">Facebook</a></li>
          
          
          
            <li><a href="https://www.linkedin.com/company/quarkusio/" target="_blank">Linkedin</a></li>
          
          
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg" target="_blank">Youtube</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio" target="_blank">GitHub</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>ヘルプ</span>
        <ul class="footer-links">
          
          
            <li><a href="/support" target="_blank">サポート</a></li>
          
          
          
            <li><a href="/guides" target="_blank">ガイド</a></li>
          
          
          
            <li><a href="/faq" target="_blank">FAQ</a></li>
          
          
          
            <li><a href="/get-started" target="_blank">入門</a></li>
          
          
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus" target="_blank">Stack Overflow</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions" target="_blank">ディスカッション</a></li>
          
          
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev" target="_blank">開発メーリングリスト</a></li>
          
          
          
            <li><a href="https://stats.uptimerobot.com/ze1PfweT2p" target="_blank">Quarkus Service Status</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>言語</span>
        <ul class="footer-links">
          
          
            <li><a href=" https://quarkus.io/ " target="_blank">English</a></li>
          
          
          
            <li><a href="https://pt.quarkus.io/" target="_blank">Português&nbsp;(Brasileiro)</a></li>
          
          
          
            <li><a href=" https://es.quarkus.io/ " target="_blank">Español</a></li>
          
          
          
            <li><a href="https://cn.quarkus.io/" target="_blank">简体中文</a></li>
          
          
          
            <li><a href=" https://ja.quarkus.io/ " target="_blank">日本語</a></li>
          
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkusはコミュニティプロジェクトで構成されています</span>
        <ul class="footer-links">
          
            <li><a blah href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a blah href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a blah href="https://hibernate.org" target="_blank">Hibernate ORM</a></li>
          
            <li><a blah href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a blah href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a blah href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a blah href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a blah href="https://code.quarkus.io/" target="_blank">その他多数...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content cf-footer">
  <div class="flexcontainer">
    <div class="cf-logo">
      <a class="cf-logo" href="https://www.commonhaus.org/" target="_blank"><img src="https://raw.githubusercontent.com/commonhaus/artwork/main/foundation/brand/svg/CF_logo_horizontal_single_reverse.svg"/></a>
    </div>
    <div class="license">
      Copyright © Quarkus. All rights reserved. For details on our trademarks, please visit our <a href="https://www.commonhaus.org/policies/trademark-policy/">Trademark Policy</a> and <a href="https://www.commonhaus.org/trademarks/">Trademark List</a>. Trademarks of third parties are owned by their respective holders and their mention here does not suggest any endorsement or association.
    </div>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
  <script src="/assets/javascript/future-date.js" type="text/javascript"></script>
  <script src="/assets/javascript/randomize.js" type="text/javascript"></script>
  <script src="/assets/javascript/time.js" type="text/javascript"></script>
</body>

</html>
