<!DOCTYPE html>
<html lang="ja">







<head>
  <title>ウェブエンドポイントの認可 - 2.16 - Quarkus</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="
  connect-src 'self' https://dpm.demdex.net https://adobedc.demdex.net https://analytics.ossupstream.org/ https://search.quarkus.io https://smetrics.redhat.com; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval'
      
      https://assets.adobedtm.com
      js.bizographics.com
      https://www.redhat.com
      https://static.redhat.com
      https://app.requestly.io/
      jsonip.com
      https://ajax.googleapis.com
      https://use.fontawesome.com
      http://www.youtube.com
      http://www.googleadservices.com
      https://googleads.g.doubleclick.net
      https://giscus.app
      https://analytics.ossupstream.org/
      https://app.mailjet.com;

  style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; 
  img-src 'self' * data:; 
  media-src 'self'; 
  frame-src https://redhat.demdex.net https://www.youtube.com https://player.restream.io https://app.mailjet.com http://xy0p2.mjt.lu https://mj.quarkus.io https://giscus.app; 
  base-uri 'none'; 
  object-src 'none'; 
  form-action 'none'; 
  font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/version/2.16/guides/security-authorize-web-endpoints-reference" />
  <meta property="og:title" content="ウェブエンドポイントの認可 - 2.16" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/security-authorize-web-endpoints-reference">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
  
  
  
  
  <link rel="alternate" hreflang="x-default" href="https://quarkus.io/" />  
  <script src="/assets/javascript/tracking.js"></script>
  
  <script src="/assets/javascript/colormode.js" type="text/javascript"></script>

</head>

<body class="guides">

  


<div class="grid-wrapper communitysite">
  <div class="grid__item width-12-12">The <a href="https://quarkus.io/version/2.16/guides/security-authorize-web-endpoints-reference">English version of quarkus.io</a> is the official project site. Translated sites are community supported on a best-effort basis.</div>
</div>


  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
        <div class="logo-wrapper">
           <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
        </div>
    <label class="nav-toggle" for="checkbox"> <i class="fa fa-bars"></i>
</label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="#">Why<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">QUARKUSとは何か?</a></li>
          <li><a href="/developer-joy" class="">開発者満足</a></li>
          <li><a href="/performance" class="">パフォーマンス</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">標準</a></li>
          <li><a href="/versatility" class="">多用途性</a></li>
          <li><a href="/container-first" class="">コンテナ・ファースト</a></li>
          <li><a href="/spring" class="">USING SPRING?</a></li>
          <li class="tertiarydropdown">
            <span href="#">AI<i class="fas fa-chevron-down"></i></span>
            <ul class="tertiarymenu">
              <li><a href="/ai" class="">AI OVERVIEW</a></li>
              <li><a href="/java-for-ai" class="">JAVA FOR AI</a></li>
              <li><a href="/quarkus-for-ai" class="">WHY QUARKUS FOR AI</a></li>
              <li><a href="/ai-blueprints" class="">AI BLUEPRINTS</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="#">Learn<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">入門</a></li>
          <li><a href="/guides" class="active">ドキュメント</a></li>
          <li><a href="/userstories/" class="">ユーザーストーリー</a></li>  
          <li><a href="/qtips" class="">"Q" Tipsビデオ</a></li>          
          <li><a href="/books" class="">書籍</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="#">Extensions<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          
          <!-- Note that quarkus.io is hardcoded here, because it is the only url which supports extensions -->
<li><a href="https://quarkus.io/extensions/" class="">エクステンションを探す</a></li>
          <li><a href="/faq/#what-is-a-quarkus-extension" class="">エクステンションの使用</a></li>
          <li><a href="/guides/writing-extensions" class="">エクステンションの作成</a></li>
          <li><a href="https://hub.quarkiverse.io" class="">エクステンションの共有</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="#">Community<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">サポート</a></li>
          <li><a href="/blog" class="">ブログ</a></li>
          <li><a href="/discussion" class="">ディスカッション</a></li>
          <li><a href="/working-groups" class="">ワーキンググループ</a></li>
          <li><a href="/insights" class="">ポッドキャスト</a></li>
          <li><a href="/events" class="">イベント</a></li>
          <li><a href="/newsletter" class="">ニュースレター</a></li>
          <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" class="">ロードマップ</a></li>
          <li><a href="/benefactors" class="">BENEFACTORS</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary
white">コーディングを開始</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/version/2.16/guides/security-authorize-web-endpoints-reference" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://pt.quarkus.io/version/2.16/guides/security-authorize-web-endpoints-reference">ポルトガル（BR）</a></li>
          <li><a href="https://es.quarkus.io/version/2.16/guides/security-authorize-web-endpoints-reference">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/version/2.16/guides/security-authorize-web-endpoints-reference">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/version/2.16/guides/security-authorize-web-endpoints-reference">日本語</a></li>
          </ul>
      </li>
      <li>
        <span href="#" class="modeswitcher" id='theme-toggle'><i class="fas
fa-sun"></i><i class="fas fa-moon"></i><i class="fas fa-cog"></i></span>
      </li>
    </ul>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    







<section class="full-width-version-bg flexfilterbar guides">
  <div class="guideflexcontainer">
    <div class="docslink">
      <a class="returnlink" href="/version/2.16/guides/"> Back to Guides</a>
    </div>
    <div class="flexlabel">
      <label>バージョン:</label>
    </div>
    <div class="guidepulldown version">
    <select id="guide-version-dropdown">
      
        
        
        <option value="main" >Main - SNAPSHOT</option>
        
        
        
        <option value="latest" >3.28.4 - Latest</option>
        
        
        
        <option value="3.27" >3.27</option>
        
        
        
        <option value="3.20" >3.20</option>
        
        
        
        <option value="3.15" >3.15</option>
        
        
        
        <option value="3.8" >3.8</option>
        </select>
    </div>
  </div>
</section>

<div class="guide">
  <div class="grid-wrapper">
    <div class="grid__item width-8-12 width-12-12-m">
      
      <h1 class="text-caps">ウェブエンドポイントの認可 </h1>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus has an integrated pluggable web security layer. If security is enabled, all HTTP requests will have a permission check performed to make sure they are allowed to continue.
This means you cannot use <code>@PermitAll</code> to open a path if the path is blocked by the <code>quarkus.http.auth.</code> configuration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are using JAX-RS, consider using <code>quarkus.security.jaxrs.deny-unannotated-endpoints</code> or <code>quarkus.security.jaxrs.default-roles-allowed</code> to set default security requirements instead of HTTP path-level matching because annotations can override these properties on an individual endpoint.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>認可は、セキュリティ・プロバイダーが提供するユーザー・ロールに基づきます。これらのロールをカスタマイズするには、 <code>SecurityIdentityAugmentor</code> を作成することができます。 <a href="security-customization.html#security-identity-customization">セキュリティ・アイデンティティのカスタマイズ</a> を参照してください。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="authorization-using-configuration"><a class="anchor" href="#authorization-using-configuration"></a>設定を利用した認可</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quarkusの設定では、パーミッション・セットを使用してパーミッションが定義され、各パーミッション・セットはアクセス制御のポリシーを指定します。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Quarkus ポリシーサマリー</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>組込ポリシー</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>説明</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><code>deny</code></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">このポリシーは、すべてのユーザーを拒否します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><code>permit</code></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">このポリシーは、すべてのユーザーを許可します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><code>authenticated</code></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">このポリシーは、認証されたユーザーのみを許可します。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>指定したロールを持つユーザーにリソースへのアクセスを許可するロールベースのポリシーを定義することができます。</p>
</div>
<div class="listingblock">
<div class="title">ロールベースポリシーの例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.http.auth.policy.role-policy1.roles-allowed=user,admin                  <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This defines a role-based policy that allows users with the <code>user</code> and <code>admin</code> roles.
Such a custom policy can be referenced by permission sets just like the built-in ones, as shown in the example below.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>パーミッションセットは、 <code>application.properties</code> に以下のように定義されています:</p>
</div>
<div class="listingblock">
<div class="title">ポリシーの設定例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.http.auth.permission.permit1.paths=/public/*                            <i class="conum" data-value="1"></i><b>(1)</b>
quarkus.http.auth.permission.permit1.policy=permit
quarkus.http.auth.permission.permit1.methods=GET

quarkus.http.auth.permission.deny1.paths=/forbidden                             <i class="conum" data-value="2"></i><b>(2)</b>
quarkus.http.auth.permission.deny1.policy=deny

quarkus.http.auth.permission.roles1.paths=/roles-secured/*,/other/*,/api/*      <i class="conum" data-value="3"></i><b>(3)</b>
quarkus.http.auth.permission.roles1.policy=role-policy1</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This permission references the default <code>permit</code> built-in policy to allow <code>GET</code> methods to <code>/public</code>.
In this case, the demonstrated setting would not affect this example because this request is allowed anyway.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>このパーミッションは <code>/forbidden</code> に対する組み込みの <code>deny</code> ポリシーを参照します。これは <code>*</code> で終わらないので、完全なパスマッチとなります。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This is a permission set that references the previously defined policy.
<code>roles1</code> is an example name; you can call the permission sets whatever you want.</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="matching-on-paths-and-methods"><a class="anchor" href="#matching-on-paths-and-methods"></a>パスとメソッドのマッチング</h3>
<div class="paragraph">
<p>Permission sets can also specify paths and methods as a comma-separated list.
If a path ends with the <code>*</code> wildcard, the query it generates matches all sub-paths.
Otherwise, it queries for an exact match and will only match that specific path:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.http.auth.permission.permit1.paths=/public/*,/css/*,/js/*,/robots.txt
quarkus.http.auth.permission.permit1.policy=permit
quarkus.http.auth.permission.permit1.methods=GET,HEAD</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="matching-a-path-but-not-a-method"><a class="anchor" href="#matching-a-path-but-not-a-method"></a>パスはマッチするがメソッドはマッチしない場合</h3>
<div class="paragraph">
<p>リクエストがパスに基づいて1つ以上のパーミッションセットにマッチするが、 メソッドの要件によりマッチしない場合、そのリクエストは拒否されます。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Given the above permission set, <code>GET /public/foo</code> would match both the path and method and thus be allowed,
whereas <code>POST /public/foo</code> would match the path but not the method and would therefore be rejected.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="matching-multiple-paths-longest-path-wins"><a class="anchor" href="#matching-multiple-paths-longest-path-wins"></a>複数のパスのマッチング:一番長いパスが勝ちます。</h3>
<div class="paragraph">
<p>マッチングは常にロンゲストパス に基づいて行われ、より具体的なパーミッションセットがマッチした場合、それより具体的でないパーミッションセットは考慮されません。:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.http.auth.permission.permit1.paths=/public/*
quarkus.http.auth.permission.permit1.policy=permit
quarkus.http.auth.permission.permit1.methods=GET,HEAD

quarkus.http.auth.permission.deny1.paths=/public/forbidden-folder/*
quarkus.http.auth.permission.deny1.policy=deny</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Given the above permission set, <code>GET /public/forbidden-folder/foo</code> would match both permission sets' paths,
but because it matches the <code>deny1</code> permission set&#8217;s path on a longer match, <code>deny1</code> will be chosen, and the request will
be rejected.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Subpath permissions always win against the root path permissions, as explained above in the <code>deny1</code> versus <code>permit1</code> permission example.
Here is another example showing subpath permission allowing a public resource access with the root path permission requiring the authorization:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.http.auth.policy.user-policy.roles-allowed=user
quarkus.http.auth.permission.roles.paths=/api/*
quarkus.http.auth.permission.roles.policy=user-policy

quarkus.http.auth.permission.public.paths=/api/noauth/*
quarkus.http.auth.permission.public.policy=permit</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="matching-multiple-paths-most-specific-method-wins"><a class="anchor" href="#matching-multiple-paths-most-specific-method-wins"></a>複数のパスのマッチング:一番具体的なパスが勝ちます</h3>
<div class="paragraph">
<p>When a path is registered with multiple permission sets,
the permission sets that explicitly specify an HTTP method that matches the request will take precedence.
In this instance, the permission sets without methods will only come into effect if the request method does not match permission sets with the method specification.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.http.auth.permission.permit1.paths=/public/*
quarkus.http.auth.permission.permit1.policy=permit
quarkus.http.auth.permission.permit1.methods=GET,HEAD

quarkus.http.auth.permission.deny1.paths=/public/*
quarkus.http.auth.permission.deny1.policy=deny</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>上記のパーミッション・セットの場合、 <code>GET /public/foo</code> は両方のパーミッション・セットのパスに合致しますが、 <code>permit1</code> のパーミッション・セットの明示的な方法に合致するため、 <code>permit1</code> が選択され、リクエストは受理されます。</p>
</div>
<div class="paragraph">
<p>一方、 <code>PUT /public/foo</code> <code>permit1</code> のメソッドパーミッションと一致しないため、 <code>deny1</code> が有効化され、リクエストが拒否されます。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="matching-multiple-paths-and-methods-both-win"><a class="anchor" href="#matching-multiple-paths-and-methods-both-win"></a>複数のパスのマッチング:一番長いパスが勝ちます</h3>
<div class="paragraph">
<p>Sometimes, the previously described rules allow multiple permission sets to win at the same time.
In that case, for the request to proceed, all the permissions must allow access.
Note that for this to happen, both have to either have specified the method or have no method. Method-specific matches take precedence.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.http.auth.policy.user-policy1.roles-allowed=user
quarkus.http.auth.policy.admin-policy1.roles-allowed=admin

quarkus.http.auth.permission.roles1.paths=/api/*,/restricted/*
quarkus.http.auth.permission.roles1.policy=user-policy1

quarkus.http.auth.permission.roles2.paths=/api/*,/admin/*
quarkus.http.auth.permission.roles2.policy=admin-policy1</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
上記のパーミッションセットの場合、 <code>GET /api/foo</code> は両方のパーミッションセットのパスにマッチするので、 <code>user</code> と <code>admin</code> の両方のロールが必要になります。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="configuration-properties-to-deny-access"><a class="anchor" href="#configuration-properties-to-deny-access"></a>アクセスを拒否するための設定プロパティ</h3>
<div class="paragraph">
<p>以下の設定により、ロールベースアクセスコントロール（RBAC）の拒否動作が変更されます:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>quarkus.security.jaxrs.deny-unannotated-endpoints=true|false</code></dt>
<dd>
<p>If set to true, access is denied for all JAX-RS endpoints by default. If a JAX-RS endpoint does not have any security annotations, it defaults to the <code>@DenyAll</code> behavior.
This is useful to ensure you cannot accidentally expose an endpoint that is supposed to be secured.
Defaults to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>quarkus.security.jaxrs.default-roles-allowed=role1,role2</code></dt>
<dd>
<p>Defines the default role requirements for unannotated endpoints.
The <code>**</code>  role is a special role that means any authenticated user.
This cannot be combined with <code>deny-unannotated-endpoints</code>, as <code>deny</code> takes the effect instead.</p>
</dd>
<dt class="hdlist1"><code>quarkus.security.deny-unannotated-members=true|false</code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>この値をtrue に設定すると、セキュリティアノテーションを持つメソッドを含むクラスで定義されているものの、セキュリティアノテーションを持たないすべての CDI メソッドと JAX-RS エンドポイントへのアクセスが拒否されるようになります。デフォルトは <code>false</code> です。</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="disabling-permissions"><a class="anchor" href="#disabling-permissions"></a>パーミッションの無効化</h3>
<div class="paragraph">
<p>パーミッションは、宣言された各パーミッションの <code>enabled</code> プロパティを使って、ビルド時に次のように無効にすることができます：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.http.auth.permission.permit1.enabled=false
quarkus.http.auth.permission.permit1.paths=/public/*,/css/*,/js/*,/robots.txt
quarkus.http.auth.permission.permit1.policy=permit
quarkus.http.auth.permission.permit1.methods=GET,HEAD</code></pre>
</div>
</div>
<div class="paragraph">
<p>パーミッションは、システムプロパティや環境変数を使って実行時に再有効化することができます（例えば、以下のように）: <code>-Dquarkus.http.auth.permission.permit1.enabled=true</code> .</p>
</div>
</div>
<div class="sect2">
<h3 id="permission-paths-and-http-root-path"><a class="anchor" href="#permission-paths-and-http-root-path"></a>パーミッションパスとHTTPルートパス</h3>
<div class="paragraph">
<p><code>quarkus.http.root-path</code> 設定プロパティは、 <a href="http-reference.html#context-path">http エンドポイントコンテキストパス</a> を変更するために使用されます。</p>
</div>
<div class="paragraph">
<p>デフォルトでは、設定されたパーミッションのパスの前に自動的に <code>quarkus.http.root-path</code> 、フォワードスラッシュを使用しない場合などです。 :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.http.auth.permission.permit1.paths=public/*,css/*,js/*,robots.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>この構成は以下に相当します。 :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.http.auth.permission.permit1.paths=${quarkus.http.root-path}/public/*,${quarkus.http.root-path}/css/*,${quarkus.http.root-path}/js/*,${quarkus.http.root-path}/robots.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>先頭のスラッシュは、設定されたパーミッションのパスの解釈方法を変更します。設定されたURLはそのまま使用され、 <code>quarkus.http.root-path</code> の値が変更されても、パスは調整されません。例えば下記の形です。 :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.http.auth.permission.permit1.paths=/public/*,css/*,js/*,robots.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>この設定は、固定/静的URL <code>/public</code> から提供されるリソースにのみ影響します。 <code>quarkus.http.root-path</code> が <code>/</code> 以外に設定されている場合、アプリケーションリソースと一致しない可能性があります。</p>
</div>
<div class="paragraph">
<p>詳細については、 <a href="https://quarkus.io/blog/path-resolution-in-quarkus/">Quarkusのパス解決</a> を参照してください。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="standard-security-annotations"><a class="anchor" href="#standard-security-annotations"></a>アノテーションを使った認可</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus comes with built-in security to allow for Role-Based Access Control (<a href="https://en.wikipedia.org/wiki/Role-based_access_control">RBAC</a>)
based on the common security annotations <code>@RolesAllowed</code>, <code>@DenyAll</code>, <code>@PermitAll</code> on REST endpoints and CDI beans.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Quarkus アノテーション型の概要</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>アノテーション型</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>説明</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@DenyAll</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">どのセキュリティロールも指定されたメソッドを呼び出すことを許可されていないことを指定します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@PermitAll</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">すべてのセキュリティロールが指定されたメソッドを呼び出すことを許可されているように指定します。</p>
<p class="tableblock"><code>@PermitAll</code> は未認証含め誰でも許可します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@RolesAllowed</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アプリケーション内のメソッドへのアクセスが許可されているセキュリティロールのリストを指定します。</p>
<p class="tableblock"><code>@RolesAllowed("**")</code> に相当するものとして、Quarkus は、認証されたユーザーがリソースにアクセスできるようにする <code>io.quarkus.security.Authenticated</code> アノテーションも提供します。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a href="#subject-example">SubjectExposingResourceの例</a> featured in this chapter demonstrates an endpoint that uses both JAX-RS and Common Security annotations to describe and secure its endpoints.</p>
</div>
<div id="subject-example" class="listingblock">
<div class="title">SubjectExposingResourceの例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.security.Principal;

import javax.annotation.security.DenyAll;
import javax.annotation.security.PermitAll;
import javax.annotation.security.RolesAllowed;
import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.core.Context;
import javax.ws.rs.core.SecurityContext;

@Path("subject")
public class SubjectExposingResource {

    @GET
    @Path("secured")
    @RolesAllowed("Tester") <i class="conum" data-value="1"></i><b>(1)</b>
    public String getSubjectSecured(@Context SecurityContext sec) {
        Principal user = sec.getUserPrincipal(); <i class="conum" data-value="2"></i><b>(2)</b>
        String name = user != null ? user.getName() : "anonymous";
        return name;
    }

    @GET
    @Path("unsecured")
    @PermitAll <i class="conum" data-value="3"></i><b>(3)</b>
    public String getSubjectUnsecured(@Context SecurityContext sec) {
        Principal user = sec.getUserPrincipal(); <i class="conum" data-value="4"></i><b>(4)</b>
        String name = user != null ? user.getName() : "anonymous";
        return name;
    }

    @GET
    @Path("denied")
    @DenyAll <i class="conum" data-value="5"></i><b>(5)</b>
    public String getSubjectDenied(@Context SecurityContext sec) {
        Principal user = sec.getUserPrincipal();
        String name = user != null ? user.getName() : "anonymous";
        return name;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>/subject/secured</code> エンドポイントは、 <code>@RolesAllowed("Tester")</code> アノテーションを使用して"Tester"というロールを付与された認証済みユーザーが必要です。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>エンドポイントは、JAX-RS <code>SecurityContext</code> からユーザー・プリンシパルを取得します。これは、保護されたエンドポイントの場合は非 null になります。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>/subject/unsecured</code> エンドポイントでは、 <code>@PermitAll</code> アノテーションを指定することで、認証されていないアクセスが可能になります。</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>ユーザープリンシパルを取得するためのこの呼び出しは、呼び出し元が認証されていない場合はnullを返し、呼び出し元が認証されている場合は非nullを返します。</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>/subject/denied</code> エンドポイントは、 <code>@DenyAll</code> アノテーションを宣言しているため、呼び出すユーザーに関係なく、REST メソッドとして直接アクセスすることはすべて禁止されています。このメソッドは、このクラスの他のメソッドから内部的に呼び出すことは可能です。</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Please refer to the <a href="security-built-in-authentication-support-concept#proactive-authentication">Proactive Authentication</a> section of the Built-In Authentication Support guide if you plan to use standard security annotations on the IO thread.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>@RolesAllowed</code> annotation value supports <a href="config-reference#property-expressions">Property Expressions</a> including default values and nested Property Expressions.
Configuration properties used with the annotation are resolved at runtime.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. アノテーション値の例</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>アノテーション</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>値の説明</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><code>@RolesAllowed("${admin-role}")</code></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">エンドポイントは、 <code>admin-role</code> プロパティの値で示されるロールを持つユーザーを許可します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><code>@RolesAllowed("${tester.group}-${tester.role}")</code></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">値が複数の変数を含むことができることを示す例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><code>@RolesAllowed("${customer:User}")</code></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デフォルト値の実証。
必要な役割は <code>customer</code> プロパティの値で示されますが、そのプロパティが指定されていない場合、 <code>User</code> という名前のロールがデフォルトとして要求されます。</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title"><code>@RolesAllowed</code> アノテーションにおけるプロパティ式の使用例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">admin=Administrator
tester.group=Software
tester.role=Tester
%prod.secured=User
%dev.secured=**</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.security.Principal;

import javax.annotation.security.DenyAll;
import javax.annotation.security.PermitAll;
import javax.annotation.security.RolesAllowed;
import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.core.Context;
import javax.ws.rs.core.SecurityContext;

@Path("subject")
public class SubjectExposingResource {

    @GET
    @Path("admin")
    @RolesAllowed("${admin}") <i class="conum" data-value="1"></i><b>(1)</b>
    public String getSubjectSecuredAdmin(@Context SecurityContext sec) {
        Principal user = sec.getUserPrincipal();
        String name = user != null ? user.getName() : "anonymous";
        return name;
    }

    @GET
    @Path("software-tester")
    @RolesAllowed("${tester.group}-${tester.role}") <i class="conum" data-value="2"></i><b>(2)</b>
    public String getSubjectSoftwareTester(@Context SecurityContext sec) {
        Principal user = sec.getUserPrincipal();
        String name = user != null ? user.getName() : "anonymous";
        return name;
    }

    @GET
    @Path("user")
    @RolesAllowed("${customer:User}") <i class="conum" data-value="3"></i><b>(3)</b>
    public String getSubjectUser(@Context SecurityContext sec) {
        Principal user = sec.getUserPrincipal();
        String name = user != null ? user.getName() : "anonymous";
        return name;
    }

    @GET
    @Path("secured")
    @RolesAllowed("${secured}") <i class="conum" data-value="4"></i><b>(4)</b>
    public String getSubjectSecured(@Context SecurityContext sec) {
        Principal user = sec.getUserPrincipal();
        String name = user != null ? user.getName() : "anonymous";
        return name;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@RolesAllowed</code> アノテーション値は、 <code>Administrator</code> の値に設定されています。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This <code>/subject/software-tester</code> endpoint requires an authenticated user that has been granted the role "Software-Tester".
It is possible to use multiple expressions in the role definition.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>設定プロパティ <code>customer</code> を設定していないため、 <code>@RolesAllowed("${customer:User}")</code> アノテーションの使用によって、この <code>/subject/user</code> エンドポイントには"User"というロールを付与された認証ユーザーが必要です。</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>この <code>/subject/secured</code> エンドポイントは、本番環境では <code>User</code> のロールを与えられた認証ユーザーが必要ですが、開発モードではどのような認証ユーザーでも許可されます。</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="references"><a class="anchor" href="#references"></a>参照</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="security-overview-concept">Quarkus Security 概要</a></p>
</li>
</ul>
</div>
</div>
</div>
    </div>
    <div class="grid__item width-4-12 width-12-12-m tocwrapper">
      <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#authorization-using-configuration">設定を利用した認可</a>
<ul class="sectlevel2">
<li><a href="#matching-on-paths-and-methods">パスとメソッドのマッチング</a></li>
<li><a href="#matching-a-path-but-not-a-method">パスはマッチするがメソッドはマッチしない場合</a></li>
<li><a href="#matching-multiple-paths-longest-path-wins">複数のパスのマッチング:一番長いパスが勝ちます。</a></li>
<li><a href="#matching-multiple-paths-most-specific-method-wins">複数のパスのマッチング:一番具体的なパスが勝ちます</a></li>
<li><a href="#matching-multiple-paths-and-methods-both-win">複数のパスのマッチング:一番長いパスが勝ちます</a></li>
<li><a href="#configuration-properties-to-deny-access">アクセスを拒否するための設定プロパティ</a></li>
<li><a href="#disabling-permissions">パーミッションの無効化</a></li>
<li><a href="#permission-paths-and-http-root-path">パーミッションパスとHTTPルートパス</a></li>
</ul>
</li>
<li><a href="#standard-security-annotations">アノテーションを使った認可</a></li>
<li><a href="#references">参照</a></li>
</ul></div>
    </div>
  </div>
  </div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license. <i class='fab fa-creative-commons'></i><i class='fab fa-creative-commons-by'></i> <a href='https://creativecommons.org/licenses/by/3.0/' target='_blank'>CC by 3.0</a><br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>ナビゲーション</span>
        <ul class="footer-links">
          
          
            <li><a href="/" target="_blank">ホーム</a></li>
          
          
          
            <li><a href="/about" target="_blank">Quarkusについて</a></li>
          
          
          
            <li><a href="/blog" target="_blank">ブログ</a></li>
          
          
          
            <li><a href="/insights" target="_blank">ポッドキャスト</a></li>
          
          
          
            <li><a href="/events" target="_blank">イベント</a></li>
          
          
          
            <li><a href="/newsletter" target="_blank">ニュースレター</a></li>
          
          
          
            <li><a href="/userstories" target="_blank">ユーザーストーリー</a></li>
          
          
          
            <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" target="_blank">ロードマップ</a></li>
          
          
          
            <li><a href="/security" target="_blank">セキュリティ&nbsp;ポリシー</a></li>
          
          
          
            <li><a href="/usage" target="_blank">使用方法</a></li>
          
          
          
            <li><a href="/brand" target="_blank">Brand</a></li>
          
          
          
            <li><a href="/desktopwallpapers" target="_blank">Wallpapers</a></li>
          
          
          
            <li><a href="https://www.redhat.com/en/about/privacy-policy" target="_blank">Privacy Policy</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>フォローする</span>
        <ul class="footer-links">
          
          
            <li><a href="https://x.com/quarkusio" target="_blank">X</a></li>
          
          
          
            <li><a href="https://bsky.app/profile/quarkus.io" target="_blank">Bluesky</a></li>
          
          
          
            <li><a rel="me" href="https://fosstodon.org/@quarkusio" target="_blank">Mastodon</a></li>
            
          
          
            <li><a href="https://www.threads.com/@quarkusio" target="_blank">Threads</a></li>
          
          
          
            <li><a href="https://www.facebook.com/quarkusio" target="_blank">Facebook</a></li>
          
          
          
            <li><a href="https://www.linkedin.com/company/quarkusio/" target="_blank">Linkedin</a></li>
          
          
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg" target="_blank">Youtube</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio" target="_blank">GitHub</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>ヘルプ</span>
        <ul class="footer-links">
          
          
            <li><a href="/support" target="_blank">サポート</a></li>
          
          
          
            <li><a href="/guides" target="_blank">ガイド</a></li>
          
          
          
            <li><a href="/faq" target="_blank">FAQ</a></li>
          
          
          
            <li><a href="/get-started" target="_blank">入門</a></li>
          
          
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus" target="_blank">Stack Overflow</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions" target="_blank">ディスカッション</a></li>
          
          
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev" target="_blank">開発メーリングリスト</a></li>
          
          
          
            <li><a href="https://stats.uptimerobot.com/ze1PfweT2p" target="_blank">Quarkus Service Status</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>言語</span>
        <ul class="footer-links">
          
          
            <li><a href=" https://quarkus.io/ " target="_blank">English</a></li>
          
          
          
            <li><a href="https://pt.quarkus.io/" target="_blank">Português&nbsp;(Brasileiro)</a></li>
          
          
          
            <li><a href=" https://es.quarkus.io/ " target="_blank">Español</a></li>
          
          
          
            <li><a href="https://cn.quarkus.io/" target="_blank">简体中文</a></li>
          
          
          
            <li><a href=" https://ja.quarkus.io/ " target="_blank">日本語</a></li>
          
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkusはコミュニティプロジェクトで構成されています</span>
        <ul class="footer-links">
          
            <li><a blah href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a blah href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a blah href="https://hibernate.org" target="_blank">Hibernate ORM</a></li>
          
            <li><a blah href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a blah href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a blah href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a blah href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a blah href="https://code.quarkus.io/" target="_blank">その他多数...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content cf-footer">
  <div class="flexcontainer">
    <div class="cf-logo">
      <a class="cf-logo" href="https://www.commonhaus.org/" target="_blank"><img src="https://raw.githubusercontent.com/commonhaus/artwork/main/foundation/brand/svg/CF_logo_horizontal_single_reverse.svg"/></a>
    </div>
    <div class="license">
      Copyright © Quarkus. All rights reserved. For details on our trademarks, please visit our <a href="https://www.commonhaus.org/policies/trademark-policy/">Trademark Policy</a> and <a href="https://www.commonhaus.org/trademarks/">Trademark List</a>. Trademarks of third parties are owned by their respective holders and their mention here does not suggest any endorsement or association.
    </div>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
  <script src="/assets/javascript/future-date.js" type="text/javascript"></script>
  <script src="/assets/javascript/randomize.js" type="text/javascript"></script>
  <script src="/assets/javascript/time.js" type="text/javascript"></script>
</body>

</html>
