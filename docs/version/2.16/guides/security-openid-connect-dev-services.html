<!DOCTYPE html>
<html lang="ja">







<head>
  <title>OpenID Connect (OIDC) の開発サービスおよび UI - 2.16 - Quarkus</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="
  connect-src 'self' https://dpm.demdex.net https://adobedc.demdex.net https://analytics.ossupstream.org/ https://search.quarkus.io https://smetrics.redhat.com https://ajax.googleapis.com; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval'
      
      https://assets.adobedtm.com
      js.bizographics.com
      https://www.redhat.com
      https://static.redhat.com
      https://app.requestly.io/
      jsonip.com
      https://ajax.googleapis.com
      https://use.fontawesome.com
      http://www.youtube.com
      http://www.googleadservices.com
      https://googleads.g.doubleclick.net
      https://giscus.app
      https://analytics.ossupstream.org/
      https://app.mailjet.com;

  style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; 
  img-src 'self' * data:; 
  media-src 'self'; 
  frame-src https://redhat.demdex.net https://www.youtube.com https://player.restream.io https://app.mailjet.com http://xy0p2.mjt.lu https://mj.quarkus.io https://giscus.app; 
  base-uri 'none'; 
  object-src 'none'; 
  form-action 'none'; 
  font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />

  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/version/2.16/guides/security-openid-connect-dev-services" />
  <meta property="og:title" content="OpenID Connect (OIDC) の開発サービスおよび UI - 2.16" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/security-openid-connect-dev-services">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
  
  
  
  
  <link rel="alternate" hreflang="x-default" href="https://quarkus.io/" />  
  <script src="/assets/javascript/tracking.js"></script>
  
  <script src="/assets/javascript/colormode.js" type="text/javascript"></script>

</head>

<body class="guides">

  


<div class="grid-wrapper communitysite">
  <div class="grid__item width-12-12">The <a href="https://quarkus.io/version/2.16/guides/security-openid-connect-dev-services">English version of quarkus.io</a> is the official project site. Translated sites are community supported on a best-effort basis.</div>
</div>


  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
        <div class="logo-wrapper">
           <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
        </div>
    <label class="nav-toggle" for="checkbox"> <i class="fa fa-bars"></i>
</label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="#">Why<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">QUARKUSとは何か?</a></li>
          <li><a href="/developer-joy" class="">開発者満足</a></li>
          <li><a href="/performance" class="">パフォーマンス</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">標準</a></li>
          <li><a href="/versatility" class="">多用途性</a></li>
          <li><a href="/container-first" class="">コンテナ・ファースト</a></li>
          <li><a href="/spring" class="">USING SPRING?</a></li>
          <li class="tertiarydropdown">
            <span href="#">AI<i class="fas fa-chevron-down"></i></span>
            <ul class="tertiarymenu">
              <li><a href="/ai" class="">AI OVERVIEW</a></li>
              <li><a href="/java-for-ai" class="">JAVA FOR AI</a></li>
              <li><a href="/quarkus-for-ai" class="">WHY QUARKUS FOR AI</a></li>
              <li><a href="/ai-blueprints" class="">AI BLUEPRINTS</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="#">Learn<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">入門</a></li>
          <li><a href="/guides" class="active">ドキュメント</a></li>
          <li><a href="/userstories/" class="">ユーザーストーリー</a></li>  
          <li><a href="/qtips" class="">"Q" Tipsビデオ</a></li>          
          <li><a href="/books" class="">書籍</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="#">Extensions<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          
          <!-- Note that quarkus.io is hardcoded here, because it is the only url which supports extensions -->
<li><a href="https://quarkus.io/extensions/" class="">エクステンションを探す</a></li>
          <li><a href="/faq/#what-is-a-quarkus-extension" class="">エクステンションの使用</a></li>
          <li><a href="/guides/writing-extensions" class="">エクステンションの作成</a></li>
          <li><a href="https://hub.quarkiverse.io" class="">エクステンションの共有</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="#">Community<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">サポート</a></li>
          <li><a href="/blog" class="">ブログ</a></li>
          <li><a href="/discussion" class="">ディスカッション</a></li>
          <li><a href="/working-groups" class="">ワーキンググループ</a></li>
          <li><a href="/insights" class="">ポッドキャスト</a></li>
          <li><a href="/events" class="">イベント</a></li>
          <li><a href="/newsletter" class="">ニュースレター</a></li>
          <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" class="">ロードマップ</a></li>
          <li><a href="/benefactors" class="">BENEFACTORS</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary
white">コーディングを開始</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/version/2.16/guides/security-openid-connect-dev-services" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://pt.quarkus.io/version/2.16/guides/security-openid-connect-dev-services">ポルトガル（BR）</a></li>
          <li><a href="https://es.quarkus.io/version/2.16/guides/security-openid-connect-dev-services">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/version/2.16/guides/security-openid-connect-dev-services">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/version/2.16/guides/security-openid-connect-dev-services">日本語</a></li>
          </ul>
      </li>
      <li>
        <span href="#" class="modeswitcher" id='theme-toggle'><i class="fas
fa-sun"></i><i class="fas fa-moon"></i><i class="fas fa-cog"></i></span>
      </li>
    </ul>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    







<section class="full-width-version-bg flexfilterbar guides">
  <div class="guideflexcontainer">
    <div class="docslink">
      <a class="returnlink" href="/version/2.16/guides/"> Back to Guides</a>
    </div>
    <div class="flexlabel">
      <label>バージョン:</label>
    </div>
    <div class="guidepulldown version">
    <select id="guide-version-dropdown">
      
        
        
        <option value="main" >Main - SNAPSHOT</option>
        
        
        
        <option value="latest" >3.31.3 - Latest</option>
        
        
        
        <option value="3.27" >3.27</option>
        
        
        
        <option value="3.20" >3.20</option>
        
        
        
        <option value="3.15" >3.15</option>
        
        
        
        <option value="3.8" >3.8</option>
        </select>
    </div>
  </div>
</section>

<div class="guide">
  <div class="grid-wrapper">
    <div class="grid__item width-8-12 width-12-12-m">
      
      <h1 class="text-caps">OpenID Connect (OIDC) の開発サービスおよび UI </h1>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>このガイドでは、OpenID Connect（OIDC）のKeycloakプロバイダのDev ServicesとUIを取り上げ、他のOpenID ConnectプロバイダのDevサービスとUIをサポートする方法について説明します。また、Quarkusを開発モードで起動する前にすでに開始されているすべてのOpenID ConnectプロバイダのDev UIについても説明しています。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>はじめに</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus は、実験的な <code>Dev Services For Keycloak</code> 機能を導入しています。これは、 <code>quarkus-oidc</code> エクステンションが開発モードで起動され、統合テストがテストモードで実行されている場合にデフォルトで有効になります。ただし、 <code>quarkus.oidc.auth-server-url</code> プロパティが設定されいていない場合に限ります。開発モードかテストモード、あるいはその両方で Keycloak コンテナーを起動し、既存の Keycloak レルムを登録するか、クライアントとユーザーで新しいレルムを作成して初期化することで、Keycloak で保護された Quarkus アプリケーションの開発をすぐに開始します。 <code>application.properties</code> またはレルムファイルの変更が検出されると、コンテナーが再起動します。</p>
</div>
<div class="paragraph">
<p>さらに、 <a href="http://localhost:8080/q/dev">/q/dev</a> で入手可能な <a href="dev-ui">Dev UI</a> は、Dev UI ページでこの機能を補完します。これは、Keycloak からトークンを取得して Quarkus アプリケーションをテストする際に役立ちます。</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.auth-server-url</code> がすでに設定されている場合は、すべての OpenIDConnect プロバイダーで使用できる汎用 OpenIDConnectDevConsole がアクティブ化されます。詳細は <a href="#dev-ui-all-oidc-providers">すべての OpenID Connect プロバイダーの Dev UI</a> を参照してください。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dev-services-for-keycloak"><a class="anchor" href="#dev-services-for-keycloak"></a>Dev Services for Keycloak</h2>
<div class="sectionbody">
<div class="paragraph">
<p>次のコマンドを使用して、 <code>application.properties</code> の <code>quarkus.oidc</code> プロパティーを設定せずにアプリケーションを起動します。</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">コマンドラインインタフェース</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus dev</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw quarkus:dev</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew --console=plain quarkusDev</code></pre>
</div>
</div>
<div class="paragraph">
<p>コンソールには以下のように表示されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">KeyCloak Dev Services Starting:
2021-11-02 17:14:24,864 INFO  [org.tes.con.wai.str.HttpWaitStrategy] (build-10) /unruffled_agnesi: Waiting for 60 seconds for URL: http://localhost:32781 (where port 32781 maps to container port 8080)
2021-11-02 17:14:44,170 INFO  [io.qua.oid.dep.dev.key.KeycloakDevServicesProcessor] (build-10) Dev Services for Keycloak started.</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Keycloak 管理コンソールにログインする場合、ユーザー名は <code>admin</code>、パスワードは <code>admin</code> です。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>デフォルトでは、 <code>Dev Services for Keycloak</code> は <code>quarkus-dev-service-keycloak</code> ラベルの付いたコンテナーを見つけると新しいコンテナーを起動せず、このラベルの値が <code>quarkus.keycloak.devservices.service-name</code> プロパティーの値 (デフォルト値は <code>quarkus</code>) と一致する場合はこれに接続することに注意してください。その場合、以下の実行中はわずかに異なる出力が表示されます。</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">コマンドラインインタフェース</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus dev</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw quarkus:dev</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew --console=plain quarkusDev</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">2021-08-27 18:42:43,530 INFO  [io.qua.dev.com.ContainerLocator] (build-15) Dev Services container found: 48fee151a31ddfe32c39965be8f61108587b25ed2f66cdc18bb926d9e2e570c5 (quay.io/keycloak/keycloak:14.0.0). Connecting to: 0.0.0.0:32797.
2021-08-27 18:42:43,600 INFO  [io.qua.oid.dep.dev.key.KeycloakDevServicesProcessor] (build-15) Dev Services for Keycloak started.
...</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>quarkus.keycloak.devservices.shared=false</code> でコンテナーの共有を無効にできることに注意してください。</p>
</div>
<div class="paragraph">
<p>次に、メインの <a href="http://localhost:8080/q/dev">Dev UI ページ</a> を開くと、 `OpenID Connect Card`が Keycloak のページにリンクしているのが確認できます。</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="./images/dev-ui-oidc-keycloak-card.png" alt="Dev UI OpenID Connect Card">
</div>
</div>
<div class="paragraph">
<p><code>Provider: Keycloak</code> リンクをクリックすると、Keycloak ページが表示されます。このページは、 <code>Dev ServicesforKeycloak</code> 機能がどのように設定されているかによって少し異なります。</p>
</div>
<div class="sect2">
<h3 id="develop-service-applications"><a class="anchor" href="#develop-service-applications"></a>サービスアプリケーションの開発</h3>
<div class="paragraph">
<p>デフォルトでは、Keycloak ページを使用して、<a href="security-openid-connect">Quarkus OIDC サービスアプリケーション</a> の開発をサポートできます。</p>
</div>
<div class="sect3">
<h4 id="keycloak-authorization-code-grant"><a class="anchor" href="#keycloak-authorization-code-grant"></a>認可コード グラント</h4>
<div class="paragraph">
<p><code>application.properties</code> で <code>quarkus.oidc.devui.grant.type=code</code> (デフォルト値) を設定すると、 <code>authorization_code</code> 許可を使用してアクセストークンと ID トークンの両方が取得されます。この許可を使用して、 <code>Single Page Application</code> がトークンを取得し、それらを使用して Quarkus サービスにアクセスする一般的なフローをエミュレートすることをお勧めします。</p>
</div>
<div class="paragraph">
<p>まず、 <code>Log into Single Page Application</code> オプションが表示されます。</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="./images/dev-ui-keycloak-sign-in-to-spa.png" alt="Dev UI OpenID Connect Keycloak Page - Log into Single Page Application">
</div>
</div>
<div class="paragraph">
<p>認証プロセスで使用されるKeycloakレルムとクライアントIDを選択します。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>このSPAは、OpenId Connectのpublicクライアントを表しています。したがって、入力するクライアントIDは、シークレットのないKeycloakのpublicクライアントを指す必要があります。これは、SPAがウェブアプリケーションではないため、認可コードフローを完了するために必要なクライアントシークレットを安全に扱うことができないためです。</p>
</div>
<div class="paragraph">
<p>シークレットが必要なクライアントは、デフォルトのレルムが作成されている場合、または <code>quarkus.oidc.credentials.secret</code> が設定されていて単一のカスタムレルムが使用されている場合にのみ、このSPAでサポートできます。これらの場合、SPA はクライアント シークレットを把握できるためです。 Keycloakがユーザーをリダイレクトした後、認可コードフローを完了する必要がある場合があります。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>次に、 <code>Log into Single Page Application</code> を選択すると、Keycloakにリダイレクトされ、例えば、 <code>alice:alice</code> として認証され、SPAを表すページに戻ります：</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="./images/dev-ui-keycloak-test-service-from-spa.png" alt="Dev UI OpenID Connect Keycloak Single Page Application">
</div>
</div>
<div class="paragraph">
<p>取得したアクセストークンやIDトークンなどを確認することができます。</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="./images/dev-ui-keycloak-decoded-tokens.png" alt="Dev UI OpenID Connect Keycloak Decoded Tokens View">
</div>
</div>
<div class="paragraph">
<p>このビューでは、左側にエンコードされた JWT トークンが表示され、ヘッダー (赤色)、ペイロード/クレーム (緑色)、および署名 (青色) が強調表示されます。また、右側にデコードされた JWT トークンが表示され、ヘッダーとクレームの名前とその値を確認できます。</p>
</div>
<div class="paragraph">
<p>次に、相対サービスパスを入力し、トークンを送信してサービスをテストします。SPAは通常、アプリケーションのエンドポイントにアクセストークンを送信するので、例えば、 <code>Test with Access Token</code> のオプションを選択します：</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="./images/dev-ui-keycloak-test-access-token.png" alt="Dev UI Keycloak Test with access token">
</div>
</div>
<div class="paragraph">
<p>右下の <code>eraser</code> のマークで、テスト結果エリアをクリアすることができます。</p>
</div>
<div class="paragraph">
<p>エンドポイントがSPAに現在ログインしているユーザーを認識するため、または帯域外のトークン検証を実行するために、IDトークンがベアラートークンとしてアプリケーションフロントエンドに転送されることがあります。このような場合は、 <code>Test with ID Token</code> オプションを選択してください。</p>
</div>
<div class="paragraph">
<p>Manually entering the service paths is not ideal, so please see the <a href="#test-with-swagger-graphql">Test with Swagger UI or GraphQL UI</a> section about enabling Swagger or GraphQL UI for testing the service with the access token already acquired by OIDC Dev UI.</p>
</div>
<div class="paragraph">
<p>最後に、ログアウトして別のユーザーとして Keycloak で認証する場合は、 <code>Log Out</code> image::dev-ui-keycloak-logout.png オプションを選択できます。</p>
</div>
<div class="paragraph">
<p>シングルページアプリケーションにログインしようとすると、Keycloak がエラーを返す場合があることに注意してください。たとえば、 <code>quarkus.oidc.client-id</code> が Keycloak にインポートされたレルムのクライアント ID と一致しない場合や、このレルムのクライアントが認可コードフローをサポートするように正しく設定されていない場合などです。このような場合、Keycloak は <code>error_description</code> クエリーパラメーターと <code>DevUI</code> も、このエラーの説明を表示します。以下はその例です。</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="./images/dev-ui-keycloak-login-error.png" alt="Dev UI Keycloak Login Error">
</div>
</div>
<div class="paragraph">
<p>エラーが発生した場合は、 <code>Keycloak Admin</code> オプションを使用して Keycloak にログインし、必要に応じてレルム設定を更新し、 <code>application.properties</code> も確認します。</p>
</div>
<div class="sect4">
<h5 id="test-with-swagger-graphql"><a class="anchor" href="#test-with-swagger-graphql"></a>Swagger UI または GraphQL UI を使用したテスト</h5>
<div class="paragraph">
<p>プロジェクトで <code>quarkus-smallrye-openapi</code> や <code>quarkus-smallrye-graphql</code> が使用されている場合、サービスパスを手動で入力することを避け、 <code>Swagger UI</code> または <code>GraphQL UI</code> を使用してサービスをテストできます。たとえば、 <code>quarkus-smallrye-openapi</code> と <code>quarkus-smallrye-graphql</code> の両方の依存関係を使用して開発モードで Quarkus を起動すると、Keycloak にログインした後に次のオプションが表示されます。</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="./images/dev-ui-keycloak-test-service-swaggerui-graphql.png" alt="Test your service with Swagger UI or GraphQL UI">
</div>
</div>
<div class="paragraph">
<p>例えば、 <code>Swagger UI</code> をクリックすると、新しいブラウザ タブで <code>Swagger UI</code> が開き、Dev UI for Keycloak が取得したトークンを使用してサービスをテストできます。 <code>Swagger UI</code> は再認証を試みません。OIDC Dev UIが認証を行い、Swagger UIがテストに使用するアクセストークンを提供しているため、Swagger UIに入った後は <code>Swagger UI</code> <code>Authorize</code> オプションを選択しないようにしてください。</p>
</div>
<div class="paragraph">
<p><code>GraphQL UI</code> との統合も同様に機能し、Keycloak 用に Dev UI によって取得されたアクセストークンが使用されます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Keycloak は、認証されたユーザーが設定されたリダイレクト URI にのみリダイレクトされるように強制する場合があるため、Keycloak が機能するためには Dev UI によって開始される認可コードフローのリダイレクト URI を登録する必要がある場合があります。認証要求内の正しい <code>redirect_uri</code> パラメーターが操作されると、ユーザーが間違ったエンドポイントにリダイレクトされる可能性があるため、本番環境ではこれを行うことを推奨します。</p>
</div>
<div class="paragraph">
<p>Keycloak がそれを強制する場合は、 <code>redirect_uri</code> 値が間違っていることを通知する認証エラーが表示されます。</p>
</div>
<div class="paragraph">
<p>この場合、右上隅の <code>Keycloak Admin</code> オプションを選択し、 <code>admin:admin</code> としてログインし、Dev UI for Keycloak が設定されているテストレルムとクライアントを選択して、 <code>Valid Redirect URIs</code> に <code><a href="http://localhost:8080/q/dev/io.quarkus.quarkus-oidc/provider" class="bare">http://localhost:8080/q/dev/io.quarkus.quarkus-oidc/provider</a></code> を追加します。Quarkus の起動に <code>-Dquarkus.http.port</code> を使用した場合は、 <code>8080</code> を <code>quarkus.http.port</code> の値に変更します。</p>
</div>
<div class="paragraph">
<p>コンテナーが異なるポートで実行されている複数のアプリケーション間で共有されている場合は、これらのアプリケーションごとに <code>redirect_uri</code> 値を登録する必要があります。</p>
</div>
<div class="paragraph">
<p>特にコンテナーが複数のアプリケーション間で共有されている場合は、テスト目的でのみ <code>redirect_uri</code> 値を <code>*</code> に設定できます。</p>
</div>
<div class="paragraph">
<p>カスタムレルムがインポートされていない場合、 <code>*</code> <code>redirect_uri</code> の値はデフォルトのレルムを作成するときに <code>Dev Services for Keycloak</code> によって設定されます。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="implicit-grant"><a class="anchor" href="#implicit-grant"></a>インプリシット・グラント</h4>
<div class="paragraph">
<p><code>application.properties</code> で <code>quarkus.oidc.devui.grant.type=implicit</code> を設定すると、アクセストークンと ID トークンの両方を取得するために <code>implicit</code> グラントが使用されます。認可コードグラントが機能しない場合に限り (暗示的グラントをサポートするためにクライントが Keycloak に設定されている場合など)、このグラントを使用して <code>Single Page Application</code> をエミュレートします。</p>
</div>
</div>
<div class="sect3">
<h4 id="password-grant"><a class="anchor" href="#password-grant"></a>パスワード・グラント</h4>
<div class="paragraph">
<p><code>application.properties</code> で <code>quarkus.oidc.devui.grant.type=password</code> を設定すると、次のような画面が表示されます。</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="./images/dev-ui-keycloak-password-grant.png" alt="Dev UI OpenID Connect Keycloak Page - Password Grant">
</div>
</div>
<div class="paragraph">
<p>レルムを選択し、クライアントIDとシークレット、ユーザー名とユーザーパスワード、サービスのエンドポイントの相対パスを入力し、 <code>Test Service</code> をクリックすると、 <code>200 `, `403 `, `401</code> または <code>404</code> のようなステータスコードが表示されます。ユーザー名とパスワードを含む <code>quarkus.keycloak.devservices.users</code> マッププロパティにユーザー名も設定されている場合は、サービスをテストする際にパスワードを設定する必要はありません。ただし、パスワードグラントを使用してサービスをテストするために、 <code>quarkus.keycloak.devservices.users</code> を初期化する必要はないことに注意してください。</p>
</div>
<div class="paragraph">
<p>また、Dev UI コンソールには以下のように表示されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">2021-07-19 17:58:11,407 INFO  [io.qua.oid.dep.dev.key.KeycloakDevConsolePostHandler] (security-openid-connect-quickstart-dev.jar) (DEV Console action) Using password grant to get a token from 'http://localhost:32818/realms/quarkus/protocol/openid-connect/token' for user 'alice' in realm 'quarkus' with client id 'quarkus-app'
2021-07-19 17:58:11,533 INFO  [io.qua.oid.dep.dev.key.KeycloakDevConsolePostHandler] (security-openid-connect-quickstart-dev.jar) (DEV Console action) Test token: eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJ6Z2tDazJQZ1JaYnVlVG5kcTFKSW1sVnNoZ2hhbWhtbnBNcXU0QUt5MnJBIn0.ey...
2021-07-19 17:58:11,536 INFO  [io.qua.oid.dep.dev.key.KeycloakDevConsolePostHandler] (security-openid-connect-quickstart-dev.jar) (DEV Console action) Sending token to 'http://localhost:8080/api/admin'
2021-07-19 17:58:11,674 INFO  [io.qua.oid.dep.dev.key.KeycloakDevConsolePostHandler] (security-openid-connect-quickstart-dev.jar) (DEV Console action) Result: 200</code></pre>
</div>
</div>
<div class="paragraph">
<p>トークンは <code>password</code> グラントを使用して Keycloak から取得され、サービスエンドポイントに送信されます。</p>
</div>
</div>
<div class="sect3">
<h4 id="client-credentials-grant"><a class="anchor" href="#client-credentials-grant"></a>クライアントクレデンシャル・グラント</h4>
<div class="paragraph">
<p><code>quarkus.oidc.devui.grant.type=client</code> を設定すると、トークンの取得に <code>client_credentials</code> グラントが使用されます。この場合、ページに <code>User</code> フィールドは表示されません。</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="./images/dev-ui-keycloak-client-credentials-grant.png" alt="Dev UI OpenID Connect Keycloak Page - Client Credentials Grant">
</div>
</div>
<div class="paragraph">
<p>レルムを選択し、クライアントIDとシークレット、相対サービスエンドポイントパスを入力し、 <code>Test Service</code> をクリックすると、 <code>200 `, `403 `, `401</code> または <code>404</code> のようなステータスコードが出力されます。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="develop-web-app-applications"><a class="anchor" href="#develop-web-app-applications"></a>OpenID Connect Web アプリケーションの開発</h3>
<div class="paragraph">
<p><a href="security-openid-connect-web-authentication">Quarkus OIDC web-app アプリケーション</a> を開発する場合は、アプリケーションを開始する前に <code>application.properties</code> で <code>quarkus.oidc.application-type=web-app</code> を設定する必要があります。</p>
</div>
<div class="paragraph">
<p>次のような画面が表示されます。</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="./images/dev-ui-keycloak-sign-in-to-service.png" alt="Dev UI OpenID Connect Keycloak Sign In">
</div>
</div>
<div class="paragraph">
<p>相対的なサービスエンドポイントパスを設定し、 <code>Sign In To Service</code> をクリックすると Keycloak にリダイレクトされます。新しいブラウザータブにユーザー名とパスワードを入力し、Quarkus アプリケーションからレスポンスを取得します。</p>
</div>
<div class="paragraph">
<p>この場合、Dev UI は認可コードフローを制御してトークンを取得する Quarkus OIDC の <code>web-app</code> アプリケーションであるため、開発エクスペリエンスを充実させるものではないことに注意してください。</p>
</div>
<div class="paragraph">
<p>Dev UI が OIDC <code>web-app</code> アプリケーションの開発をより便利にサポートできるようにするために、 <code>quarkus.oidc.application-type</code> のプロファイル固有値を設定することを検討してください。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">%prod.quarkus.oidc.application-type=web-app
%test.quarkus.oidc.application-type=web-app
%dev.quarkus.oidc.application-type=service</code></pre>
</div>
</div>
<div class="paragraph">
<p>これにより、開発モードで <code>web-app</code> アプリケーションが実行されている際に、<a href="#develop-service-applications">Developing OpenID Connect Service Applications</a> で説明されているすべての Dev UI オプションが確実に使用可能なります。このアプローチの制限は、コードフローで返され、Dev UI で取得されたアクセストークンと ID トークンの両方が、HTTP <code>Bearer</code> トークンとしてエンドポイントに送信されることです。これは、エンドポイントで <code>IdToken</code> の挿入が必要な場合はうまく機能しません。ただし、 <code>web-app</code> アプリケーションがアクセストークンのみを使用する場合 (たとえばロールのソースとして、または <code>UserInfo</code> の取得に)、devmode の <code>service</code> アプリケーションであると想定される場合でも期待どおり機能します。</p>
</div>
<div class="paragraph">
<p>さらに良いオプションは、devmode で「ハイブリッド」アプリケーション タイプを使用することです:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">%prod.quarkus.oidc.application-type=web-app
%test.quarkus.oidc.application-type=web-app
%dev.quarkus.oidc.application-type=hybrid</code></pre>
</div>
</div>
<div class="paragraph">
<p>これにより、OIDC DevUI を使用せずにブラウザーから開発モードでアプリケーションにアクセスすると、Quarkus OIDC もプロダクション モードと同様に認可コード フローを実行するようになります。 しかし、 <code>hybrid</code> アプリケーションはベアラー アクセス トークンも受け入れることができるため、OIDC DevUI もより便利になります。</p>
</div>
</div>
<div class="sect2">
<h3 id="running-the-tests"><a class="anchor" href="#running-the-tests"></a>テストの実行</h3>
<div class="paragraph">
<p>テストモードで起動した Keycloak コンテナーに対して、<a href="continuous-testing">継続的テスト</a> モードでテストを実行できます。</p>
</div>
<div class="paragraph">
<p>また、 <code>Dev Services for Keycloak</code> を使用して、Keycloak に対して統合テストを実行することをお勧めします。詳細は、<a href="security-openid-connect#integration-testing-keycloak-devservices">Dev Services を使用した OpenID Connect サービスアプリケーションのテスト</a> および <a href="security-openid-connect-web-authentication#integration-testing-keycloak-devservices">Dev Services を使用した OpenID Connect WebApp アプリケーションのテスト</a> を参照してください。</p>
</div>
</div>
<div class="sect2">
<h3 id="keycloak-initialization"><a class="anchor" href="#keycloak-initialization"></a>Keycloak 初期化</h3>
<div class="paragraph">
<p>The <code>quay.io/keycloak/keycloak:21.0.1</code> image which contains a Keycloak distribution powered by Quarkus is used to start a container by default.
<code>quarkus.keycloak.devservices.image-name</code> can be used to change the Keycloak image name. For example, set it to <code>quay.io/keycloak/keycloak:19.0.3-legacy</code> to use a Keycloak distribution powered by WildFly.
Note that only a Quarkus based Keycloak distribution is available starting from Keycloak <code>20.0.0</code>.</p>
</div>
<div class="paragraph">
<p><code>Dev Services for Keycloak</code> は、起動された Keycloak サーバーを次に初期化します。</p>
</div>
<div class="paragraph">
<p>デフォルトでは、 <code>quarkus</code>、 <code>secret</code> パスワードを持つ <code>quarkus-app</code> クライアント、 <code>alice</code> および <code>bob</code> ユーザー (名前と一致するパスワードを持つ)、 <code>user</code> および <code>admin</code> ロールが作成されます。このとき、 <code>alice</code> には <code>admin</code> と <code>user</code> の両方のロールが与えられ、 <code>bob</code> には <code>user</code> のロールが与えられます。</p>
</div>
<div class="paragraph">
<p>ユーザー名、シークレット、およびそれらのロールは、 <code>quarkus.keycloak.devservices.users</code> (ユーザー名とシークレットを含むマップ) および <code>quarkus.keycloak.devservices.roles</code> (ユーザー名とコンマ区切りのロール値を含むマップ) でカスタマイズできます。</p>
</div>
<div class="paragraph">
<p>例えば、以下のようになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">%dev.quarkus.keycloak.devservices.users.duke=dukePassword
%dev.quarkus.keycloak.devservices.roles.duke=reader
%dev.quarkus.keycloak.devservices.users.john=johnPassword
%dev.quarkus.keycloak.devservices.roles.john=reader,writer</code></pre>
</div>
</div>
<div class="paragraph">
<p>この設定により、2人のユーザーが作成されます:
* <code>dukePassword</code> パスワードと <code>reader</code> ロールを持つ <code>duke</code> 
* <code>johnPassword</code> パスワードと <code>reader</code> および <code>writer</code> ロールを持つ <code>john</code></p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.client-id</code> と <code>quarkus.oidc.credentials.secret</code> を使用して、クライアント ID とシークレットをカスタマイズできます。</p>
</div>
<div class="paragraph">
<p>ただし、Keycloak の設定はこれよりも複雑で、より多くのプロパティーを設定する必要があると思われます。</p>
</div>
<div class="paragraph">
<p>このため、デフォルトまたは設定されたレルム、クライアント、ユーザー、ロールのプロパティでKeycloakを初期化しようとする前に、 <code>quarkus.keycloak.devservices.realm-path</code> が常に最初にチェックされます。realmファイルがファイルシステムまたはクラスパスに存在する場合、このrealmだけがKeycloakを初期化するために使用されます。例:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.keycloak.devservices.realm-path=quarkus-realm.json</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>quarkus.keycloak.devservices.realm-path</code> を使って、カンマで区切られたファイルのリストを提供することで、複数のレルムファイルでKeycloakを初期化することができます:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>quarkus.keycloak.devservices.realm-path=quarkus-realm1.json,quarkus-realm2.json</pre>
</div>
</div>
<div class="paragraph">
<p>また、Keycloak ページには、右上隅にある <code>KeycloakAdmin</code> オプションを使用して、Keycloak にサインインしてレルムを設定 (<code>SignIn To Keycloak To Configure Realms</code>) するオプションがあります。</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="./images/dev-ui-keycloak-admin.png" alt="Dev UI OpenID Connect Keycloak Page - Keycloak Admin">
</div>
</div>
<div class="paragraph">
<p>レルムのプロパティーのカスタマイズ、新規レルムの作成またはインポート、レルムのエクスポートを実行するには、Keycloak に <code>admin:admin</code> としてサインインします。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="disable-dev-services-for-keycloak"><a class="anchor" href="#disable-dev-services-for-keycloak"></a>Keycloak の Dev サービスを無効にする</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>quarkus.oidc.auth-server-url</code> がすでに初期化されているか、デフォルトの OIDC テナントが <code>quarkus.oidc.tenant.enabled=false</code> で無効になっている場合、Keycloak を使用するかどうかにかかわらず、 <code>Dev Services ForKeycloak</code> はアクティブ化されません。</p>
</div>
<div class="paragraph">
<p><code>Dev Services for Keycloak</code> コンテナーを起動させない、または使用しない場合も、 <code>quarkus.keycloak.devservices.enabled=false</code> を使用してこの機能を無効化できます。これは、 <code>quarkus.oidc.auth-server-url</code> なしで <code>quarkus:dev</code> を起動する予定がある場合にのみ必要です。</p>
</div>
<div class="paragraph">
<p><code>Dev Services for Keycloak</code> が無効で <code>quarkus.oidc.auth-server-url</code> プロパティーが初期化されていない場合、メインの Dev UI ページには空の <code>OpenIDConnectCard</code> が含まれます。</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="./images/dev-ui-oidc-card.png" alt="Dev UI OpenID Connect Card">
</div>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.auth-server-url</code> がすでに設定されている場合は、すべての OpenIDConnect プロバイダーで使用できる汎用 OpenIDConnectDevConsole がアクティブ化されます。詳細は <a href="#dev-ui-all-oidc-providers">Dev UI for all OpenID Connect Providers</a> を参照してください。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dev-ui-all-oidc-providers"><a class="anchor" href="#dev-ui-all-oidc-providers"></a>すべての OpenID Connect プロバイダーの Dev UI</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>quarkus.oidc.auth-server-url</code> が、すでに起動されている OpenID Connect プロバイダー (Keycloak または他のプロバイダーも可) を指し、 <code>quarkus.oidc.auth-server-url</code> が <code>service</code> (デフォルト値) に設定され、少なくとも <code>quarkus.oidc.client-id</code> が設定されている場合、すべての OpenID Connect プロバイダーの Dev UI (<code>Dev UI for all OpenID Connect Providers</code>) がアクティブになります。</p>
</div>
<div class="paragraph">
<p>Keycloak や その他のプロバイダーでは、 <code>quarkus.oidc.client-id</code> で指定されたクライアントが使用している OpenID Connect プロバイダーの管理コンソールでパブリッククライアントとして設定されていない限り、Dev UI から開始された認可コードフローを完了するには <code>quarkus.oidc.credentials.secret</code> の設定が必要です。</p>
</div>
<div class="paragraph">
<p>実行:</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">コマンドラインインタフェース</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus dev</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw quarkus:dev</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew --console=plain quarkusDev</code></pre>
</div>
</div>
<div class="paragraph">
<p>以下のメッセージが表示されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">...
2021-09-07 15:53:42,697 INFO  [io.qua.oid.dep.dev.OidcDevConsoleProcessor] (build-41) OIDC Dev Console: discovering the provider metadata at http://localhost:8180/realms/quarkus/.well-known/openid-configuration
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>プロバイダーメタデータの検出が成功した場合、メインの <a href="http://localhost:8080/q/dev">Dev UI ページ</a> を開くと、 <code>Dev Console</code> にリンクされた <code>OpenID Connect Card</code> ページが表示されます。</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="./images/dev-ui-oidc-devconsole-card.png" alt="Generic Dev UI OpenID Connect Card">
</div>
</div>
<div class="paragraph">
<p>リンクをたどると、プロバイダーにログインしてトークンを取得し、アプリケーションをテストできます。特に Keycloakを使用している場合、これは <code>Dev Services for Keycloak</code> コンテナーを起動した <a href="#keycloak-authorization-code-grant">Keycloakに対する認可コードグラント</a> セクションで説明したとおりです。</p>
</div>
<div class="paragraph">
<p>OpenId Connect プロバイダーが <code>Dev Console</code> へのリダイレクトをサポートするように設定する必要があるようです。 <code><a href="http://localhost:8080/q/dev/io.quarkus.quarkus-oidc/provider" class="bare">http://localhost:8080/q/dev/io.quarkus.quarkus-oidc/provider</a></code> をリダイレクトとログアウトの URL として追加してください。</p>
</div>
<div class="paragraph">
<p>他のプロバイダーと連携している場合、　<a href="#keycloak-authorization-code-grant">Keycloakに対する認可コードグラント</a> セクションで説明した Dev UI とは若干異なる場合があります。たとえば、アクセストークンは JWT 形式ではない可能性があるため、内部コンテンツは表示できませんが、すべてのプロバイダーは ID トークンを JWT として返す必要があります。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>デフォルトでは、現在のアクセストークンを使用して、 <code>Swagger UI</code> または <code>GrapghQL UI</code> でサービスをテストします。プロバイダー (Keycloak 以外) がバイナリーアクセストークンを返す場合、このプロバイダーにトークンイントロスペクションエンドポイントがある場合にのみ <code>Swagger UI</code> または <code>GrapghQL UI</code> で使用されます。それ以外の場合は、常に JWT 形式の <code>IdToken</code> が <code>Swagger UI</code> または <code>GrapghQL UI</code> に渡されます。このような場合、手動の Dev UI テストで、現在のバイナリーアクセストークンに対して常に <code>401</code> が返されることを確認できます。また、これらの UI のいずれかでフォールバックとして <code>Id Token</code> を使用することは、認可コードフローでのみ可能であることに注意してください。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>Auth0</code> などの一部のプロバイダーは標準の RP 主導型ログアウトをサポートしていないため、プロバイダー固有のログアウトプロパティーを設定しなければ、ログアウトオプションは表示されません。詳細は、　<a href="security-openid-connect-web-authentication#user-initiated-logout">OpenID Connect ユーザー主導型ログアウト</a> を参照してください。</p>
</div>
<div class="paragraph">
<p>同様に、Dev UI に <code>password</code> または <code>client_credentials</code> グラントを使用してトークンを取得する場合は、次のような追加のプロバイダー固有プロパティーを設定する必要があります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.oidc.devui.grant.type=password
quarkus.oidc.devui.grant-options.password.audience=http://localhost:8080</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dev-services-and-ui-support-for-other-openid-connect-providers"><a class="anchor" href="#dev-services-and-ui-support-for-other-openid-connect-providers"></a>その他の OpenID Connect プロバイダーの Dev Services と UI サポート</h2>
<div class="sectionbody">
<div class="paragraph">
<p>カスタムエクステンションは、 <code>quarkus-oidc</code> を拡張し、プロバイダーをサポートするために必要な依存関係をエクステンションの <code>deployment</code> モジュールにのみ追加する必要があります。</p>
</div>
<div class="paragraph">
<p><code>Dev Services</code> を処理するビルドステップでは、 <code>OpenID Connect Card</code> をプロバイダーを示す Dev UI ページにリンクするために、2 つのランタイムプロパティーを "io.quarkus.quarkus-oidc" 名前空間に追加で登録する必要があります: <code>oidcProviderName</code> (例: <code>Google</code>) と <code>oidcProviderUrlBase</code> (例: <code>mycompany.devservices-google</code>)。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package io.quarkus.oidc.okta.runtime;

import java.util.function.Supplier;

import io.quarkus.runtime.annotations.Recorder;

// This simple recorder is the only code which will be located in the extension's `runtime` module
@Recorder
public class OktaDevServicesRecorder {

    public Supplier&lt;String&gt; getProviderName() {
        return new Supplier&lt;String&gt;() {

            @Override
            public String get() {
                return "OKTA";
            }
        };
    }

    public Supplier&lt;String&gt; getProviderUrlBase() {
        return new Supplier&lt;String&gt;() {

            @Override
            public String get() {
                return "io.quarkus" + "." + "quarkus-oidc-okta";
            }
        };
    }
}


package io.quarkus.oidc.okta.deployment.devservices;

import static io.quarkus.deployment.annotations.ExecutionTime.RUNTIME_INIT;

import java.util.Optional;

import io.quarkus.deployment.IsDevelopment;
import io.quarkus.deployment.annotations.BuildProducer;
import io.quarkus.deployment.annotations.BuildStep;
import io.quarkus.deployment.annotations.Consume;
import io.quarkus.deployment.annotations.Record;
import io.quarkus.deployment.builditem.RuntimeConfigSetupCompleteBuildItem;
import io.quarkus.devconsole.spi.DevConsoleRouteBuildItem;
import io.quarkus.devconsole.spi.DevConsoleRuntimeTemplateInfoBuildItem;

public class OktaDevConsoleProcessor {

    @BuildStep(onlyIf = IsDevelopment.class)
    @Record(value = RUNTIME_INIT)
    public void setOidcProviderProperties(BuildProducer&lt;DevConsoleRuntimeTemplateInfoBuildItem&gt; provider,
            OktaDevServicesRecorder recorder,
            Optional&lt;DevServicesConfigBuildItem&gt; configProps) {
        if (configProps.isPresent()) {
            provider.produce(new DevConsoleRuntimeTemplateInfoBuildItem("io.quarkus", "quarkus-oidc", "oidcProviderName",
                    recorder.getProviderName()));
            provider.produce(new DevConsoleRuntimeTemplateInfoBuildItem("io.quarkus", "quarkus-oidc", "oidcProviderUrlBase",
                    recorder.getProviderUrlBase()));
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>さらに、ユーザーが <code>quarkus.keycloak.devservices.enabled=false</code> を入力するのではなく、エクステンションが <code>io.quarkus.oidc.deployment.devservices.OidcProviderBuildItem</code> を生成してデフォルトの <code>Dev Services for Keycloak</code> を無効にする必要があります。</p>
</div>
<div class="paragraph">
<p><a href="dev-ui">Dev UI</a> チュートリアルと <code>extensions/oidc/deployment</code> ソースで他のアイデアも確認してください。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="non-application-root-path-considerations"><a class="anchor" href="#non-application-root-path-considerations"></a>アプリケーション以外のルートパスに関する考慮事項</h2>
<div class="sectionbody">
<div class="paragraph">
<p>このドキュメントでは、繰り返し <code><a href="http://localhost:8080/q/dev" class="bare">http://localhost:8080/q/dev</a></code> Dev UI URL を参照していますが、この <code>q</code> はデフォルトの非アプリケーションルートパスです。 <code>quarkus.http.root-path</code> や <code>quarkus.http.non-application-root-path</code> プロパティーをカスタマイズした場合、 <code>q</code> を適宜置き換えてください。詳細については、 <a href="https://quarkus.io/blog/path-resolution-in-quarkus/">Quarkus を使用したパスの解決</a> を参照してください。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="references"><a class="anchor" href="#references"></a>参照</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="dev-ui">Dev UI</a></p>
</li>
<li>
<p><a href="https://www.keycloak.org/documentation.html">Keycloak Documentation</a></p>
</li>
<li>
<p><a href="https://openid.net/connect/">OpenID Connect</a></p>
</li>
<li>
<p><a href="security-openid-connect">Quarkus - OpenID Connect (OIDC) を使用した、ベアラートークン認可によるサービスアプリケーションの保護</a></p>
</li>
<li>
<p><a href="security-openid-connect-web-authentication">Quarkus - OpenID Connect を使用した、認可コードフローによる Web アプリケーションの保護</a></p>
</li>
<li>
<p><a href="security-overview-concept">Quarkus Security 概要</a></p>
</li>
</ul>
</div>
</div>
</div>
    </div>
    <div class="grid__item width-4-12 width-12-12-m tocwrapper">
      <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#introduction">はじめに</a></li>
<li><a href="#dev-services-for-keycloak">Dev Services for Keycloak</a>
<ul class="sectlevel2">
<li><a href="#develop-service-applications">サービスアプリケーションの開発</a></li>
<li><a href="#develop-web-app-applications">OpenID Connect Web アプリケーションの開発</a></li>
<li><a href="#running-the-tests">テストの実行</a></li>
<li><a href="#keycloak-initialization">Keycloak 初期化</a></li>
</ul>
</li>
<li><a href="#disable-dev-services-for-keycloak">Keycloak の Dev サービスを無効にする</a></li>
<li><a href="#dev-ui-all-oidc-providers">すべての OpenID Connect プロバイダーの Dev UI</a></li>
<li><a href="#dev-services-and-ui-support-for-other-openid-connect-providers">その他の OpenID Connect プロバイダーの Dev Services と UI サポート</a></li>
<li><a href="#non-application-root-path-considerations">アプリケーション以外のルートパスに関する考慮事項</a></li>
<li><a href="#references">参照</a></li>
</ul></div>
    </div>
  </div>
  </div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license. <i class='fab fa-creative-commons'></i><i class='fab fa-creative-commons-by'></i> <a href='https://creativecommons.org/licenses/by/3.0/' target='_blank'>CC by 3.0</a><br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>ナビゲーション</span>
        <ul class="footer-links">
          
          
            <li><a href="/" target="_blank">ホーム</a></li>
          
          
          
            <li><a href="/about" target="_blank">Quarkusについて</a></li>
          
          
          
            <li><a href="/blog" target="_blank">ブログ</a></li>
          
          
          
            <li><a href="/insights" target="_blank">ポッドキャスト</a></li>
          
          
          
            <li><a href="/events" target="_blank">イベント</a></li>
          
          
          
            <li><a href="/newsletter" target="_blank">ニュースレター</a></li>
          
          
          
            <li><a href="/userstories" target="_blank">ユーザーストーリー</a></li>
          
          
          
            <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" target="_blank">ロードマップ</a></li>
          
          
          
            <li><a href="/security" target="_blank">セキュリティ&nbsp;ポリシー</a></li>
          
          
          
            <li><a href="/usage" target="_blank">使用方法</a></li>
          
          
          
            <li><a href="https://github.com/commonhaus/artwork/tree/main/projects/quarkus" target="_blank">Brand</a></li>
          
          
          
            <li><a href="/desktopwallpapers" target="_blank">Wallpapers</a></li>
          
          
          
            <li><a href="https://www.redhat.com/en/about/privacy-policy" target="_blank">Privacy Policy</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>フォローする</span>
        <ul class="footer-links">
          
          
            <li><a href="https://x.com/quarkusio" target="_blank">X</a></li>
          
          
          
            <li><a href="https://bsky.app/profile/quarkus.io" target="_blank">Bluesky</a></li>
          
          
          
            <li><a rel="me" href="https://fosstodon.org/@quarkusio" target="_blank">Mastodon</a></li>
            
          
          
            <li><a href="https://www.threads.com/@quarkusio" target="_blank">Threads</a></li>
          
          
          
            <li><a href="https://www.facebook.com/quarkusio" target="_blank">Facebook</a></li>
          
          
          
            <li><a href="https://www.linkedin.com/company/quarkusio/" target="_blank">Linkedin</a></li>
          
          
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg" target="_blank">Youtube</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio" target="_blank">GitHub</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>ヘルプ</span>
        <ul class="footer-links">
          
          
            <li><a href="/support" target="_blank">サポート</a></li>
          
          
          
            <li><a href="/guides" target="_blank">ガイド</a></li>
          
          
          
            <li><a href="/faq" target="_blank">FAQ</a></li>
          
          
          
            <li><a href="/get-started" target="_blank">入門</a></li>
          
          
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus" target="_blank">Stack Overflow</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions" target="_blank">ディスカッション</a></li>
          
          
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev" target="_blank">開発メーリングリスト</a></li>
          
          
          
            <li><a href="https://stats.uptimerobot.com/ze1PfweT2p" target="_blank">Quarkus Service Status</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>言語</span>
        <ul class="footer-links">
          
          
            <li><a href=" https://quarkus.io/ " target="_blank">English</a></li>
          
          
          
            <li><a href="https://pt.quarkus.io/" target="_blank">Português&nbsp;(Brasileiro)</a></li>
          
          
          
            <li><a href=" https://es.quarkus.io/ " target="_blank">Español</a></li>
          
          
          
            <li><a href="https://cn.quarkus.io/" target="_blank">简体中文</a></li>
          
          
          
            <li><a href=" https://ja.quarkus.io/ " target="_blank">日本語</a></li>
          
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkusはコミュニティプロジェクトで構成されています</span>
        <ul class="footer-links">
          
            <li><a blah href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a blah href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a blah href="https://hibernate.org" target="_blank">Hibernate ORM</a></li>
          
            <li><a blah href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a blah href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a blah href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a blah href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a blah href="https://code.quarkus.io/" target="_blank">その他多数...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content cf-footer">
  <div class="flexcontainer">
    <div class="cf-logo">
      <a class="cf-logo" href="https://www.commonhaus.org/" target="_blank"><img src="https://raw.githubusercontent.com/commonhaus/artwork/main/foundation/brand/svg/CF_logo_horizontal_single_reverse.svg"/></a>
    </div>
    <div class="license">
      Copyright © Quarkus. All rights reserved. For details on our trademarks, please visit our <a href="https://www.commonhaus.org/policies/trademark-policy/">Trademark Policy</a> and <a href="https://www.commonhaus.org/trademarks/">Trademark List</a>. Trademarks of third parties are owned by their respective holders and their mention here does not suggest any endorsement or association.
    </div>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
  <script src="/assets/javascript/future-date.js" type="text/javascript"></script>
  <script src="/assets/javascript/randomize.js" type="text/javascript"></script>
  <script src="/assets/javascript/time.js" type="text/javascript"></script>
</body>

</html>
