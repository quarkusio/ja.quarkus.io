<!DOCTYPE html>
<html lang="ja">







<head>
  <title>Qute リファレンスガイド - main - Quarkus</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="
  connect-src 'self' https://dpm.demdex.net https://adobedc.demdex.net https://analytics.ossupstream.org/ https://search.quarkus.io https://smetrics.redhat.com; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval'
      
      https://assets.adobedtm.com
      js.bizographics.com
      https://www.redhat.com
      https://static.redhat.com
      https://app.requestly.io/
      jsonip.com
      https://ajax.googleapis.com
      https://use.fontawesome.com
      http://www.youtube.com
      http://www.googleadservices.com
      https://googleads.g.doubleclick.net
      https://giscus.app
      https://analytics.ossupstream.org/
      https://app.mailjet.com;

  style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; 
  img-src 'self' * data:; 
  media-src 'self'; 
  frame-src https://redhat.demdex.net https://www.youtube.com https://player.restream.io https://app.mailjet.com http://xy0p2.mjt.lu https://mj.quarkus.io https://giscus.app; 
  base-uri 'none'; 
  object-src 'none'; 
  form-action 'none'; 
  font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/version/main/guides/qute-reference" />
  <meta property="og:title" content="Qute リファレンスガイド - main" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/qute-reference">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
  
  
  
  
  <link rel="alternate" hreflang="x-default" href="https://quarkus.io/" />  
  <script src="/assets/javascript/tracking.js"></script>
  
  <script src="/assets/javascript/colormode.js" type="text/javascript"></script>

</head>

<body class="guides">

  


<div class="grid-wrapper communitysite">
  <div class="grid__item width-12-12">The <a href="https://quarkus.io/version/main/guides/qute-reference">English version of quarkus.io</a> is the official project site. Translated sites are community supported on a best-effort basis.</div>
</div>


  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
        <div class="logo-wrapper">
           <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
        </div>
    <label class="nav-toggle" for="checkbox"> <i class="fa fa-bars"></i>
</label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="#">Why<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">QUARKUSとは何か?</a></li>
          <li><a href="/developer-joy" class="">開発者満足</a></li>
          <li><a href="/performance" class="">パフォーマンス</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">標準</a></li>
          <li><a href="/versatility" class="">多用途性</a></li>
          <li><a href="/container-first" class="">コンテナ・ファースト</a></li>
          <li><a href="/spring" class="">USING SPRING?</a></li>
          <li class="tertiarydropdown">
            <span href="#">AI<i class="fas fa-chevron-down"></i></span>
            <ul class="tertiarymenu">
              <li><a href="/ai" class="">AI OVERVIEW</a></li>
              <li><a href="/java-for-ai" class="">JAVA FOR AI</a></li>
              <li><a href="/quarkus-for-ai" class="">WHY QUARKUS FOR AI</a></li>
              <li><a href="/ai-blueprints" class="">AI BLUEPRINTS</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="#">Learn<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">入門</a></li>
          <li><a href="/guides" class="active">ドキュメント</a></li>
          <li><a href="/userstories/" class="">ユーザーストーリー</a></li>  
          <li><a href="/qtips" class="">"Q" Tipsビデオ</a></li>          
          <li><a href="/books" class="">書籍</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="#">Extensions<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          
          <!-- Note that quarkus.io is hardcoded here, because it is the only url which supports extensions -->
<li><a href="https://quarkus.io/extensions/" class="">エクステンションを探す</a></li>
          <li><a href="/faq/#what-is-a-quarkus-extension" class="">エクステンションの使用</a></li>
          <li><a href="/guides/writing-extensions" class="">エクステンションの作成</a></li>
          <li><a href="https://hub.quarkiverse.io" class="">エクステンションの共有</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="#">Community<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">サポート</a></li>
          <li><a href="/blog" class="">ブログ</a></li>
          <li><a href="/discussion" class="">ディスカッション</a></li>
          <li><a href="/working-groups" class="">ワーキンググループ</a></li>
          <li><a href="/insights" class="">ポッドキャスト</a></li>
          <li><a href="/events" class="">イベント</a></li>
          <li><a href="/newsletter" class="">ニュースレター</a></li>
          <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" class="">ロードマップ</a></li>
          <li><a href="/benefactors" class="">BENEFACTORS</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary
white">コーディングを開始</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/version/main/guides/qute-reference" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://pt.quarkus.io/version/main/guides/qute-reference">ポルトガル（BR）</a></li>
          <li><a href="https://es.quarkus.io/version/main/guides/qute-reference">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/version/main/guides/qute-reference">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/version/main/guides/qute-reference">日本語</a></li>
          </ul>
      </li>
      <li>
        <span href="#" class="modeswitcher" id='theme-toggle'><i class="fas
fa-sun"></i><i class="fas fa-moon"></i><i class="fas fa-cog"></i></span>
      </li>
    </ul>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    







<section class="full-width-version-bg flexfilterbar guides">
  <div class="guideflexcontainer">
    <div class="docslink">
      <a class="returnlink" href="/version/main/guides/"> Back to Guides</a>
    </div>
    <div class="flexlabel">
      <label>バージョン:</label>
    </div>
    <div class="guidepulldown version">
    <select id="guide-version-dropdown">
      
        
        
        <option value="main" selected>Main - SNAPSHOT</option>
        
        
        
        <option value="latest" >3.28.4 - Latest</option>
        
        
        
        <option value="3.27" >3.27</option>
        
        
        
        <option value="3.20" >3.20</option>
        
        
        
        <option value="3.15" >3.15</option>
        
        
        
        <option value="3.8" >3.8</option>
        </select>
    </div>
  </div>
</section>

<div class="guide">
  <div class="grid-wrapper">
    <div class="grid__item width-8-12 width-12-12-m">
      
      <a class="editlink" href="https://github.com/quarkusio/quarkus/edit/main/docs/src/main/asciidoc/qute-reference.adoc">このページを編集</a>
      
      <h1 class="text-caps">Qute リファレンスガイド </h1>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Qute は、Quarkus のニーズを満たすために特別に設計されたテンプレートエンジンです。ネイティブイメージのサイズを小さくするために、リフレクションの使用は最小限に抑えられています。API は、命令型とノンブロッキングリアクティブ型の両方のスタイルのコーディングを組み合わせています。開発モードでは、 <code>src/main/resources/templates</code> フォルダーにあるすべてのファイルが変更があるかどうか監視され、変更はアプリケーションにすぐに表示されます。さらに、ビルド時にテンプレートの問題のほとんどの検出を試み、即座に失敗します。</p>
</div>
<div class="paragraph">
<p>このガイドでは、<a href="#hello_world_example">入門者向けサンプル</a>、<a href="#core_features">コア機能</a> の説明、<a href="#quarkus_integration">Quarkus 統合</a> の詳細について説明しています。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Qute は、主に Quarkus のエクステンションとして設計されています。
「スタンドアロン」のライブラリーとして使用することも可能です。
しかし、その場合、いくつかの機能は使用できません。
一般的に、 <a href="#quarkus_integration">Quarkus 統合</a> のセクションで言及されている機能は使えません。
制限と可能性については、 <a href="#standalone">スタンドアローンライブラリーとして使用する場合のQute</a> セクションに詳細が記載されています。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the_simplest_example"><a class="anchor" href="#the_simplest_example"></a>1. 最も簡単な例</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Qute を試す最も簡単な方法は、便利な <code>io.quarkus.qute.Qute</code> クラスを使用し、簡単なメッセージをフォーマットするために使用できる <code>fmt()</code> 静的メソッドの 1 つを呼び出すことです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.quarkus.qute.Qute;

Qute.fmt("Hello {}!", "Lucy"); <i class="conum" data-value="1"></i><b>(1)</b>
// =&gt; Hello Lucy!

Qute.fmt("Hello {name} {surname ?: 'Default'}!", Map.of("name", "Andy")); <i class="conum" data-value="2"></i><b>(2)</b>
// =&gt; Hello Andy Default!

Qute.fmt("&lt;html&gt;{header}&lt;/html&gt;").contentType("text/html").data("header", "&lt;h1&gt;My header&lt;/h1&gt;").render(); <i class="conum" data-value="3"></i><b>(3)</b>
// &lt;html&gt;&amp;lt;h1&amp;gt;Header&amp;lt;/h1&amp;gt;&lt;/html&gt; <i class="conum" data-value="4"></i><b>(4)</b>

Qute.fmt("I am {#if ok}happy{#else}sad{/if}!", Map.of("ok", true)); <i class="conum" data-value="5"></i><b>(5)</b>
// =&gt; I am happy!</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>空の式 <code>{}</code> はプレースホルダーであり、インデックスベースの配列アクセスサー (例えば <code>{data[0]}</code> ) に置き換えられます。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>代わりにデータマップを提供することができます。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>より複雑なフォーマットを必要とする場合には、ビルダーライクな API が利用可能です。</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>"text/html" テンプレートでは、デフォルトで特殊な char が html エンティティーに置き換えられることに注意してください。</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>テンプレートには、任意の <a href="#basic-building-blocks">ビルディングブロック</a> を使用することができます。この場合、<a href="#if_section">If セクション</a> は、入力データに基づいてメッセージの適切なパーツをレンダリングするために使用されます。</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<a href="#quarkus_integration">Quarkus</a> では、メッセージのフォーマットに使用されるエンジンは <code>@Inject Engine</code> によって注入されるものと同じです。したがって、<a href="#template_extension_methods">テンプレート拡張メソッド</a> 、 <a href="#injecting-beans-directly-in-templates">テンプレートに直接Beansを注入</a>  、または <a href="#type-safe-message-bundles">タイプセーフメッセージバンドル</a> のような Quarkus 固有の統合機能を利用することができます。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>Qute.fmt(String)</code> メソッドが返すフォーマットオブジェクトは、遅延評価され、たとえば、ログメッセージとして使用することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">LOG.info(Qute.fmt("Hello {name}!").data("name", "Foo"));
// =&gt; Hello Foo! and the message template is only evaluated if the log level INFO is used for the specific logger</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
詳細は <code>io.quarkus.qute.Qute</code> クラスの javadoc をお読みください。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hello_world_example"><a class="anchor" href="#hello_world_example"></a>2. ハローワールドの例</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この例では、Quteのテンプレートを扱う際の基本的なワークフローをデモしたいと思います。まず、簡単なhello worldの例から始めましょう。 <strong>テンプレートのコンテンツ</strong> は必ず必要になります。</p>
</div>
<div class="listingblock">
<div class="title">hello.html</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;html&gt;
  &lt;p&gt;Hello {name}! <i class="conum" data-value="1"></i><b>(1)</b>
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>{name}</code> は、テンプレートがレンダリングされたときに評価される値の式です。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>そして、その内容を <strong>テンプレート定義</strong> Javaオブジェクトにパースする必要があります。テンプレート定義は、 <code>io.quarkus.qute.Template</code> のインスタンスです。</p>
</div>
<div class="paragraph">
<p>Quteを"スタンドアロン"で使用する場合は、まず <code>io.quarkus.qute.Engine</code> のインスタンスを作成する必要があります。 <code>Engine</code> は、専用の設定でテンプレートを管理するための一元的なポイントを表しています。便利なビルダーを使ってみましょう。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Engine engine = Engine.builder().addDefaults().build();</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Quarkusでは、あらかじめ設定された <code>Engine</code> がインジェクション用に利用可能です - <a href="#quarkus_integration">quarkus_integration</a> を参照してください。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>Engine</code> のインスタンスがあれば、テンプレートの内容を解析することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Template hello = engine.parse(helloHtmlContent);</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Quarkusでは、テンプレートの定義を単純に注入することができます。テンプレートは自動的に解析され、キャッシュされます - <a href="#quarkus_integration">quarkus_integration</a> を参照してください。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>最後に <strong>テンプレートインスタンス</strong> を作成し、データをセットして出力をレンダリングします。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Renders &lt;html&gt;&lt;p&gt;Hello Jim!&lt;/p&gt;&lt;/html&gt;
hello.data("name", "Jim").render(); <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Template.data(String, Object)</code> は、ワンステップでテンプレートのインスタンスを作成してデータを設定する便利なメソッドです。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>TemplateInstance.render()</code> は同期レンダリングをトリガーします。つまり、レンダリングが終了するまで現在のスレッドはブロックされます。しかし、レンダリングをトリガーして結果を消費する非同期の方法もあります。たとえば、 <code>CompletionStage&lt;String&gt;</code> <code>TemplateInstance.renderAsync()</code> を返す メソッドや、Mutiny の <code>Multi&lt;String&gt;</code> <code>TemplateInstance.createMulti()</code> を返すメソッドがあります。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>なので、ワークフローはシンプルです。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>テンプレートコンテンツを作成する ( <code>hello.html</code> )</p>
</li>
<li>
<p>テンプレートの定義を解析する ( <code>io.quarkus.qute.Template</code> )</p>
</li>
<li>
<p>テンプレートインスタンスを作成する ( <code>io.quarkus.qute.TemplateInstance</code> )</p>
</li>
<li>
<p>出力をレンダリングする</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<code>Engine</code> はテンプレート定義をキャッシュすることができるので、何度も内容をパースする必要がありません。Quarkus では、キャッシュは自動的に行われます。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="core_features"><a class="anchor" href="#core_features"></a>3. コア機能</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="basic-building-blocks"><a class="anchor" href="#basic-building-blocks"></a>3.1. 基本的なビルディングブロック</h3>
<div class="paragraph">
<p>テンプレートの動的な部分には、コメント、式、セクション、パースされていない文字データなどがあります。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Comments</dt>
<dd>
<p>コメントは <code>{!</code> というシーケンスで始まり、 <code>!}</code> というシーケンスで終わり、例えば <code>{! This is a comment !}</code> のようになります。  複数行にすることができ、 <code>{! {#if true} !}</code> のように式やセクションを含むことができます。  コメントの内容は、出力をレンダリングする際に完全に無視されます。</p>
</dd>
<dt class="hdlist1">式</dt>
<dd>
<p><a href="#expressions">式</a> は評価値を出力します。これは 1つ以上のパーツから構成されます。パーツは <code>{foo}</code>、 <code>{item.name}</code> のような単純なプロパティーや、 <code>{item.get(name)}</code> 、 <code>{name ?: 'John'}</code> のような仮想メソッドを表わすことができます。また、式は名前空間 <code>{inject:colors}</code> で始まることもあります。</p>
</dd>
<dt class="hdlist1">セクション</dt>
<dd>
<p><a href="#sections">section</a> には、静的テキスト、式、ネストされたセクションを含めることができます (<code>{#if foo.active}{foo.name}{/if}</code>)。
クロージングタグ内の名前はオプションです (<code>{#if active}ACTIVE!{/}</code>)。
セクションは空にできます (<code>{#myTag image=true /}</code>)。
一部のセクションでは、オプションの終了タグがサポートされます。つまり、終了タグがなければ、セクションは親セクションの終了位置で終了します。
セクションは、ネストしたセクションブロックを宣言することもでき (<code>{#if item.valid} Valid. {#else} Invalid. {/if}</code>)、どのブロックをレンダリングするかを決定します。</p>
</dd>
<dt class="hdlist1">パース対象外文字データ</dt>
<dd>
<p>レンダリングは行うが <em>パースは行わない</em> という内容をマークするために使用されます。  これは <code>{|</code> というシーケンスで始まり、 <code>|}</code> というシーケンスで終わり( <code>{|&lt;script&gt;if(true){alert('Qute is cute!')};&lt;/script&gt;|}</code> 、複数行になる可能性もあります。</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>以前はパース対象外文字データを <code>{[</code> and end with <code>]}</code> から始めることができました。この構文は、他の言語の構文とよく衝突するため、現在では削除されています。</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="identifiers"><a class="anchor" href="#identifiers"></a>3.2. 識別子とタグ</h3>
<div class="paragraph">
<p>識別子は、式やセクションタグで使用されます。有効な識別子は、空白文字以外の文字列です。ただし、式の中では有効な Java 識別子のみを使用することが推奨されます。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
ドットを含む識別子を指定する必要がある場合は、大括弧表記を使用することができます。例：<code>{map['my.key']}</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>テンプレート文書を解析する際、パーサはすべての <em>タグ</em> を識別します。タグは中括弧で始まり、中括弧で終わります。例: <code>{foo}</code> タグの内容は次から始まる必要があります:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>数字、または</p>
</li>
<li>
<p>アルファベット文字、または</p>
</li>
<li>
<p>アンダースコア、または</p>
</li>
<li>
<p>組み込みコマンド: <code>#</code> , <code>!</code> , <code>@</code> , <code>/</code> .</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>上記のいずれかで始まらない場合は、パーサによって無視されます。</p>
</div>
<div class="listingblock">
<div class="title">タグの例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;html&gt;
   &lt;body&gt;
   {_foo.bar}   <i class="conum" data-value="1"></i><b>(1)</b>
   {! comment !}<i class="conum" data-value="2"></i><b>(2)</b>
   {  foo}      <i class="conum" data-value="3"></i><b>(3)</b>
   {{foo}}      <i class="conum" data-value="4"></i><b>(4)</b>
   {"foo":true} <i class="conum" data-value="5"></i><b>(5)</b>
   &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>パース対象: アンダースコアで始まる式</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>パース対象: コメント</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>無視対象: 空白で開始</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>無視対象: <code>{</code> で開始</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>無視対象: <code>"</code> で開始</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
エスケープシーケンス <code>\{</code> and <code>\}</code> を使ってテキストにデリミタを挿入することも可能です。 実際には、エスケープシーケンスは通常、開始デリミタのためにのみ必要とされます。すなわち、 <code>\{foo}</code> は <code>{foo}</code> として描画されます（パース、評価は行われません）。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="removing-standalone-lines-from-the-template"><a class="anchor" href="#removing-standalone-lines-from-the-template"></a>3.3. テンプレートから独立した行を削除する</h3>
<div class="paragraph">
<p>デフォルトでは、パーサはテンプレート出力からスタンドアロン行を削除します。スタンドアロン <strong>行</strong> とは、少なくとも1つのセクションタグ(例: <code>{#each}</code> や <code>{/each}</code> )、パラメーター宣言(例: <code>{@org.acme.Foo foo}</code> )、コメントを含むが、式を含まず、空白以外の文字を含まない行のことです。言い換えれば、セクションタグやパラメーター宣言を含まない行は、独立した行ではあり <strong>ません</strong> 。同様に、 <em>式</em> や <em>空白以外の文字</em> を含む行もスタンドアロン行ではあり <strong>ません</strong> 。</p>
</div>
<div class="listingblock">
<div class="title">テンプレート例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;html&gt;
  &lt;body&gt;
     &lt;ul&gt;
     {#for item in items} <i class="conum" data-value="1"></i><b>(1)</b>
       &lt;li&gt;{item.name} {#if item.active}{item.price}{/if}&lt;/li&gt;  <i class="conum" data-value="2"></i><b>(2)</b>
                          <i class="conum" data-value="3"></i><b>(3)</b>
     {/for}               <i class="conum" data-value="4"></i><b>(4)</b>
     &lt;/ul&gt;
   &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>これはスタンドアロン行なので削除されます。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>スタンドアロン行ではない - 式と非空白文字を含む</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>スタンドアロン行ではない - セクションタグ/パラメーター宣言を含まない</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>これはスタンドアロン行です。</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">デフォルト出力</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;html&gt;
  &lt;body&gt;
     &lt;ul&gt;
       &lt;li&gt;Foo 100&lt;/li&gt;

     &lt;/ul&gt;
   &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Quarkusでは、プロパティー( <code>quarkus.qute.remove-standalone-lines</code> )を <code>false</code> に設定することで、デフォルトの動作を無効にすることができます。この場合、スタンドアロン行のすべての空白文字が出力されます。
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title"><code>quarkus.qute.remove-standalone-lines=false</code> での出力</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;html&gt;
  &lt;body&gt;
     &lt;ul&gt;

       &lt;li&gt;Foo 100&lt;/li&gt;


     &lt;/ul&gt;
   &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="expressions"><a class="anchor" href="#expressions"></a>3.4. 式</h3>
<div class="paragraph">
<p>式が評価され、値が出力されます。これには 1 つ以上のパーツがあり、各パーツはプロパティーアクセサー (別名 Field Access Expression) または仮想メソッド呼び出し (別名 Method Invocation Expression) のいずれかを表します。</p>
</div>
<div class="paragraph">
<p>プロパティーにアクセスする際には、ドット表記とブラケット表記のどちらかを使用できます。
<code>object.property</code> (ドット表記) 構文では、 <code>property</code> は <a href="#identifiers">valid identifier</a> でなければなりません。
<code>object[property_name]</code> (ブラケット表記) 構文では、 <code>property_name</code> は null 以外の <a href="#literals">literal</a> 値でなければなりません。</p>
</div>
<div class="paragraph">
<p>式は、名前空間の後にコロン (<code>:</code>) を付けて開始できます。
有効な名前空間は英数字とアンダースコアで構成されます。
名前空間の式は別の方法で解決されます。<a href="#expression_resolution">解決</a> も参照してください。</p>
</div>
<div class="listingblock">
<div class="title">プロパティーアクセサーの例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{name} <i class="conum" data-value="1"></i><b>(1)</b>
{item.name} <i class="conum" data-value="2"></i><b>(2)</b>
{item['name']} <i class="conum" data-value="3"></i><b>(3)</b>
{global:colors} <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>名前空間がなし、1 つの部分: <code>name</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>名前空間なし、2つのパーツ: <code>item</code> . <code>name</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>{item.name}</code> と同等ですが、括弧表記を使用しています。</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>namespace <code>global</code> , 1つのパーツ: <code>colors</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>式の一部を <em>仮想メソッド</em> とすることができ、その場合、名前の後にコンマで区切られたパラメーターのリストを括弧で囲みます。
仮想メソッドのパラメーターは、ネストされた式か、<a href="#literals">literal</a> 値のどちらかにすることができます。
これらのメソッドを <em>"仮想"</em> と呼ぶのは、実際の Java メソッドによってバックアップされる必要がないためです。
仮想メソッドの詳細については、<a href="#virtual_methods">following section</a> を参照してください。</p>
</div>
<div class="listingblock">
<div class="title">仮想メソッドの例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{item.getLabels(1)} <i class="conum" data-value="1"></i><b>(1)</b>
{name or 'John'} <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>名前空間なし、2つのパーツ - <code>item</code> , <code>getLabels(1)</code> 、2番目のパーツは、名前 <code>getLabels</code> と パラメーター <code>1</code> を持つ仮想メソッドです。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>name.or('John')</code> に翻訳される、単一のパラメーターを持つ仮想メソッドに使用できる 中置 (infix) 記法。名前空間なし、2 つのパーツ - <code>name</code> . <code>or('John')</code></td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="literals"><a class="anchor" href="#literals"></a>3.4.1. サポートされているリテラル</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">リテラル</th>
<th class="tableblock halign-left valign-top">サンプル</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, <code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'value'</code>, <code>"string"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code>, <code>-5</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1l</code>, <code>-5L</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1D</code>, <code>-5d</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1f</code>, <code>-5F</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="expression_resolution"><a class="anchor" href="#expression_resolution"></a>3.4.2. 解決</h4>
<div class="paragraph">
<p>式を評価する場合、登録された<a href="#value-resolvers">value resolvers</a> リストを使用します。
式の最初のパーツは、常に <a href="#current_context_object">current context object</a> に対して解決されます。
最初のパーツの結果が見つからない場合、(利用可能な場合は) 親コンテキストオブジェクトに対して解決されます。
名前空間で始まる式の場合、現在のコンテキストオブジェクトは、利用可能なすべての <code>NamespaceResolver</code> を使用して検出されます。
名前空間で始まらない式の場合、現在のコンテキストオブジェクトはタグの <strong>位置から導出</strong> されます。
式の他のすべてのパーツは、前の解決結果に対してすべての <code>ValueResolver</code> を使用して解決されます。</p>
</div>
<div class="paragraph">
<p>例えば、式 <code>{name}</code> には名前空間がなく、単一のパーツ - <code>name</code> です。"name"は、カレントコンテキストオブジェクトに対して利用可能なすべての値リゾルバを使用して解決されます。しかし、式 <code>{global:colors}</code> には、名前空間 <code>global</code> と単一パーツ - <code>colors</code> があります。まず、現在のコンテキストオブジェクトを見つけるために、利用可能なすべての <code>NamespaceResolver</code> s が使用されます。その後、見つかったコンテキストオブジェクトに対して"colors"を解決するために値リゾルバが使用されます。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>テンプレート・インスタンスに渡されたデータは、常に <code>data</code> 名前空間を使用してアクセスできます。これは、キーがオーバーライドされているデータにアクセスするのに便利かもしれません。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;html&gt;
{item.name} <i class="conum" data-value="1"></i><b>(1)</b>
&lt;ul&gt;
{#for item in item.derivedItems} <i class="conum" data-value="2"></i><b>(2)</b>
  &lt;li&gt;
  {item.name} <i class="conum" data-value="3"></i><b>(3)</b>
  is derived from
  {data:item.name} <i class="conum" data-value="4"></i><b>(4)</b>
  &lt;/li&gt;
{/for}
&lt;/ul&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>item</code> はデータオブジェクトとしてテンプレートインスタンスに渡されます。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>派生アイテムのリストを繰り返し処理します。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>item</code> は反復要素のエイリアスです。</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>data</code> 名前空間を使用して、 <code>item</code> データ・オブジェクトにアクセスします。</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="current_context_object"><a class="anchor" href="#current_context_object"></a>3.4.3. カレントコンテキスト</h4>
<div class="paragraph">
<p>式が名前空間を指定しない場合、<em>カレントコンテキストオブジェクト</em> はタグの位置から導出されます。
デフォルトでは、現在のコンテキストオブジェクトは、テンプレートインスタンスに渡されたデータを表します。
ただし、セクションは現在のコンテキストオブジェクトを変更することがあります。
典型的な例は、名前付きローカル変数を定義するために使用できる <a href="#let_section"><code>let</code></a> セクションです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{#let myParent=order.item.parent myPrice=order.price} <i class="conum" data-value="1"></i><b>(1)</b>
  &lt;h1&gt;{myParent.name}&lt;/h1&gt;
  &lt;p&gt;Price: {myPrice}&lt;/p&gt;
{/let}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>セクション内の現在のコンテキストオブジェクトは、解決されたパラメーターのマップです。</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
カレントコンテキストは、暗黙のバインディング <code>this</code> を通してアクセスできます。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="built-in-resolvers"><a class="anchor" href="#built-in-resolvers"></a>3.4.4. 組込Resolver</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名前</th>
<th class="tableblock halign-left valign-top">説明</th>
<th class="tableblock halign-left valign-top">サンプル</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elvis Operator: <code>?:</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">前のパーツが解決できなかったり、 <code>null</code> に解決された場合のデフォルト値を出力します。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{person.name ?: 'John'}</code>, <code>{person.name or 'John'}</code>, <code>{person.name.or('John')}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>orEmpty</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">前のパーツが解決できなかったり、 <code>null</code> に解決された場合に空のリストを出力します。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{pets.orEmpty.size}</code> は、 <code>pets</code> が解決可能でないか、 <code>null</code> の場合、 <code>0</code> を出力する。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ternary Operator: <code>condition ? ifTrue : ifFalse</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if-then-else文の省略形。 <a href="#if_section">if_section</a>] とは異なり、入れ子になった演算子はサポートされていません。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{item.isActive ? item.name : 'Inactive item'}</code> は、 <code>item.isActive</code> が <code>true</code> に解決した場合に <code>item.name</code> の値を出力します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logical AND Operator: <code>&amp;&amp;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#if_section">If セクション</a> で説明したように、両方のパーツが <code>falsy</code> でない場合に <code>true</code> を出力します。このパラメーターは必要な場合にのみ評価されます。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{person.isActive &amp;&amp; person.hasStyle}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logical OR Operator: <code>||</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#if_section">if_section</a>] で説明したように、いずれかのパーツが <code>falsy</code> でない場合に <code>true</code> を出力します。このパラメーターは必要な場合のみ評価されます。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{person.isActive || person.hasStyle}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Equals Operator: <code>==</code>/<code>eq</code>/<code>is</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outputs <code>true</code> if the base object is equal to the argument.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{obj1 is obj2 ? 'Equal' : 'Inequal'}</code>, <code>{obj1 == obj2 ? 'Equal' : 'Inequal'}</code>, <code>{obj1.eq(obj2) ? 'Equal' : 'Inequal'}</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<a href="#if_section">If セクション</a> で説明したように、三項演算子の条件は値が <code>falsy</code> とみなされない場合は <code>true</code> と評価されます。
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
実際には、演算子は1つのパラメーターを消費する「仮想メソッド」として実装されており、中置記法で使用することができます。例えば、 <code>{person.name or 'John'}</code> は <code>{person.name.or('John')}</code> に翻訳され、 <code>{item.isActive ? item.name : 'Inactive item'}</code> は <code>{item.isActive.ifTruthy(item.name).or('Inactive item')}</code> に翻訳されます。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="arrays"><a class="anchor" href="#arrays"></a>3.4.5. 配列</h4>
<div class="paragraph">
<p><a href="#loop_section">ループセクション</a> を使用して、配列の要素を反復処理することができます。
また、指定した配列の長さを取得し、インデックス値を用いて直接要素にアクセスすることも可能です。
さらに、 <code>take(n)/takeLast(n)</code> メソッドを使用して最初または最後の <code>n</code> 要素にアクセスできます。</p>
</div>
<div class="listingblock">
<div class="title">配列の例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;h1&gt;Array of length: {myArray.length}&lt;/h1&gt; <i class="conum" data-value="1"></i><b>(1)</b>
&lt;ul&gt;
  &lt;li&gt;First: {myArray.0}&lt;/li&gt; <i class="conum" data-value="2"></i><b>(2)</b>
  &lt;li&gt;Second: {myArray[1]}&lt;/li&gt; <i class="conum" data-value="3"></i><b>(3)</b>
  &lt;li&gt;Third: {myArray.get(2)}&lt;/li&gt; <i class="conum" data-value="4"></i><b>(4)</b>
&lt;/ul&gt;
&lt;ol&gt;
 {#for element in myArray}
 &lt;li&gt;{element}&lt;/li&gt;
 {/for}
&lt;/ol&gt;
First two elements: {#each myArray.take(2)}{it}{/each} <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>配列の長さを出力します。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>配列の最初の要素を出力します。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>括弧表記で配列の2つ目の要素を出力します。</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>配列の 3 番目の要素を仮想メソッド <code>get()</code> で出力します。</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>配列の最初の 2 要素を出力します。</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="character-escapes"><a class="anchor" href="#character-escapes"></a>3.4.6. 文字エスケープ</h4>
<div class="paragraph">
<p>HTML および XML テンプレートでは、対応するテンプレートバリアントが設定されている場合に、 <code>'</code>, <code>"</code>, <code>&lt;</code>, <code>&gt;</code>, <code>&amp;</code> 文字はデフォルトでエスケープされます。
JSON テンプレートの場合、対応するテンプレートバリアントが設定されている場合、 <code>"</code>、 <code>\</code>、および制御文字 (<code>U+0000</code> から <code>U+001F</code>) はデフォルトでエスケープされます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Quarkusでは、 <code>src/main/resources/templates</code> にあるテンプレートに対してバリアントが自動的に設定されます。デフォルトでは、テンプレートファイルのコンテンツタイプを決定するために <code>java.net.URLConnection#getFileNameMap()</code> が使用されます。コンテンツタイプへのサフィックスの追加マップは、 <code>quarkus.qute.content-types</code> を通じて設定できます。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>エスケープされていない値をレンダリングする必要がある場合:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>java.lang.Object</code> の拡張メソッドとして実装されている <code>raw</code> または <code>safe</code> プロパティーを使用します。</p>
</li>
<li>
<p><code>String</code> の値を <code>io.quarkus.qute.RawString</code> でラップします。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">HTML の例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;html&gt;
&lt;h1&gt;{title}&lt;/h1&gt; <i class="conum" data-value="1"></i><b>(1)</b>
{paragraph.raw} <i class="conum" data-value="2"></i><b>(2)</b>
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>title</code> が <code>Expressions &amp; Escapes</code> に解決した場合は、 <code>Expressions &amp; Escapes</code> としてレンダリングされます。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>paragraph</code> が <code>&lt;p&gt;My text!&lt;/p&gt;</code> に解決された場合は、 <code>&lt;p&gt;My text!&lt;/p&gt;</code> としてレンダリングされます。</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
デフォルトでは、 <code>text/html</code>、 <code>text/xml</code>、 <code>application/xml</code> および <code>application/xhtml+xml</code> コンテンツタイプのいずれかを持つテンプレートがエスケープされます。しかし、 <code>quarkus.qute.escape-content-types</code> 設定プロパティーで、このリストを拡張することができます。
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">JSON の例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "id": "{valueId.raw}", <i class="conum" data-value="1"></i><b>(1)</b>
  "name": "{valueName}" <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>\nA12345</code> に解決される <code>valueId</code> は <code>\nA12345</code> としてレンダリングされますが、属性 <code>id</code> の文字列値内に新しい行が挿入されるため、無効な JSON オブジェクトになります。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>\	Expressions \n Escapes</code> に対して解決される <code>valueName</code> は <code>\\	Expressions \\n Escapes</code> とレンダリングされます。</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="virtual_methods"><a class="anchor" href="#virtual_methods"></a>3.4.7. 仮想メソッド</h4>
<div class="paragraph">
<p>仮想メソッドとは、通常のJavaメソッド呼び出しのように見える <strong>式のパーツ</strong> です。Javaクラスの実際のメソッドと一致する必要がないため、「仮想」と呼ばれています。実際には、通常のプロパティーと同様に、仮想メソッドも値リゾルバによって処理されます。唯一の違いは、仮想メソッドの場合、値リゾルバが式でもあるパラメーターを消費することです。</p>
</div>
<div class="listingblock">
<div class="title">仮想メソッドの例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;html&gt;
&lt;h1&gt;{item.buildName(item.name,5)}&lt;/h1&gt; <i class="conum" data-value="1"></i><b>(1)</b>
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>buildName(item.name,5)</code> は、名前 <code>buildName</code> と 2 つのパラメーター <code>item.name</code> と <code>5</code> を持つ仮想メソッドを表します。この仮想メソッドは、以下の Java クラスに対して生成された値リゾルバによって評価されます。

<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class Item {
   String buildName(String name, int age) {
      return name + ":" + age;
   }
}</code></pre>
</div>
</div></td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
仮想メソッドは通常、 <a href="#template_extension_methods">@TemplateExtension methods</a> 、 <a href="#template_data">@TemplateData</a> 、または <a href="#typesafe_expressions">parameter declarations</a> で使用されるクラスのために生成された値リゾルバによって評価されます。しかし、Javaのクラス/メソッドに基づかないカスタムの値リゾルバも登録できます。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>単一のパラメーターを持つ仮想メソッドは 中置記法を使用して呼び出すことができます。</p>
</div>
<div class="listingblock">
<div class="title">中置表記例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;html&gt;
&lt;p&gt;{item.price or 5}&lt;/p&gt;  <i class="conum" data-value="1"></i><b>(1)</b>
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>item.price or 5</code> は <code>item.price.or(5)</code> に翻訳されます。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>仮想メソッドのパラメーターは、「入れ子」仮想メソッドの呼び出しにすることができます。</p>
</div>
<div class="listingblock">
<div class="title">入れ子になった仮想メソッドの例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;html&gt;
&lt;p&gt;{item.subtractPrice(item.calculateDiscount(10))}&lt;/p&gt;  <i class="conum" data-value="1"></i><b>(1)</b>
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>item.calculateDiscount(10)</code> が最初に評価され、その後 <code>item.subtractPrice()</code> への引数として渡されます。</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="evaluation-of-completionstage-and-uni-objects"><a class="anchor" href="#evaluation-of-completionstage-and-uni-objects"></a>3.4.8. <code>CompletionStage</code> と <code>Uni</code> オブジェクトの評価</h4>
<div class="paragraph">
<p><code>java.util.concurrent.CompletionStage</code> および <code>io.smallrye.mutiny.Uni</code> を実装したオブジェクトは、特別な方法で評価されます。式の一部が <code>CompletionStage</code> に解決された場合、このステージが完了すると解決が継続され、式の次の部分(もしあれば)が完了したステージの結果に対して評価されます。たとえば、式 <code>{foo.size}</code> があり、 <code>foo</code> が <code>CompletionStage&lt;List&lt;String&gt;&gt;</code> に解決された場合、 <code>size</code> は完了した結果、すなわち <code>List&lt;String&gt;</code> に対して解決されます。式の一部が <code>Uni</code> に解決される場合、 <code>CompletionStage</code> が <code>Uni#subscribeAsCompletionStage()</code> を使用して <code>Uni</code> から最初に作成され、その後上記のように評価されます。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
各 <code>Uni#subscribeAsCompletionStage()</code> は新しいサブスクリプションになることに注目してください。 <code>Uni</code> の項目や障害がテンプレートデータとして使用される前に、メモ化を設定する必要があるかもしれません。つまり、 <code>myUni.memoize().indefinitely()</code> .
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>CompletionStage</code> が完了しなかったり、あるいは <code>Uni</code> がアイテム/失敗を発しないということが起こり得ます。この場合、レンダリングメソッド (<code>TemplateInstance#render()</code> および <code>TemplateInstance#createUni()</code>) は、特定のタイムアウトを過ぎると失敗します。このタイムアウトは、テンプレートインスタンスの <code>timeout</code> 属性として指定することができます。 <code>timeout</code> 属性が設定されていない場合、グローバルレンダリングタイムアウトが使用されます。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Quarkus では、デフォルトのタイムアウトは <code>io.quarkus.qute.timeout</code> 設定プロパティーで設定することができます。Qute をスタンドアロンで使用する場合は、 <code>EngineBuilder#timeout()</code> メソッドを使用することができます。
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
以前のバージョンでは、 <code>TemplateInstance#render()</code> メソッドだけがタイムアウト属性を尊重していました。たとえば、 <code>templateInstance.createUtni().ifNoItem().after(Duration.ofMillis(500)).fail()</code> のように、 <code>io.quarkus.qute.useAsyncTimeout=false</code> config プロパティーを使って、古い動作を保持しタイムアウトを自分で処理することが可能です。
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="how-to-identify-a-problematic-part-of-the-template"><a class="anchor" href="#how-to-identify-a-problematic-part-of-the-template"></a>3.4.8.1. テンプレートの問題個所の特定方法</h5>
<div class="paragraph">
<p>タイムアウトが発生したときに、テンプレートの問題のあるパーツを見つけるのは簡単ではありません。ロガー <code>io.quarkus.qute.nodeResolve</code> の <code>TRACE</code> レベルを設定し、その後ログ出力の解析を試みることができます。</p>
</div>
<div class="listingblock">
<div class="title"><code>application.properties</code> の例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.log.category."io.quarkus.qute.nodeResolve".min-level=TRACE
quarkus.log.category."io.quarkus.qute.nodeResolve".level=TRACE</code></pre>
</div>
</div>
<div class="paragraph">
<p>テンプレートで使用されるすべての式とセクションについて、次のような一対のログメッセージが表示されるはずです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>TRACE [io.qua.qut.nodeResolve] Resolve {name} started: Template hello.html at line 8
TRACE [io.qua.qut.nodeResolve] Resolve {name} completed: Template hello.html at line 8</pre>
</div>
</div>
<div class="paragraph">
<p>もし、 <code>completed</code> のログメッセージがない場合は、調査すべき良い候補があります。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="missing-properties"><a class="anchor" href="#missing-properties"></a>3.4.9. 不明なプロパティ</h4>
<div class="paragraph">
<p>式が実行時に評価されない場合があります。たとえば、 <code>{person.age}</code> という式があり、 <code>Person</code> クラスに <code>age</code> というプロパティーが宣言されていない場合です。<a href="#strict_rendering">strict レンダリング</a> が有効かどうかによって、動作が異なってきます。</p>
</div>
<div class="paragraph">
<p>これを有効にすると、プロパティーが見つからない場合、常に <code>TemplateException</code> が発生し、レンダリングが中断されます。このエラーを抑制するために、<em>default values</em> や <em>safe expressions</em> を使用することができます。</p>
</div>
<div class="paragraph">
<p>無効な場合、デフォルトで特別な定数 <code>NOT_FOUND</code> が出力に書き込まれます。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Quarkus では、<a href="#設定リファレンス">[設定リファレンス]</a> で説明しているように、 <code>quarkus.qute.property-not-found-strategy</code> を使用して、デフォルトのストラテジーを変更することが可能です。
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<a href="#typesafe_expressions">型安全な式</a> や <a href="#typesafe_templates">タイプセーフテンプレート</a> を使用すると、ビルド時に同様のエラーが検出されます。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sections"><a class="anchor" href="#sections"></a>3.5. セクション</h3>
<div class="paragraph">
<p>セクションは <code>#</code> で始まる開始タグを持ち、その後に <code>{#if}</code> や <code>{#each}</code> のようなセクション名が続きます。
また、空でも構いません。その場合、開始タグは <code>/</code> で終了します (<code>{#myEmptySection /}</code>)。
セクションには通常、ネストされた式や他のセクションが含まれています。
終了タグは <code>/</code> で始まり、セクションの名前 (オプション) が含まれます (<code>{#if foo}Foo!{/if}または `{#if foo}Foo!{/}</code>)。
一部のセクションではオプションの終了タグがサポートされています。終了タグがない場合、セクションは親セクションの終了位置で終了します。</p>
</div>
<div class="listingblock">
<div class="title"><code>#let</code> オプションの終了タグの例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{#if item.isActive}
  {#let price = item.price} <i class="conum" data-value="1"></i><b>(1)</b>
  {price}
  // synthetic {/let} added here automatically
{/if}
// {price} cannot be used here!</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>親 <code>{#if}</code> セクション内で使用できるローカル変数を定義します。</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">組み込みセクション</th>
<th class="tableblock halign-left valign-top">オプションの終了タグをサポート</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{#for}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{#if}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{#when}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{#let}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{#with}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{#include}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ユーザー定義タグ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{#fragment}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{#cached}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="sections_params"><a class="anchor" href="#sections_params"></a>3.5.1. パラメーター</h4>
<div class="paragraph">
<p>A start tag can define parameters with optional names, e.g. <code>{#if item.isActive}</code> and <code>{#let foo=1 bar=false}</code>.
Parameters are separated by one or more whitespaces.
Names are separated from the values by the equals sign.
Names and values can be prefixed and suffixed with any number of spaces, e.g. <code>{#let id='Foo'}</code> and <code>{#let id  = 'Foo'}</code> are equivalents where the name of the parameter is <code>id</code> and the value is <code>Foo</code>.
Values can be grouped using parentheses, e.g. <code>{#let id=(item.id ?: 42)}</code> where the name is <code>id</code> and the value is <code>item.id ?: 42</code>.
Sections can interpret parameter values in any way, e.g. take the value as is.
However, in most cases, the parameter value is registered as an <a href="#expressions">expression</a> and evaluated before use.</p>
</div>
<div class="paragraph">
<p>1つのセクションには、いくつかのコンテンツ <strong>ブロック</strong> を含めることができます。"main" ブロックは常に存在します。追加/入れ子になったブロックも <code>#</code> で始まり、パラメーターを持つことができます - <code>{#else if item.isActive}</code>。セクションのロジックを定義するセクションヘルパーは、任意のブロックを「実行」し、パラメーターを評価することができます。</p>
</div>
<div class="listingblock">
<div class="title">`#if`セクションの例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{#if item.name is 'sword'}
  It's a sword! <i class="conum" data-value="1"></i><b>(1)</b>
{#else if item.name is 'shield'}
  It's a shield! <i class="conum" data-value="2"></i><b>(2)</b>
{#else}
  Item is neither a sword nor a shield. <i class="conum" data-value="3"></i><b>(3)</b>
{/if}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>これがメインブロックです。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>追加ブロック。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>追加ブロック。</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="loop_section"><a class="anchor" href="#loop_section"></a>3.5.2. ループセクション</h4>
<div class="paragraph">
<p>ループセクションでは、 <code>Iterable</code>、 <code>Iterator</code>、array、 <code>Map</code> (要素は <code>Map.Entry</code>)、 <code>Stream</code>、 <code>Integer</code>、 <code>Long</code>、 <code>int</code> および <code>long</code> (プリミティブ値) のインスタンスに対して反復処理できます。
パラメーター値に <code>null</code> を指定すると、no-op となります。</p>
</div>
<div class="paragraph">
<p>このセクションには 2 つのフレーバーがあります。最初のものは <code>each</code> という名前を使い、 <code>it</code> は反復処理要素の暗黙のエイリアスです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{#each items}
  {it.name} <i class="conum" data-value="1"></i><b>(1)</b>
{/each}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>name</code> は現在の反復要素に対して解決されます。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>もう一つの形式は、 <code>for</code> という名前を使い、反復要素を参照するために使われるエイリアスを指定します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{#for item in items} <i class="conum" data-value="1"></i><b>(1)</b>
  {item.name}
{/for}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>item</code> は、反復処理要素に使用されるエイリアスです。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>また、ループ内の反復処理メタデータには、以下のキーでアクセスすることが可能です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>count</code> - 1 を基準としたインデックス</p>
</li>
<li>
<p><code>index</code> - ゼロ基準のインデックス</p>
</li>
<li>
<p><code>hasNext</code> - イテレーションにさらに要素がある場合は <code>true</code> とります。</p>
</li>
<li>
<p><code>isLast</code> - <code>true</code> if <code>hasNext == false</code></p>
</li>
<li>
<p><code>isFirst</code> - <code>true</code> if <code>count == 1</code></p>
</li>
<li>
<p><code>odd</code> - 要素のカウントが奇数である場合 <code>true</code></p>
</li>
<li>
<p><code>hasNext</code> - イテレーションにさらに要素がある場合に <code>true</code></p>
</li>
<li>
<p><code>indexParity</code> - は、カウント値に応じて <code>odd</code> または <code>even</code> を出力します</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>しかし、キーを直接使うことはできません。その代わり、外部スコープの変数と競合する可能性を避けるために、接頭辞が使用されます。デフォルトでは、反復処理された要素のエイリアスの後にアンダースコアを付けたものが接頭辞として使用されます。たとえば、 <code>{#each}</code> セクション (<code>{it_hasNext}</code>) の中では、 <code>hasNext</code> キーは <code>it_</code> を接頭辞として使用する必要があります。</p>
</div>
<div class="listingblock">
<div class="title"><code>each</code> イテレーションのメタデータの例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{#each items}
  {it_count}. {it.name} <i class="conum" data-value="1"></i><b>(1)</b>
  {#if it_hasNext}&lt;br&gt;{/if} <i class="conum" data-value="2"></i><b>(2)</b>
{/each}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>it_count</code> は 1 を基準としたインデックスを表します。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>&lt;br&gt;</code> は、反復処理がより多くの要素を持っている場合にのみレンダリングされます。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>また、 <code>{#for}</code> セクションの中で <code>{item_hasNext}</code> の形式で、 <code>item</code> 要素のエイリアスと使用する必要があります。</p>
</div>
<div class="listingblock">
<div class="title"><code>for</code> イテレーションのメタデータの例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{#for item in items}
  {item_count}. {item.name} <i class="conum" data-value="1"></i><b>(1)</b>
  {#if item_hasNext}&lt;br&gt;{/if} <i class="conum" data-value="2"></i><b>(2)</b>
{/for}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>item_count</code> は 1 を基準としたインデックスを表します。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>&lt;br&gt;</code> は、反復処理がより多くの要素を持っている場合にのみレンダリングされます。</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>反復処理メタデータの接頭辞は、スタンドアロンの Qute では <code>EngineBuilder.iterationMetadataPrefix()</code> によって、Quarkus アプリケーションでは <code>quarkus.qute.iteration-metadata-prefix</code> 設定プロパティーによって設定することができます。以下の 3 つの特別な定数を使用することができます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>&lt;alias_&gt;</code> - アンダースコアを接尾辞とする反復子要素のエイリアスを使用します (デフォルト)</p>
</li>
<li>
<p><code>&lt;alias?&gt;</code> - クエスチョンマークを接尾辞とする反復処理された要素のエイリアスを使用します。</p>
</li>
<li>
<p><code>&lt;none&gt;</code> - 接頭辞は使用しません。</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>for</code> 文は、1 から始まる整数でも動作します。 以下の例では、 <code>total = 3</code> .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{#for i in total}
  {i}: ({i_count} {i_indexParity} {i_even})&lt;br&gt;
{/for}</code></pre>
</div>
</div>
<div class="paragraph">
<p>出力は、以下のようになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">1: (1 odd false)
2: (2 even true)
3: (3 odd false)</code></pre>
</div>
</div>
<div class="paragraph">
<p>ループセクションは、反復する項目がないときに実行される <code>{#else}</code> ブロックも定義することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{#for item in items}
  {item.name}
{#else}
  No items.
{/for}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="if_section"><a class="anchor" href="#if_section"></a>3.5.3. If セクション</h4>
<div class="paragraph">
<p>The <code>{#if}</code> section represents a basic control flow section.
The simplest possible version accepts a single parameter and renders the content if the condition is evaluated to <code>true</code>.
A condition without an operator evaluates to <code>true</code> if the value is not considered <code>falsy</code>, i.e. if the value is not <code>null</code>, <code>false</code>, an empty collection, an empty map, an empty array, an empty string/char sequence, an empty <code>java.util.Optional</code>/<code>java.util.OptionalInt</code>/<code>java.util.OptionalLong</code>/<code>java.util.OptionalDouble</code> or a number equal to zero.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{#if item.active}
  This item is active.
{/if}</code></pre>
</div>
</div>
<div class="paragraph">
<p>条件では、以下の演算子を使うこともできます:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">オペレーター</th>
<th class="tableblock halign-left valign-top">エイリアス</th>
<th class="tableblock halign-left valign-top">優先度</th>
<th class="tableblock halign-left valign-top">例</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logical complement</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>!</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{#if !item.active}{/if}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">評価された値を反転します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">greater than</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gt</code>, <code>&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{#if item.age &gt; 43}This item is very old.{/if}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value1</code> が <code>value2</code> より大きい場合は <code>true</code> と評価されます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">greater than or equal to</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ge</code>, <code>&gt;=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{#if item.price &gt;= 100}This item is expensive.{/if}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value1</code> が <code>value2</code> 以上の場合、 <code>true</code> と評価されます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">less than</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lt</code>, <code>&lt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{#if item.price &lt; 100}This item is cheap.{/if}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value1</code> が <code>value2</code> より小さい場合は <code>true</code> と評価されます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">less than or equal to</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>le</code>, <code>&lt;=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{#if item.age &#8656; 43}This item is young.{/if}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value1</code> が <code>value2</code> 以下の場合は <code>true</code> と評価されます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">equals</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>eq</code>, <code>==</code>, <code>is</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{#if item.name eq 'Foo'}Foo item!{/if}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value1</code> が <code>value2</code> と等しい場合は <code>true</code> と評価されます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">not equals</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ne</code>, <code>!=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{#if item.name != 'Bar'}Not a Bar item!{/if}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value1</code> が <code>value2</code> と等しくない場合は <code>true</code> と評価されます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logical AND (short-circuiting)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;&amp;</code>, <code>and</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{#if item.price &gt; 100 &amp;&amp; item.isActive}Expensive and active item.{/if}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">両方のオペランドが <code>true</code> と評価された場合は <code>true</code> と評価されます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logical OR (short-circuiting)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>||</code>, <code>or</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{#if item.price &gt; 100 || item.isActive}Expensive or active item.{/if}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オペランドの 1 つが <code>true</code> と評価された場合、 <code>true</code> と評価されます。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>&gt;</code>、 <code>&gt;=</code>、 <code>&lt;</code>、および <code>&lt;=</code> には、次のルールが適用されます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>どちらのオペランドも <code>null</code> であってはなりません。</p>
</li>
<li>
<p>両方のオペランドが <code>java.lang.Comparable</code> を実装する同じ型である場合、比較を実行するために <code>Comparable#compareTo (T)</code> メソッドが使用されます。</p>
</li>
<li>
<p>それ以外の場合は、まず両方のオペランドが <code>java.math.BigDecimal</code> に強制変換され、次に <code>BigDecimal#compareTo (BigDecimal)</code> メソッドを使用して比較が実行されます。</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
強制変換をサポートする型には、 <code>BigInteger</code>、 <code>Integer</code>、 <code>Long</code>、 <code>Double</code>、 <code>Float</code>、 <code>String</code> などがあります。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>==</code> および <code>!=</code> には次のルールが適用されます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>オペランドは、まず <code>java.util.Objects#equals (Object、Object)</code> メソッドを使用してテストされます。 <code>true</code> が返された場合、オペランドは等しいとみなされます。</p>
</li>
<li>
<p>それ以外の場合、両方のオペランドが <code>null</code> ではなく、少なくとも 1 つが <code>java.lang.Number</code> のインスタンスである場合、オペランドは <code>java.math.BigDecimal</code> に強制変換され、 <code>BigDecimal#compareTo (BigDecimal)</code> メソッドを使用して比較が実行されます。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>複数の条件にも対応しています。</p>
</div>
<div class="listingblock">
<div class="title">複数条件の例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{#if item.age &gt; 10 &amp;&amp; item.price &gt; 500}
  This item is very old and expensive.
{/if}</code></pre>
</div>
</div>
<div class="paragraph">
<p>デフォルトの優先順位ルール (優先順位の高いものが優先) は括弧で上書きできます。</p>
</div>
<div class="listingblock">
<div class="title">括弧の例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{#if (item.age &gt; 10 || item.price &gt; 500) &amp;&amp; user.loggedIn}
  User must be logged in and item age must be &gt; 10 or price must be &gt; 500.
{/if}</code></pre>
</div>
</div>
<div class="paragraph">
<p>また、 <code>else</code> ブロックを何個でも追加することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{#if item.age &gt; 10}
  This item is very old.
{#else if item.age &gt; 5}
  This item is quite old.
{#else if item.age &gt; 2}
  This item is old.
{#else}
  This item is not old at all!
{/if}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="when_section"><a class="anchor" href="#when_section"></a>3.5.4. When セクション</h4>
<div class="paragraph">
<p>このセクションは、Java の <code>switch</code> や Kotlin の <code>when</code> に似ています。条件が満たされるまで、 <em>テストされた値</em> をすべてのブロックに対して順次マッチさせます。最初にマッチしたブロックが実行されます。他のすべてのブロックは無視されます(この動作は、 <code>break</code> 文が必要な Java <code>switch</code> とは異なります)。</p>
</div>
<div class="listingblock">
<div class="title"><code>when</code> / <code>is</code> の名前のエイリアスを使用した例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{#when items.size}
  {#is 1} <i class="conum" data-value="1"></i><b>(1)</b>
    There is exactly one item!
  {#is &gt; 10} <i class="conum" data-value="2"></i><b>(2)</b>
    There are more than 10 items!
  {#else} <i class="conum" data-value="3"></i><b>(3)</b>
    There are 2 -10 items!
{/when}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>パラメーターが1つだけの場合、それは等価かがテストされます。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="#when_operators">an operator</a> を使用して、一致するロジックを指定できます。
<a href="#if_section">If セクション</a> とは異なり、ネストされた演算子はサポートされません。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>else</code> は、他のブロックが値に一致しない場合に実行されます。</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title"><code>switch</code> / <code>case</code> の名前エイリアスを使用した例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{#switch person.name}
  {#case 'John'} <i class="conum" data-value="1"></i><b>(1)</b>
    Hey John!
  {#case 'Mary'}
    Hey Mary!
{/switch}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>case</code> は <code>is</code> の別名です。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>enum に解決されるテスト値は特別な扱いを受けます。 <code>is</code> / <code>case</code> ブロックのパラメーターは式として評価されるのではなく、テストされた値に対して <code>toString()</code> を呼び出した結果と比較されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{#when machine.status}
  {#is ON}
    It's running. <i class="conum" data-value="1"></i><b>(1)</b>
  {#is in OFF BROKEN}
    It's broken or OFF. <i class="conum" data-value="2"></i><b>(2)</b>
{/when}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>このブロックは <code>machine.status.toString().equals("ON")</code> の場合に実行されます</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>このブロックは、 <code>machine.status.toString().equals("OFF")</code> または <code>machine.status.toString().equals("BROKEN")</code> の場合に実行されます</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
列挙型定数は、テストされた値が利用可能な型情報を持ち、列挙型に解決された場合に検証されます。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>is</code> / <code>case</code> ブロック条件では、以下の演算子がサポートされています。</p>
</div>
<table id="when_operators" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">オペレーター</th>
<th class="tableblock halign-left valign-top">エイリアス</th>
<th class="tableblock halign-left valign-top">例</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">not equal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>!=</code>, <code>not</code>, <code>ne</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{#is not 10}</code>,<code>{#case != 10}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">greater than</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gt</code>, <code>&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{#case le 10}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">greater than or equal to</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ge</code>, <code>&gt;=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{#is &gt;= 10}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">less than</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lt</code>, <code>&lt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{#is &lt; 10}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">less than or equal to</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>le</code>, <code>&lt;=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{#case le 10}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>in</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{#is in 'foo' 'bar' 'baz'}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">not in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ni</code>,<code>!in</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{#is !in 1 2 3}</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="let_section"><a class="anchor" href="#let_section"></a>3.5.5. Let セクション</h4>
<div class="paragraph">
<p>This section allows you to define named local variables.</p>
</div>
<div class="listingblock">
<div class="title">Let</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{#let myParent=order.item.parent isActive=false age=10 price=(order.price + 10)} <i class="conum" data-value="1"></i><b>(1)</b><i class="conum" data-value="2"></i><b>(2)</b>
  &lt;h1&gt;{myParent.name}&lt;/h1&gt;
  Is active: {isActive}
  Age: {age}
  Price: {price}
{/let} <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>ローカル変数は、<a href="#literals">literal</a> を表すことができる式 (つまり <code>isActive=false</code> と <code>age=10</code>) で初期化されます。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>中置記法は、括弧を使用してグループ化する場合にのみサポートされます。例えば、 <code>price=(order.price + 10)</code> は <code>price=order.price.plus(10)</code> と同等です。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Variables are not available outside the <code>let</code> section.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The variables are not available outside the defining <code>let</code> section.
However, the end tag is optional, if missing then the section ends where the parent section ends.</p>
</div>
<div class="listingblock">
<div class="title">Let with optional end tag</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;ul&gt;
{#for item in items}
{#let price=item.price} <i class="conum" data-value="1"></i><b>(1)</b>
   &lt;li&gt;{price}&lt;/li&gt;
{! a synthetic {/let} is added here automatically !}
{/for}
&lt;/ul&gt;
{price} --&gt; BOOM! <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The local variable <code>price</code> is initialized with expression <code>item.price</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Variable <code>price</code> is not available outside the <code>let</code> section.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>ローカル変数名などのセクションパラメータのキーが <code>?</code> で終わっている場合、 <code>?</code> を除いたキーが <code>null</code> または <em>"not found"</em> に解決される場合にのみ、ローカル変数が設定されます:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{#let enabled?=true} <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b>
  {#if enabled}ON{/if}
{/let}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>true</code> は事実上 <em>default value</em> で、親スコープが <code>enabled</code> をすでに定義していない場合にのみ使用されます。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>enabled?=true</code> は <code>enabled=enabled.or(true)</code> の短縮版です。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>このセクションタグも <code>set</code> のエイリアスで登録されています。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{#set myParent=item.parent price=item.price}
  &lt;h1&gt;{myParent.name}&lt;/h1&gt;
  &lt;p&gt;Price: {price}
{/set}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="with_section"><a class="anchor" href="#with_section"></a>3.5.6. With セクション</h4>
<div class="paragraph">
<p>このセクションは、現在のコンテキストオブジェクトを設定するために使用することができます。これはテンプレート構造を単純化するのに便利かもしれません。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{#with item.parent}
  &lt;h1&gt;{name}&lt;/h1&gt;  <i class="conum" data-value="1"></i><b>(1)</b>
  &lt;p&gt;{description}&lt;/p&gt; <i class="conum" data-value="2"></i><b>(2)</b>
{/with}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>name</code> は <code>item.parent</code> に対して解決されます。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>description</code> も <code>item.parent</code> に対して解決されます。</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><a href="#typesafe_templates">タイプセーフテンプレート</a> や、<a href="#typesafe_expressions">型安全な式</a> を定義するテンプレートでは、 <code>with</code> セクションを使用してはならないことに注意してください。
これは、Qute がネストされた式を検証することを妨げるためです。
可能であれば、明示的なバインディングを宣言する <code>{#let}</code> セクションに置き換えてください。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{#let it=item.parent}
  &lt;h1&gt;{it.name}&lt;/h1&gt;
  &lt;p&gt;{it.description}&lt;/p&gt;
{/let}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>このセクションは、複数の高価な呼び出しを避けたいときにも便利かもしれません。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{#with item.callExpensiveLogicToGetTheValue(1,'foo',bazinga)}
  {#if this is "fun"} <i class="conum" data-value="1"></i><b>(1)</b>
    &lt;h1&gt;Yay!&lt;/h1&gt;
  {#else}
    &lt;h1&gt;{this} is not fun at all!&lt;/h1&gt;
  {/if}
{/with}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>this</code> は <code>item.callExpensiveLogicToGetTheValue(1,'foo',bazinga)</code> の結果です。結果が複数の式で使用されても、このメソッドは一度しか呼び出されません。</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="include_helper"><a class="anchor" href="#include_helper"></a>3.5.7. Include セクション</h4>
<div class="paragraph">
<p>このセクションは、別のテンプレートをインクルードし、場合によってはテンプレートの一部をオーバーライドするために使用することができます (下記の <em>テンプレートの継承</em> を参照)。</p>
</div>
<div class="listingblock">
<div class="title">簡単な例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;html&gt;
&lt;head&gt;
&lt;meta charset="UTF-8"&gt;
&lt;title&gt;Simple Include&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  {#include foo limit=10 /} <i class="conum" data-value="1"></i><b>(1)</b><i class="conum" data-value="2"></i><b>(2)</b>
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>id <code>foo</code> でテンプレートをインクルードします。インクルードされたテンプレートは、現在のコンテキストからデータを参照することができます。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>また、インクルードされたテンプレートで使用できるオプションのパラメーターを定義することも可能です。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, the first unnamed parameter represents the id of a template that should be included.
And it is taken as is.
For example, <code>{#include bar/foo /}</code> includes a template with id <code>bar/foo</code>; i.e. <code>src/main/resources/templates/bar/foo.html</code> could be matched.
However, it is also possible to supply the template id dynamically.
Just add the <code>_id</code> parameter to the tag.
In this case, the argument value of the <code>_id</code> parameter represents an expression that is resolved and the result represents the template id.
For example, <code>{#include _id=bar.foo /}</code> means that <code>bar.foo</code> is first resolved and then the resulting template id is used.</p>
</div>
<div class="paragraph">
<p><em>テンプレートの継承</em> により、テンプレートレイアウトの再利用が可能になります。</p>
</div>
<div class="listingblock">
<div class="title">テンプレート「ベース」</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;html&gt;
&lt;head&gt;
&lt;meta charset="UTF-8"&gt;
&lt;title&gt;{#insert title}Default Title{/}&lt;/title&gt; <i class="conum" data-value="1"></i><b>(1)</b>
&lt;/head&gt;
&lt;body&gt;
  {#insert}No body!{/} <i class="conum" data-value="2"></i><b>(2)</b>
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>insert</code> セクションは、指定されたテンプレートをインクルードするテンプレートでオーバーライドできる部分を指定するために使われます。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>insert</code> セクションは、オーバーライドされない場合にレンダリングされるデフォルトのコンテンツを定義することができます。もし名前が与えられていない場合は、関連する <code>{#include}</code> セクションのメインブロックが使用されます。</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">テンプレート「詳細」</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{#include base} <i class="conum" data-value="1"></i><b>(1)</b>
  {#title}My Title{/title} <i class="conum" data-value="2"></i><b>(2)</b>
  &lt;div&gt; <i class="conum" data-value="3"></i><b>(3)</b>
    My body.
  &lt;/div&gt;
{/include}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>include</code> セクションは、拡張テンプレートを指定するために使用されます。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>入れ子になったブロックは、オーバーライドする部分を指定するために使用されます。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>メインブロックのコンテンツは、name パラメーターが指定されていない <code>{#insert}</code> セクションに使用されます。</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
セクションブロックはオプションのエンドタグを定義することもできます - <code>{/title}</code> .
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="user_tags"><a class="anchor" href="#user_tags"></a>3.5.8. ユーザー定義タグ</h4>
<div class="paragraph">
<p>ユーザー定義タグは、<em>タグテンプレート</em> をインクルードし、オプションでいくつかの引数を渡し、場合によってはテンプレートの一部をオーバーライドするために使用することができます。たとえば、 <code>itemDetail.html</code> というタグテンプレートがあるとします。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{#if showImage} <i class="conum" data-value="1"></i><b>(1)</b>
  {it.image} <i class="conum" data-value="2"></i><b>(2)</b>
  {nested-content} <i class="conum" data-value="3"></i><b>(3)</b>
{/if}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>showImage</code> は名前付きパラメーターです。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>it</code> は、タグの最初の名前のないパラメーターに置き換えられる特別なキーです。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>(オプション) <code>nested-content</code> は、タグの内容に置き換えられる特別なキーです。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Quarkus では、 <code>src/main/resources/templates/tags</code> にあるすべてのファイルが、自動的に登録および監視されます。Qute スタンドアロンでは、解析されたテンプレートを <code>itemDetail.html</code> という名前で置き、関連する <code>UserTagSectionHelper</code> をエンジンに登録する必要があります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Engine engine = Engine.builder()
                   .addSectionHelper(new UserTagSectionHelper.Factory("itemDetail","itemDetail.html"))
                   .build();
engine.putTemplate("itemDetail.html", engine.parse("..."));</code></pre>
</div>
</div>
<div class="paragraph">
<p>そして、以下のようなタグを呼び出すことができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;ul&gt;
{#for item in items}
  &lt;li&gt;
  {#itemDetail item showImage=true} <i class="conum" data-value="1"></i><b>(1)</b>
    = &lt;b&gt;{item.name}&lt;/b&gt; <i class="conum" data-value="2"></i><b>(2)</b>
  {/itemDetail}
  &lt;/li&gt;
{/for}
&lt;/ul&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>item</code> は反復要素に解決され、タグテンプレートで <code>it</code> キーを使用して参照することができます。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>タグテンプレートで <code>nested-content</code> キーを使用して注入されたタグコンテンツ。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>デフォルトでは、タグテンプレートは親コンテキストからデータを参照できません。
Qute はタグを <em>分離された</em> テンプレートとして実行します。つまり、タグを呼び出すテンプレートのコンテキストにアクセスしません。
ただし、デフォルトの動作を変更して分離を無効にすると便利な場合があります。
その場合、呼び出しサイトに <code>_isolated=false</code> または <code>_unisolated</code> 引数を追加するします (例: <code>{#itemDetail item showImage=true _isolated=false /}</code> または <code>{#itemDetail item showImage=true _unisolated /}</code>)。</p>
</div>
<div class="sect4">
<h5 id="arguments"><a class="anchor" href="#arguments"></a>3.5.8.1. 引数</h5>
<div class="paragraph">
<p>タグテンプレート内で、名前付き引数に直接アクセスできます。
ただし、最初の引数で名前を定義する必要はなく、 <code>it</code> エイリアスを使用してアクセスできます。
さらに、引数に名前が定義されておらず、値が <code>foo</code> など単一の識別子である場合、名前はデフォルトで値の識別子に設定されます (たとえば <code>{#myTag foo /}</code> は <code>{#myTag foo=foo /}</code> になります)。
つまり、引数値 <code>foo</code> は解決され、タグテンプレート内で <code>{foo}</code> を使用してアクセスできます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
引数に名前がなく、値が <code>"foo"</code> のような 1 つの単語の文字列リテラルである場合、その名前がデフォルトに設定されて引用符は削除されます (たとえば <code>{#myTag "foo" /}</code> は <code>{#myTag foo="foo" /}</code> になります)。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>io.quarkus.qute.UserTagSectionHelper.Arguments</code> メタデータは、 <code>_args</code> エイリアスを使用してタグ内でアクセスできます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>_args.size</code> - タグに渡された引数の実際の数を返します。</p>
</li>
<li>
<p><code>_args.empty</code>/<code>_args.isEmpty</code> - 引数が渡されない場合は <code>true</code> を返します。</p>
</li>
<li>
<p><code>_args.get(String name)</code> - 指定された名前の引数値または <code>null</code> を返します。</p>
</li>
<li>
<p><code>_args.filter(String&#8230;&#8203;)</code> - 指定された名前に一致する引数を返します。</p>
</li>
<li>
<p><code>_args.filterIdenticalKeyValue</code> - 値と等しい名前を持つ引数を返します。通常は <code>{#test foo="foo" bar=true}</code> または <code>{#test "foo" bar=true /}</code> から`foo` が返されます。</p>
</li>
<li>
<p><code>_args.skip(String&#8230;&#8203;)</code> - 指定された名前と一致しない引数のみを返します。</p>
</li>
<li>
<p><code>_args.skipIdenticalKeyValue</code> - 値と等しくない名前を持つ引数のみを返します。通常は <code>{#test foo="foo" bar=true /}</code> から <code>bar</code> が返されます。</p>
</li>
<li>
<p><code>_args.skipIt</code> - 最初の名前なし引数を除くすべての引数を返します。通常は <code>{#test foo bar=true /}</code> から <code>bar</code> が返されます。</p>
</li>
<li>
<p><code>_args.asHtmlAttributes</code> - 引数を HTML 属性としてレンダリングします (例: <code>foo="true" readonly="readonly"</code>)。引数は名前のアルファベット順にソートされ、 <code>'</code>、 <code>"</code>、 <code>&lt;</code>, <code>&gt;</code>、 <code>&amp;</code> の文字はエスケープされます。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>_args</code> は 反復可能な <code>java.util.Map.Entry</code> でもあります (<code>{#each _args}{it.key}={it.value}{/each}</code>)。</p>
</div>
<div class="paragraph">
<p>たとえば、以下のように定義されたユーザータグを <code>{#test 'Martin' readonly=true /}</code> で呼び出すことができます。</p>
</div>
<div class="listingblock">
<div class="title"><code>tags/test.html</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{it} <i class="conum" data-value="1"></i><b>(1)</b>
{readonly} <i class="conum" data-value="2"></i><b>(2)</b>
{_args.filter('readonly').asHtmlAttributes} <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>it</code> はタグの最初の名前なしパラメーターに置き換えられます。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>readonly</code> は名前付きパラメーターです。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>_args</code> は引数のメタデータを表します。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>結果は次のようになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Martin
true
readonly="true"</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="inheritance"><a class="anchor" href="#inheritance"></a>3.5.8.2. 継承</h5>
<div class="paragraph">
<p>ユーザータグも、通常の <code>{#include}</code> セクションと同じように、テンプレートの継承を利用することができます。</p>
</div>
<div class="listingblock">
<div class="title">タグ <code>myTag</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">This is {#insert title}my title{/title}! <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>insert</code> セクションは、指定されたテンプレートをインクルードするテンプレートでオーバーライドできる部分を指定するために使われます。</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">タグ呼び出しサイト</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;p&gt;
  {#myTag}
    {#title}my custom title{/title} <i class="conum" data-value="1"></i><b>(1)</b>
  {/myTag}
&lt;/p&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>結果は、 <code>&lt;p&gt;This is my custom title!&lt;/p&gt;</code> のようになります。</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="fragments"><a class="anchor" href="#fragments"></a>3.5.9. フラグメント</h4>
<div class="paragraph">
<p>フラグメントはテンプレートの一部を表し、個別のテンプレートとして扱うことができます。
この機能を導入する主な動機の1つは、 <a href="https://htmx.org/essays/template-fragments/">htmxフラグメント</a> のようなユースケースをサポートすることでした。</p>
</div>
<div class="paragraph">
<p>フラグメントは <code>{#fragment}</code> セクションで定義することができます。 各フラグメントは、英数字とアンダースコアのみからなる識別子を持ちます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
フラグメント識別子は、テンプレート内で一意でなければならないことに注意してください。
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title"><code>item.html</code> 内でのフラグメントの定義</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{@org.acme.Item item}
{@java.util.List&lt;String&gt; aliases}

&lt;h1&gt;Item - {item.name}&lt;/h1&gt;

&lt;p&gt;This document contains a detailed info about an item.&lt;/p&gt;

{#fragment id=item_aliases} <i class="conum" data-value="1"></i><b>(1)</b>
&lt;h2&gt;Aliases&lt;/h2&gt;
&lt;ol&gt;
    {#for alias in aliases}
    &lt;li&gt;{alias}&lt;/li&gt;
    {/for}
&lt;/ol&gt;
{/fragment}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>識別子 <code>item_aliases</code> を持つフラグメントを定義します。識別子には英数字とアンダースコアしか使えないことに注意してください。最初のパラメータ名は省略可能で、 <code>{#fragment item_aliases}</code> でもかまいません。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>io.quarkus.qute.Template.getFragment(String)</code> メソッドにより、プログラム的にフラグメントを取得することができます。</p>
</div>
<div class="listingblock">
<div class="title">フラグメントの取得</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
Template item;

String useTheFragment() {
   return item.getFragment("item_aliases") <i class="conum" data-value="1"></i><b>(1)</b>
            .data("aliases", List.of("Foo","Bar")) <i class="conum" data-value="2"></i><b>(2)</b>
            .render();
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>識別子 <code>item_aliases</code> を持つテンプレートフラグメントを取得します。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>データが正しく設定されているようにします。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>上記のスニペットは、次のようにレンダリングされるはずです:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;h2&gt;Aliases&lt;/h2&gt;
&lt;ol&gt;
    &lt;li&gt;Foo&lt;/li&gt;
    &lt;li&gt;Bar&lt;/li&gt;
&lt;/ol&gt;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Quarkus では、<a href="#type_safe_fragments">type-safe fragment</a> も定義できます。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>また、 <code>{#include}</code> セクションを持つフラグメントを、別のテンプレートや、フラグメントを定義したテンプレートの中に含めることもできます。
フラグメントは、 <code>frg:</code> / <code>fragment:</code> 名前空間を持つ式でも使用できます。</p>
</div>
<div class="listingblock">
<div class="title"><code>user.html</code> にフラグメントをインクルード</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;h1&gt;User - {user.name}&lt;/h1&gt;

&lt;p&gt;
{#fragment fullname}
{name} &lt;strong&gt;{surname}&lt;/strong&gt;
{/fragment}
&lt;/p&gt;

&lt;p&gt;This document contains a detailed info about a user.&lt;/p&gt;

{#include item$item_aliases aliases=user.aliases /} <i class="conum" data-value="1"></i><b>(1)</b><i class="conum" data-value="2"></i><b>(2)</b>

{frg:fullname} is a happy user! <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>ドル記号 <code>$</code> を含むテンプレート識別子は、フラグメントを表します。 <code>item$item_aliases</code> の値は、次のように訳されます: <em>テンプレート <code>item</code> からフラグメント <code>item_aliases</code> を使用します。</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>aliases</code> パラメーターは、関連するデータを渡すために使用されます。データが正しく設定されていることを確認する必要があります。この特定のケースでは、フラグメントは <code>{#for alias in aliases}</code> セクションの <code>aliases</code> の値として式 <code>user.aliases</code> を使用します。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>{frg:username}</code> 式は、フラグメントの内容を出力します。 <code>frg:</code> は、 <code>fragment:</code> に置き換えることができます。</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
同じテンプレートからフラグメントを参照する場合は、 <code>$</code> の前の部分、つまり <code>{#include $item_aliases /}</code> のような部分をスキップしてください。
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
この機能を無効にするために、 <code>{#include item$item_aliases _ignoreFragments=true /}</code> を指定することができます。つまり、テンプレート識別子にドル記号 <code>$</code> を指定しても、フラグメント検索は行われません。
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="hidden-fragments-capture"><a class="anchor" href="#hidden-fragments-capture"></a>3.5.9.1. 非表示（hidden）フラグメント（キャプチャ）</h5>
<div class="paragraph">
<p>デフォルトでは、フラグメントは通常オリジナルテンプレートの一部としてレンダリングされます。
しかし、フラグメントを <em>非表示</em> にすると便利な場合もあります。
通常のフラグメントセクションは、非表示フラグメントを意味する <code>capture</code> というエイリアスを持ちます。
また、 <code>rendered=false</code> または <code>_hidden</code> パラメータを使用して、フラグメントを「非表示」することもできます。興味深い使用例として、フラグメントを定義するテンプレート内で複数回使用できるフラグメントがあります。</p>
</div>
<div class="listingblock">
<div class="title"><code>item.html</code> における非表示フラグメントの定義</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{#capture strong} <i class="conum" data-value="1"></i><b>(1)</b>
&lt;strong&gt;{val}&lt;/strong&gt;
{/capture}

&lt;h1&gt;My page&lt;/h1&gt;
&lt;p&gt;This document
{#include $strong val='contains' /} <i class="conum" data-value="2"></i><b>(2)</b>
a lot of
{capture:strong(param:val = 'information')} <i class="conum" data-value="3"></i><b>(3)</b> <i class="conum" data-value="4"></i><b>(4)</b>
!&lt;/p&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>識別子 <code>strong</code> を持つ非表示フラグメントを定義します。
<code>{#capture strong}</code> は <code>{#fragment strong rendered=false}</code> または <code>{#fragment strong _hidden}</code> に置き換えることができます。
<code>rendered</code> パラメータには任意の式を使用できます (例: <code>{#fragment strong rendered=config.isRendered}</code>)。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>フラグメント <code>strong</code> をインクルードし、値を渡します。構文 <code>$strong</code> に注意してください。これは、現在のテンプレートからフラグメント <code>strong</code> をインクルードするように処理されます。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>名前空間リゾルバを使用して、非表示のフラグメントにアクセスすることもできます。 <code>capture:</code> は、 <code>cap:</code> に置き換えることができます。</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>param:val = 'information'</code> は、名前付きパラメータをフラグメントに渡すために使われます。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>上のスニペットは、次のようにレンダリングされます:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;h1&gt;My page&lt;/h1&gt;
&lt;p&gt;This document
&lt;strong&gt;contains&lt;/strong&gt;
a lot of
&lt;strong&gt;information&lt;/strong&gt;
!&lt;/p&gt;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Quarkus では、名前空間リゾルバが名前空間 <code>frg</code> 、 <code>fragment</code> 、 <code>cap</code> 、 <code>capture</code> に対して自動的に登録されます。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="eval-section"><a class="anchor" href="#eval-section"></a>3.5.10. Eval セクション</h4>
<div class="paragraph">
<p>このセクションは、テンプレートを動的に解析および評価するために使用できます。
動作は <a href="#include_helper">Include セクション</a> によく似ています。ただし、</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>テンプレートの内容は、 <code>io.quarkus.qute.TemplateLocator</code> を介して取得されるのではなく、直接渡されます。</p>
</li>
<li>
<p>評価済みテンプレートの一部をオーバーライドすることはできません。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{#eval myData.template name='Mia' /} <i class="conum" data-value="1"></i><b>(1)</b><i class="conum" data-value="2"></i><b>(2)</b><i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>myData.template</code> の結果がテンプレートとして使用されます。テンプレートは <a href="#current_context_object">カレントコンテキスト</a> で実行されます。つまり、インクルードされているテンプレートのデータを参照することができます。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>また、評価済みテンプレートで使用可能なオプションのパラメーターを定義することも可能です。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>セクションの内容は常に無視されます。</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
評価済みテンプレートは、セクションが実行されるたびに解析および評価されます。
つまり、リソースを節約してパフォーマンスを最適化するために、解析された値をキャッシュすることはできません。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="cached-section"><a class="anchor" href="#cached-section"></a>3.5.11. キャッシュされたセクション</h4>
<div class="paragraph">
<p>めったに変更されないテンプレートの一部をキャッシュすることが実用的な場合もあります。キャッシュ機能を使うには、組み込みの <code>io.quarkus.qute.CacheSectionHelper.Factory</code> を登録・設定します:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// A simple map-based cache
ConcurrentMap&lt;String, CompletionStage&lt;ResultNode&gt;&gt; map = new ConcurrentHashMap&lt;&gt;();
engineBuilder
    .addSectionHelper(new CacheSectionHelper.Factory(new Cache() {
        @Override
        public CompletionStage&lt;ResultNode&gt; getValue(String key,
           Function&lt;String, CompletionStage&lt;ResultNode&gt;&gt; loader) {
              return map.computeIfAbsent(key, k -&gt; loader.apply(k));
           }
     })).build();</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Quarkus アプリケーションに <code>quarkus-cache</code> エクステンションが存在する場合、 <code>CacheSectionHelper</code> が登録され、<em>自動的</em> に設定されます。キャッシュの名前は <code>qute-cache</code> です。これは <a href="cache#configuring-the-underlying-caching-provider">in a standard way</a> と定義でき、 <code>@Inject @CacheName("qute-cache") Cache</code> を介してプログラムで管理することもできます。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>その後、{#cached}` セクションをテンプレート内で使用できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{#cached} <i class="conum" data-value="1"></i><b>(1)</b>
 Result: {service.findResult} <i class="conum" data-value="2"></i><b>(2)</b>
{/cached}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>key</code> パラメーターが使用されていない場合は、テンプレートのすべてのクライアントが同じキャッシュ値を共有します。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>テンプレートのこの部分はキャッシュされ、キャッシュエントリーが見つからない、または無効になっている場合にのみ <code>{service.findResult}</code> 式が評価されます。</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{#cached key=currentUser.username} <i class="conum" data-value="1"></i><b>(1)</b>
 User-specific result: {service.findResult(currentUser)}
{/cached}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>key</code> パラメーターが設定されているため、 <code>{currentUser.username}</code> の結果ごとに異なるキャッシュ値が使用されます。</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
キャッシュを使用する場合、特定のキーでキャッシュエントリーを無効にするオプションを持つことが非常に重要です。Qute では、キャッシュエントリーのキーは、テンプレート名、開始 <code>{#cached}</code> タグの行と列、およびオプションの <code>key</code> パラメーターで構成される <code>String</code> (<code>{TEMPLATE}:{LINE}:{COLUMN}_{KEY}</code>) です。たとえば、 <code>foo.html:10:1_alpha</code> はテンプレート`foo.html` のキャッシュされたセクションのキーであり、 <code>{#cached}</code> タグは 10 行目の 1 列目に配置されます。オプションの <code>key</code> パラメーターは <code>alpha</code> に解決されます。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rendering-output"><a class="anchor" href="#rendering-output"></a>3.6. レンダリング出力</h3>
<div class="paragraph">
<p><code>TemplateInstance</code> は、レンダリングをトリガーして結果を消費するためのいくつかの方法を提供しています。最も簡単な方法は <code>TemplateInstance.render()</code> です。このメソッドは同期レンダリングをトリガーし、レンダリングが終了するまで現在のスレッドをブロックして出力を返します。対照的に、 <code>TemplateInstance.renderAsync()</code> は <code>CompletionStage&lt;String&gt;</code> を返し、レンダリングが終了すると完了します。</p>
</div>
<div class="listingblock">
<div class="title"><code>TemplateInstance.renderAsync()</code> Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">template.data(foo).renderAsync().whenComplete((result, failure) -&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
   if (failure == null) {
      // consume the output...
   } else {
      // process failure...
   }
};</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>レンダリング終了後に実行されるコールバックを登録します。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>また、 <a href="https://smallrye.io/smallrye-mutiny/">Mutiny</a> 型を返す2つのメソッドがあります。 <code>TemplateInstance.createUni()</code> は新しい <code>Uni&lt;String&gt;</code> オブジェクトを返します。 <code>createUni()</code> を呼び出しても、テンプレートはすぐにレンダリングされません。その代わり、 <code>Uni.subscribe()</code> が呼び出されるたびに、テンプレートの新しいレンダリングがトリガーされます。</p>
</div>
<div class="listingblock">
<div class="title"><code>TemplateInstance.createUni()</code> Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">template.data(foo).createUni().subscribe().with(System.out::println);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>TemplateInstance.createMulti()</code> は新しい <code>Multi&lt;String&gt;</code> オブジェクトを返します。
各アイテムはレンダリングされたテンプレートの一部/チャンクを表します。
繰り返しになりますが、 <code>createMulti()</code> はレンダリングをトリガーしません。
代わりに、サブスクライバーによって計算がトリガーされるたびに、テンプレートが再びレンダリングされます。</p>
</div>
<div class="listingblock">
<div class="title"><code>TemplateInstance.createMulti()</code> Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">template.data(foo).createMulti().subscribe().with(buffer:append,buffer::flush);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
テンプレートのレンダリングは2つのフェーズに分かれています。最初のフェーズ(非同期)では、テンプレート内のすべての式が解決され、 <em>結果ツリー</em> が構築されます。同期的な第2フェーズでは、結果ツリーが <em>マテリアライズされ</em> 、結果ノードが1つずつ、特定のコンシューマによって消費/バッファリングされるチャンクを出力します。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="engine-configuration"><a class="anchor" href="#engine-configuration"></a>3.7. エンジン設定</h3>
<div class="sect3">
<h4 id="value-resolvers"><a class="anchor" href="#value-resolvers"></a>3.7.1. 値リゾルバ</h4>
<div class="paragraph">
<p>値リゾルバーは式を評価するときに使用されます。
まず、指定された <code>EvalContext</code> に適用されるリゾルバーがフィルタリングされます。
次に、_ 優先度が最も高い _ リゾルバーを使用してデータを解決します。
<code>io.quarkus.qute.Results.NotFound</code> オブジェクトが返された場合は、代わりに次の利用可能なリゾルバーが使用されます。
ただし、戻り値 <code>null</code> は有効な結果と見なされます。</p>
</div>
<div class="paragraph">
<p>カスタム <code>io.quarkus.qute.ValueResolver</code> は、 <code>EngineBuilder.addValueResolver()</code> を介してプログラムで登録できます。</p>
</div>
<div class="listingblock">
<div class="title"><code>ValueResolver</code> ビルダー例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">engineBuilder.addValueResolver(ValueResolver.builder()
    .appliesTo(ctx -&gt; ctx.getBase() instanceof Long &amp;&amp; ctx.getName().equals("tenTimes"))
    .resolveSync(ctx -&gt; (Long) ctx.getBase() * 10)
    .build());</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Quarkus では、<a href="#engine-customization"><code>@EngineConfiguration</code></a> アノテーションを使用して、CDI Bean として実装された <code>ValueResolver</code> を登録できます。
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
リフレクションベースの値リゾルバーの優先度は -1 であり、 <a href="#template_data"><code>@TemplateData</code></a> から生成されたリゾルバーの最大優先度値および <a href="#typesafe_expressions">type-safe expressions</a> は <code>10</code> です。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="template-locator"><a class="anchor" href="#template-locator"></a>3.7.2. テンプレートロケーター</h4>
<div class="paragraph">
<p>テンプレートは、手動で登録するか、テンプレートロケータを介して自動的に登録することができます。ロケーターは、 <code>Engine.getTemplate()</code> メソッドが呼び出されたときに、エンジンがキャッシュに保存している所定の ID のテンプレートがない場合に使用されます。ロケーターは、テンプレートの内容を読み取る際に、正しい文字エンコーディングを使用する責任があります。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Quarkus では、 <code>src/main/resources/templates</code> にあるすべてのテンプレートが自動的に配置され、 <code>quarkus.qute.default-charset</code> (デフォルトは UTF-8) で設定したエンコーディングが使用されます。
カスタムロケーターは、 <code>@Locate</code> アノテーションを使用して <a href="#template-locator-registration">registered</a> を行うことができます。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="content-filters"><a class="anchor" href="#content-filters"></a>3.7.3. コンテンツフィルタ</h4>
<div class="paragraph">
<p>コンテンツフィルタを使用して、解析前にテンプレートコンテンツを変更することができます。</p>
</div>
<div class="listingblock">
<div class="title">コンテンツフィルター例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">engineBuilder.addParserHook(new ParserHook() {
    @Override
    public void beforeParsing(ParserHelper parserHelper) {
        parserHelper.addContentFilter(contents -&gt; contents.replace("${", "$\\{")); <i class="conum" data-value="1"></i><b>(1)</b>
    }
});</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>すべての <code>${</code> との一致をエスケープします。</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="strict_rendering"><a class="anchor" href="#strict_rendering"></a>3.7.4. strict レンダリング</h4>
<div class="paragraph">
<p>strict レンダリングにより、開発者は、タイプミスや無効な式によって引き起こされるわかりにくいエラーをキャッチすることができます。この機能を有効にすると、解決できない式、つまり <code>io.quarkus.qute.Results.NotFound</code> のインスタンスとして評価される式は、常に <code>TemplateException</code> となり、レンダリングは中断されます。 <code>NotFound</code> 値は基本的に、値リゾルバーが式を正しく解決できなかったことを意味するため、エラーとみなされます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
しかし、 <code>null</code> は有効な値です。<a href="#if_section">If セクション</a> にあるように <code>falsy</code> とみなされ、何も出力されません。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>strict レンダリングはデフォルトで有効になっています。しかし、 <code>io.quarkus.qute.EngineBuilder.strictRendering(boolean)</code> によって、この機能を無効にすることができます。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Quarkus では、専用の config プロパティーである <code>quarkus.qute.strict-rendering</code> を代わりに使用することができます。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>"not found" エラーを引き起こす可能性のある式をどうしても使いたい場合は、<em>デフォルト値</em> および <em>安全な式</em> を使ってエラーを抑制することができます。デフォルト値は、式の前のパーツが解決できないか、 <code>null</code> に解決される場合に使用されます。エルビス演算子を使ってデフォルト値 <code>{foo.bar ?: 'baz'}</code> を出力することができます。これは事実上、仮想メソッド <code>{foo.bar.or('baz')}</code> と同じになります。安全な式は <code>??</code> という接尾辞で終わり、式が解決できない場合は <code>null</code> という結果になります。これは、たとえば <code>{#if}</code> セクションの <code>{#if valueNotFound??}Only rendered if valueNotFound is truthy!{/if}</code> では非常に便利です。実際のところ、 <code>??</code> は <code>.or(null)</code> の簡単な表記法に過ぎず、たとえば <code>{#if valueNotFound??}</code> は <code>{#if valueNotFound.or(null)}</code> となります。</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="quarkus_integration"><a class="anchor" href="#quarkus_integration"></a>4. Quarkus 統合</h2>
<div class="sectionbody">
<div class="paragraph">
<p>QuarkusアプリケーションでQuteを使用する場合は、次の依存関係をプロジェクトに追加します:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-qute&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Quarkusでは、事前に設定されたエンジンインスタンスが提供され、インジェクションに利用できます。 <code>@ApplicationScoped</code> スコープのBean、 <code>io.quarkus.qute.Engine</code> 型のBean、 <code>@Default</code> 修飾子が自動的に登録されます。さらに、 <code>src/main/resources/templates</code> ディレクトリーにあるすべてのテンプレートが検証され、簡単にインジェクションすることができます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
有効なテンプレートファイル名は、空白以外の文字のシーケンスです。たとえば、名前が <code>foo and bar.html</code> のテンプレートファイルは無視されます。
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.quarkus.qute.Engine;
import io.quarkus.qute.Template;
import io.quarkus.qute.Location;

class MyBean {

    @Inject
    Template items; <i class="conum" data-value="1"></i><b>(1)</b>

    @Location("detail/items2_v1.html") <i class="conum" data-value="2"></i><b>(2)</b>
    Template items2;

    @Inject
    Engine engine; <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Location</code> 修飾子が与えられていない場合は、フィールド名がテンプレートを特定するために使われます。この特定のケースでは、コンテナーはパス <code>src/main/resources/templates/items.html</code> でテンプレートを見つけようとします。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>Location</code> 修飾子は、 <code>src/main/resources/templates</code> からの相対パスからテンプレートを注入するようにコンテナーに指示します。この場合のフルパスは <code>src/main/resources/templates/detail/items2_v1.html</code> です。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>設定された <code>Engine</code> インスタンスを注入します。</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="engine-customization"><a class="anchor" href="#engine-customization"></a>4.1. エンジンのカスタマイズ</h3>
<div class="paragraph">
<p>追加のコンポーネントは、実行時に CDI オブザーバーメソッドの <code>EngineBuilder</code> メソッドを使用して手動で登録できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.quarkus.qute.EngineBuilder;

class MyBean {

    void configureEngine(@Observes EngineBuilder builder) {
       // Add a custom section helper
       builder.addSectionHelper(new CustomSectionFactory());
       // Add a custom value resolver
       builder.addValueResolver(ValueResolver.builder()
                .appliesTo(ctx -&gt; ctx.getBase() instanceof Long &amp;&amp; ctx.getName().equals("tenTimes"))
                .resolveSync(ctx -&gt; (Long) ec.getBase() * 10)
                .build());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>ただし、この特定のケースでは、ビルド時の検証でセクションヘルパーファクトリーは無視されます。
ビルド時のテンプレート検証に参加する登録する場合は、便利な <code>@EngineConfiguration</code> アノテーションを使用します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.quarkus.qute.EngineConfiguration;
import io.quarkus.qute.SectionHelper;
import io.quarkus.qute.SectionHelperFactory;

@EngineConfiguration <i class="conum" data-value="1"></i><b>(1)</b>
public class CustomSectionFactory implements SectionHelperFactory&lt;CustomSectionFactory.CustomSectionHelper&gt; {

    @Inject
    Service service; <i class="conum" data-value="2"></i><b>(2)</b>

    @Override
    public List&lt;String&gt; getDefaultAliases() {
        return List.of("custom");
    }

    @Override
    public ParametersInfo getParameters() {
        // Param "foo" is required
        return ParametersInfo.builder().addParameter("foo").build(); <i class="conum" data-value="3"></i><b>(3)</b>
    }

    @Override
    public Scope initializeBlock(Scope outerScope, BlockInfo block) {
        block.addExpression("foo", block.getParameter("foo"));
        return outerScope;
    }


    @Override
    public CustomSectionHelper initialize(SectionInitContext context) {
        return new CustomSectionHelper();
    }

    class CustomSectionHelper implements SectionHelper {

        private final Expression foo;

        public CustomSectionHelper(Expression foo) {
            this.foo = foo;
        }

        @Override
        public CompletionStage&lt;ResultNode&gt; resolve(SectionResolutionContext context) {
            return context.evaluate(foo).thenApply(fooVal -&gt; new SingleResultNode(service.getValueForFoo(fooVal))); <i class="conum" data-value="4"></i><b>(4)</b>
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@EngineConfiguration</code> アノテーションが付けられた <code>SectionHelperFactory</code> は、ビルド時のテンプレート検証で使用され、実行時に (a) セクションファクトリー、および、(b) CDI Bean として自動的に登録されます。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>CDI Beanインスタンスは実行時に使用されます - これはファクトリーが注入ポイントを定義できることを意味します</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>foo</code> パラメーターが常に存在することを検証します。たとえば、 <code>{#custom foo='bar' /}</code> は問題ありませんが、 <code>{#custom /}</code> はビルド時に失敗します。</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>レンダリング時に注入された <code>Service</code> を使用します。</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<code>@EngineConfiguration</code> アノテーションは、 <code>ValueResolver</code>、 <code>NamespaceResolver</code>、および <code>ParserHook</code> コンポーネントを登録するためにも使用できます。
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="template-locator-registration"><a class="anchor" href="#template-locator-registration"></a>4.1.1. テンプレートロケーターの登録</h4>
<div class="paragraph">
<p><a href="#template-locator">テンプレートロケーター</a> を登録する最も簡単な方法は、これらを CDI Bean にすることです。テンプレート検証を行うビルド時にはカスタムロケーターは利用できないので、 <code>@Locate</code> アノテーションで検証を無効化する必要があります。</p>
</div>
<div class="listingblock">
<div class="title">カスタムロケーターの例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Locate("bar.html") <i class="conum" data-value="1"></i><b>(1)</b>
@Locate("foo.*") <i class="conum" data-value="2"></i><b>(2)</b>
public class CustomLocator implements TemplateLocator {

    @Inject <i class="conum" data-value="3"></i><b>(3)</b>
    MyLocationService myLocationService;

    @Override
    public Optional&lt;TemplateLocation&gt; locate(String templateId) {

        return myLocationService.getTemplateLocation(templateId);
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>実行時に、カスタムロケーターによって <code>bar.html</code> という名前のテンプレートが配置されます。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>正規表現 <code>foo.*</code> は、名前が <code>foo</code> で始まるテンプレートのバリデーションを無効にします。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>注入フィールドは <code>@Locate</code> でアノテーションされたテンプレートロケーターとして解決され、シングルトンセッション Bean として登録されます。</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="template-variants"><a class="anchor" href="#template-variants"></a>4.2. テンプレートバリアント</h3>
<div class="paragraph">
<p>場合によっては、コンテンツネゴシエーションに基づき、テンプレートの特定バリアントをレンダリングすると便利です。
これは <code>TemplateInstance.setVariant()</code> を使用して特別な属性を設定することで実行できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class MyService {

    @Inject
    Template items; <i class="conum" data-value="1"></i><b>(1)</b>

    @Inject
    ItemManager manager;

    String renderItems() {
       return items.data("items", manager.findItems())
                   .setVariant(new Variant(Locale.getDefault(), "text/html", "UTF-8"))
                   .render();
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>quarkus-rest-qute</code> または <code>quarkus-resteasy-qute</code> を使用すると、コンテンツネゴシエーションが自動的に実行されます。
詳細は、<a href="#rest_integration"> REST インテグレーション</a> セクションを参照してください。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="injecting-beans-directly-in-templates"><a class="anchor" href="#injecting-beans-directly-in-templates"></a>4.3. テンプレートに直接Beansを注入</h3>
<div class="paragraph">
<p><code>@Named</code> でアノテーションされた CDI Bean は、 <code>cdi</code> や <code>inject</code> 名前空間を通して、任意のテンプレートで参照することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{cdi:personService.findPerson(10).name} <i class="conum" data-value="1"></i><b>(1)</b>
{inject:foo.price} <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>まず、 <code>personService</code> という名前の Bean が見つかり、それをベースオブジェクトとして使用します。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>まず、 <code>foo</code> という名前のBeanを見つけ、それをベースオブジェクトとして使用します。</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>@Named @Dependent</code> Bean は、1 つのレンダリング操作用にテンプレート内のすべての式で共有され、レンダリングが終了した後に破棄されます。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>名前空間 <code>cdi</code> と <code>inject</code> を含むすべての式は、ビルド時に検証されます。
<code>cdi:personService.findPerson(10).name</code> という式では、注入される Bean の実装クラスは <code>findPerson</code> メソッドを宣言しているか、マッチする <a href="#template_extension_methods">template extension method</a> が存在しなければなりません。
<code>inject:foo.price</code> という式では、注入される Bean の実装クラスは <code>price</code> プロパティー (例: <code>getPrice()</code> メソッド) を持つか、マッチする <a href="#template_extension_methods">template extension method</a> が存在しなければなりません。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>@Named</code> でアノテーションされたすべてのBeanに対して <code>ValueResolver</code> も生成され、そのプロパティーにリフレクションなしでアクセスできるようになります。
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
アプリケーションが <a href="http-reference">HTTP リクエスト</a> を提供する場合、 <code>inject</code> 名前空間を介して現在の <code>io.vertx.core.http.HttpServerRequest</code> を注入することもできます (例: <code>{inject:vertxRequest.getParam('foo')}</code>)。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>場合によっては、 <code>@Named</code> アノテーションが付けられていない CDI Bean のパブリックメソッドとプロパティーにアクセスする必要がある場合があります。
ただし、Bean のソースを制御していない場合は、 <code>@Named</code> アノテーションを追加できません。
ただし、 <code>@Named</code> アノテーションが付けられた中間 CDI Bean を作成することは可能です。
この中間 Bean は、問題の Bean を注入してアクセス可能にできます。
Java レコードは、このような中間 CDI Bean を定義するのに非常に便利な方法です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Named <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b>
public record UserData(UserInfo info, @LoggedIn String username) { <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>value</code> メンバーによって名前が明示的に指定されていない場合は、 <a href="https://jakarta.ee/specifications/cdi/4.1/jakarta" class="bare">https://jakarta.ee/specifications/cdi/4.1/jakarta</a> -cdi-spec-4.1#default_name[デフォルト名が割り当てられます] (最初の文字を小文字に変換した後の Bean クラスの単純な名前)。この特定のケースでは、デフォルト名は <code>userData</code> です。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>@Singleton</code> スコープが自動的に追加されます。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>標準コンストラクターのパラメーターはすべて注入ポイントです。アクセサーメソッドを使用して、注入された Bean を取得できます。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>そしてテンプレートでは <code>{cdi:userData.info}</code> または <code>{cdi:userData.username}</code> です。</p>
</div>
</div>
<div class="sect2">
<h3 id="typesafe_expressions"><a class="anchor" href="#typesafe_expressions"></a>4.4. 型安全な式</h3>
<div class="paragraph">
<p>テンプレート式は、オプションでタイプセーフにすることができます。これは、式が既存のJavaの型とテンプレート拡張メソッドに対して検証されることを意味します。無効な/不正確な式が見つかった場合、ビルドは失敗します。</p>
</div>
<div class="paragraph">
<p>例えば、 <code>item.name</code> という式があり、 <code>item</code> が <code>org.acme.Item</code> にマップされている場合、 <code>Item</code> には <code>name</code> というプロパティーがあるか、一致するテンプレート拡張メソッドが存在しなければなりません。</p>
</div>
<div class="paragraph">
<p>オプションの <em>パラメーター宣言</em> は、最初のパートがパラメーター名と一致する式に Java 型をバインドするために使用されます。パラメーター宣言はテンプレートで直接指定します。</p>
</div>
<div class="paragraph">
<p>Java タイプは、 <code>java.lang</code> パッケージの JDK タイプでない限り、常に <em>fully qualified name</em> で識別される必要があります。この場合、パッケージ名はオプションになります。パラメーター化されたタイプもサポートされていますが、ワイルドカードは常に無視され、上限と下限のみが考慮されます。たとえば、パラメーター宣言 <code>{@java.util.List&lt;? extends org.acme.Foo&gt; list}</code> は <code>{@java.util.List&lt;org.acme.Foo&gt; list}</code> として認識されます。タイプ変数は特別な方法で扱われることはないため、決して使用しないでください。</p>
</div>
<div class="listingblock">
<div class="title">パラメーター宣言の例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{@org.acme.Foo foo} <i class="conum" data-value="1"></i><b>(1)</b>
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset="UTF-8"&gt;
&lt;title&gt;Qute Hello&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;h1&gt;{title}&lt;/h1&gt; <i class="conum" data-value="2"></i><b>(2)</b>
  Hello {foo.message.toLowerCase}! <i class="conum" data-value="3"></i><b>(3)</b> <i class="conum" data-value="4"></i><b>(4)</b>
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>パラメーター宣言 - <code>foo</code> を <code>org.acme.Foo</code> にマップします。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>検証されていません - パラメーター宣言にマッチしません。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>この式は検証されています。 <code>org.acme.Foo</code> はプロパティー <code>message</code> を持つか、一致するテンプレート拡張メソッドが存在しなければなりません。</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>同様に、 <code>foo.message</code> から解決されたオブジェクトの Java 型は、プロパティー <code>toLowerCase</code> を持つか、一致するテンプレート拡張メソッドが存在しなければなりません。</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
パラメーター宣言で使用されるすべての型に対して値リゾルバが自動的に生成され、そのプロパティーにリフレクションなしでアクセスできるようになります。
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<a href="#typesafe_templates">type-safe templates</a> のメソッドパラメーターは、自動的にパラメーター宣言に変換されます。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>セクションは、パラメーター宣言にマッチする名前をオーバーライドできることに注意してください。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{@org.acme.Foo foo}
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset="UTF-8"&gt;
&lt;title&gt;Qute Hello&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;h1&gt;{foo.message}&lt;/h1&gt; <i class="conum" data-value="1"></i><b>(1)</b>
  {#for foo in baz.foos}
    &lt;p&gt;Hello {foo.message}!&lt;/p&gt; <i class="conum" data-value="2"></i><b>(2)</b>
  {/for}
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>org.acme.Foo</code> に対して検証されています。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>検証されていません - <code>foo</code> はループセクションでオーバーライドされています。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>パラメーター宣言では、キーの後に <em>default value</em> を指定することができます。キーとデフォルト値は等号で区切られます (<code>{@int age=10}</code>)。 デフォルト値は、パラメーターのキーが <code>null</code> に解決されるか、見つからない場合に、テンプレート内で使用されます。</p>
</div>
<div class="paragraph">
<p>たとえば、パラメーター宣言 <code>{@String foo="Ping"}</code> があり、 <code>foo</code> が見つからない場合、 <code>{foo}</code> を使用すると <code>Ping</code> が出力されます。一方、(たとえば <code>TemplateInstance.data("foo", "Pong")</code> を介して) 値が設定されている場合は、 <code>{foo}</code> の出力は <code>Pong</code> となります。</p>
</div>
<div class="paragraph">
<p>デフォルト値の型は、パラメーター宣言の型に割り当て可能でなければなりません。これは、ビルドの失敗につながる誤ったパラメーター宣言の例です: <code>{@org.acme.Foo foo=1}</code>。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
実際のデフォルト値は <a href="#expressions">expression</a> です。そのため、デフォルト値はリテラル (<code>42</code> や <code>true</code> など) である必要はありません。たとえば、 <code>@TemplateEnum</code> を使用して、パラメーター宣言のデフォルト値として enum 定数を指定できます (<code>{@org.acme.MyEnum myEnum=MyEnum:FOO}</code>)。
しかし、括弧を使用してグループ化されていない限り (例: <code>{@org.acme.Foo foo=(foo1 ?: foo2)}</code>)、デフォルト値で中置記法はサポートされません。
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<a href="#standalone">Qute standalone</a> では、デフォルト値のタイプは検証されません。
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">その他のパラメーター宣言の例 </div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{@int pages} <i class="conum" data-value="1"></i><b>(1)</b>
{@java.util.List&lt;String&gt; strings} <i class="conum" data-value="2"></i><b>(2)</b>
{@java.util.Map&lt;String,? extends Number&gt; numbers} <i class="conum" data-value="3"></i><b>(3)</b>
{@java.util.Optional&lt;?&gt; param} <i class="conum" data-value="4"></i><b>(4)</b>
{@String name="Quarkus"} <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Java プリミティブタイプ。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>String</code> は <code>java.lang.String</code> に置き換えられます: <code>{@java.util.List&lt;java.lang.String&gt; strings}</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>ワイルドカードは無視され、代わりに上限値が使用されます: <code>{@java.util.Map&lt;String,Number&gt;}</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>ワイルドカードは無視され、代わりに <code>java.lang.Object</code> が使用されます: <code>{@java.util.Optional&lt;java.lang.Object&gt;}</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>タイプは <code>java.lang.String</code> で、キーは <code>name</code>、デフォルト値は <code>Quarkus</code> です。</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="typesafe_templates"><a class="anchor" href="#typesafe_templates"></a>4.5. タイプセーフテンプレート</h3>
<div class="paragraph">
<p>Java コードでタイプセーフなテンプレートを定義できます。
タイプセーフなテンプレートのパラメーターは、<a href="#typesafe_expressions">型安全な式</a> のバインドに使用される <em>パラメーター宣言</em> に自動変換されます。
その後、タイプセーフな式はビルド時に検証されます。</p>
</div>
<div class="paragraph">
<p>タイプセーフなテンプレートは、2 つの方法で定義できます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>クラスにアノテーション <code>@io.quarkus.qute.CheckedTemplate</code> を付けると、そのすべての <code>static native</code> メソッドが、タイプセーフなテンプレートと、それに必要なパラメーターリストを定義するために使用されます。</p>
</li>
<li>
<p><code>io.quarkus.qute.TemplateInstance</code> を実装する Java レコードを使用します。レコードコンポーネントはテンプレートパラメーターを表し、オプションで <code>@io.quarkus.qute.CheckedTemplate</code> を使用してテンプレートを設定できます。</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="nested-type-safe-templates"><a class="anchor" href="#nested-type-safe-templates"></a>4.5.1. ネストされたタイプセーフなテンプレート</h4>
<div class="paragraph">
<p><a href="#rest_integration">templates in Jakarta REST resources</a> を使用する場合、次の規則を適用できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>テンプレートファイルを <code>/src/main/resources/templates</code> ディレクトリーに整理し、リソースクラスごとに 1 つのディレクトリーにグループ化します。つまり、 <code>ItemResource</code> クラスが <code>hello</code> と <code>goodbye</code> の 2 つのテンプレートを参照している場合は、 <code>/src/main/resources/templates/ItemResource/hello.txt</code> と <code>/src/main/resources/templates/ItemResource/goodbye.txt</code> に配置します。リソースクラスごとにテンプレートをグループ化することで、テンプレートへのナビゲートが容易になります。</p>
</li>
<li>
<p>各リソースクラスで、リソースクラス内で <code>@CheckedTemplate static class Template {}</code> クラスを宣言します。</p>
</li>
<li>
<p>リ ソ ース のテ ン プ レー ト フ ァ イ ルごとに <code>public static native TemplateInstance method();</code> を 1 つずつ宣言 し ます。</p>
</li>
<li>
<p>テンプレートインスタンスを構築するには、これらの静的メソッドを使用します。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">ItemResource.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.quarkus.sample;

import jakarta.inject.Inject;
import jakarta.ws.rs.GET;
import jakarta.ws.rs.Path;
import jakarta.ws.rs.Produces;
import jakarta.ws.rs.core.MediaType;

import io.quarkus.qute.TemplateInstance;
import io.quarkus.qute.Template;
import io.quarkus.qute.CheckedTemplate;

@Path("item")
public class ItemResource {

    @CheckedTemplate
    public static class Templates {
        public static native TemplateInstance item(Item item); <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b>
    }

    @GET
    @Path("{id}")
    @Produces(MediaType.TEXT_HTML)
    public TemplateInstance get(Integer id) {
        return Templates.item(service.findItem(id)); <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>templates/ItemResource/item.html</code> に対して <code>TemplateInstance</code> を与えるメソッドを宣言し、その <code>Item item</code> パラメーターを宣言することで、テンプレートを検証することができます。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>item</code> パラメーターは自動的に <a href="#typesafe_expressions">parameter declaration</a> に変換されるので、この名前を参照するすべての式が検証されます。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>テンプレート内で <code>Item</code> オブジェクトにアクセスできるようにします。</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
デフォルトでは、 <code>@CheckedTemplate</code> でアノテーションされたクラスで定義されたテンプレートは、タイプセーフな式、つまり、ビルド時に検証可能な式のみを含むことができます。この要件を緩和するために、 <code>@CheckedTemplate(requireTypeSafeExpressions = false)</code> を使用することができます。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="top-level-type-safe-templates"><a class="anchor" href="#top-level-type-safe-templates"></a>4.5.2. トップレベルタイプセーフテンプレート</h4>
<div class="paragraph">
<p>また、 <code>@CheckedTemplate</code> でアノテーションされたトップレベルの Java クラスを宣言することもできます。</p>
</div>
<div class="listingblock">
<div class="title">トップレベルチェック済テンプレート</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.quarkus.sample;

import io.quarkus.qute.TemplateInstance;
import io.quarkus.qute.Template;
import io.quarkus.qute.CheckedTemplate;

@CheckedTemplate
public class Templates {
    public static native TemplateInstance hello(String name); <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>これは、パス <code>templates/hello.txt</code> を持つテンプレートを宣言します。 <code>name</code> パラメーターは自動的に <a href="#typesafe_expressions">parameter declaration</a> に変換されるため、この名前を参照するすべての式が検証されます。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>そして、テンプレートファイルごとに <code>public static native TemplateInstance method();</code> を宣言します。これらの静的メソッドを使用してテンプレートインスタンスを構築します。</p>
</div>
<div class="listingblock">
<div class="title">HelloResource.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.quarkus.sample;

import jakarta.inject.Inject;
import jakarta.ws.rs.GET;
import jakarta.ws.rs.Path;
import jakarta.ws.rs.QueryParam;
import jakarta.ws.rs.Produces;
import jakarta.ws.rs.core.MediaType;

import io.quarkus.qute.TemplateInstance;

@Path("hello")
public class HelloResource {

    @GET
    @Produces(MediaType.TEXT_PLAIN)
    public TemplateInstance get(@QueryParam("name") String name) {
        return Templates.hello(name);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="template-records"><a class="anchor" href="#template-records"></a>4.5.3. テンプレートレコード</h4>
<div class="paragraph">
<p><code>io.quarkus.qute.TemplateInstance</code> を実装する Java レコードは、タイプセーフなテンプレートを表します。
レコードコンポーネントはテンプレートパラメーターを表し、オプションで <code>@io.quarkus.qute.CheckedTemplate</code> を使用してテンプレートを設定できます。</p>
</div>
<div class="listingblock">
<div class="title">HelloResource.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.quarkus.sample;

import jakarta.inject.Inject;
import jakarta.ws.rs.GET;
import jakarta.ws.rs.Path;
import jakarta.ws.rs.QueryParam;
import jakarta.ws.rs.Produces;
import jakarta.ws.rs.core.MediaType;

import io.quarkus.qute.TemplateInstance;

@Path("hello")
public class HelloResource {

    record Hello(String name) implements TemplateInstance {} <i class="conum" data-value="1"></i><b>(1)</b>

    @GET
    @Produces(MediaType.TEXT_PLAIN)
    public TemplateInstance get(@QueryParam("name") String name) {
        return new Hello(name); <i class="conum" data-value="2"></i><b>(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Java レコードを使用してタイプセーフなテンプレートを宣言します。テンプレートは <code>/src/main/resources/templates/HelloResource/Hello.html</code> にあります。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>レコードをインスタンス化し、通常の <code>TemplateInstance</code> として使用します。</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="customized-template-path"><a class="anchor" href="#customized-template-path"></a>4.5.4. カスタマイズされたテンプレート・パス</h4>
<div class="paragraph">
<p><code>@CheckedTemplate</code> メソッドまたはレコードのタイプセーフなテンプレートパスには、 <em>ベースパス</em> と <em>デフォルトの名前_が使用されます。
 _ベースパス</em> は <code>@CheckedTemplate#basePath()</code> で指定されます。
デフォルトでは，ネストした静的クラスの場合は宣言クラスのsimple name，トップレベルクラスの場合は空文字列が使用されます。
<em>デフォルトの名前</em> は， <code>@CheckedTemplate#defaultName()</code> で指定された戦略によって導出されます。
デフォルトでは、 <code>@CheckedTemplate</code> のメソッドの名前がそのまま使われます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>@CheckedTemplate</code> でアノテーションが付けられていないテンプレートレコードは、デフォルト値で <code>@CheckedTemplate</code> でアノテーションが付けられているものとして扱われます。
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">カスタマイズされたTemplate Pathの例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.quarkus.sample;

import jakarta.ws.rs.Path;

import io.quarkus.qute.TemplateInstance;
import io.quarkus.qute.CheckedTemplate;

@Path("item")
public class ItemResource {

    @CheckedTemplate(basePath = "items", defaultName = CheckedTemplate.HYPHENATED_ELEMENT_NAME)
    static class Templates {
        static native TemplateInstance itemAndOrder(Item item); <i class="conum" data-value="1"></i><b>(1)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>このメソッドのテンプレートパスは、 <code>items/item-and-order</code> になります。</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type_safe_fragments"><a class="anchor" href="#type_safe_fragments"></a>4.5.5. タイプセーフフラグメント</h4>
<div class="paragraph">
<p>You can also define a type-safe <a href="#fragments">fragment</a> of a type-safe template in your Java code.
There are two ways to define a type-safe fragment:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A <em>native static</em> method annotated with <code>@CheckedTemplate</code>, with a name that contains a dollar sign <code>$</code>.</p>
</li>
<li>
<p>A Java record that implements <code>io.quarkus.qute.TemplateInstance</code> and its name contains a dollar sign <code>$</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The name of the fragment is derived from the annotated member name.
The part before the last occurrence of a dollar sign <code>$</code> is the method name of the related type-safe template.
The part after the last occurrence of a dollar sign is the fragment identifier.
The strategy defined by the relevant <code>CheckedTemplate#defaultName()</code> is honored when constructing the defaulted names.</p>
</div>
<div class="listingblock">
<div class="title">タイプセーフフラグメントの例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.quarkus.qute.CheckedTemplate;
import org.acme.Item;

@CheckedTemplate
class Templates {

  // defines a type-safe template
  static native TemplateInstance items(List&lt;Item&gt; items);

  // defines a fragment of Templates#items() with identifier "item"
  static native TemplateInstance items$item(Item item); <i class="conum" data-value="1"></i><b>(1)</b>

  // type-safe fragment as a Java record - functionally equivalent to the items$item() method above
  record items$item(Item item) implements TemplateInstance {}
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Quarkusでは、ビルド時に、 <code>Templates#items()</code> に対応する各テンプレートに、識別子 <code>item</code> を持つフラグメントが含まれているかどうかが検証されます。さらに、フラグメントメソッドのパラメーターも検証されます。一般に、フラグメントに含まれ、オリジナル／アウターテンプレートのデータを参照するすべてのタイプセーフ 式には、特定のパラメータが必要です。</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title"><code>items.html</code> におけるフラグメントの定義</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;h1&gt;Items&lt;/h1&gt;
&lt;ol&gt;
    {#for item in items}
    {#fragment id=item}   <i class="conum" data-value="1"></i><b>(1)</b>
    &lt;li&gt;{item.name}&lt;/li&gt;  <i class="conum" data-value="2"></i><b>(2)</b>
    {/fragment}
    {/for}
&lt;/ol&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>識別子 <code>item</code> を持つフラグメントを定義します</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>{item.name}</code> 式は、 <code>Templates#items$item()</code> メソッドが、名前 <code>item</code> 、型 <code>org.acme.Item</code> のパラメータを宣言しなければならないことを意味します。</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">タイプセーフフラグメントコールサイト例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class ItemService {

  String renderItem(Item item) {
     // this would return something like "&lt;li&gt;Foo&lt;/li&gt;"
     return Templates.items$item(item).render();
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
この機能を無効にするために、 <code>@CheckedTemplate#ignoreFragments=true</code> を指定することができます。つまり、メソッド名にドル記号 <code>$</code> を指定しても、チェックされたフラグメントメソッドになることはありません。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="template_contents"><a class="anchor" href="#template_contents"></a>4.5.6. テンプレートの内容</h4>
<div class="paragraph">
<p>型セーフテンプレートの内容を Java コード内で直接指定することもできます。
<code>@CheckedTemplate</code> でアノテーションが付けられたクラスの <code>static native</code> メソッド、または <code>TemplateInstance</code> を実装する Java レコードには、 <code>@io.quarkus.qute.TemplateContents</code> でアノテーションが付けられる場合があります。
アノテーション値はテンプレートの内容として使用されます。
テンプレート ID/パスは、タイプセーフテンプレートから派生されます。</p>
</div>
<div class="listingblock">
<div class="title">テンプレートコンテンツの例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.quarkus.sample;

import jakarta.inject.Inject;
import jakarta.ws.rs.GET;
import jakarta.ws.rs.Path;
import jakarta.ws.rs.QueryParam;
import jakarta.ws.rs.Produces;
import jakarta.ws.rs.core.MediaType;

import io.quarkus.qute.TemplateContents;
import io.quarkus.qute.TemplateInstance;

@Path("hello")
public class HelloResource {

    @TemplateContents("Hello {name}!") <i class="conum" data-value="1"></i><b>(1)</b>
    record Hello(String name) implements TemplateInstance {}

    @GET
    @Produces(MediaType.TEXT_PLAIN)
    public TemplateInstance get(@QueryParam("name") String name) {
        return new Hello(name);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Hello</code> レコードによって表される型セーフテンプレートの内容を定義します。派生テンプレート ID は <code>HelloResource/Hello</code> です。</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="template_extension_methods"><a class="anchor" href="#template_extension_methods"></a>4.6. テンプレート拡張メソッド</h3>
<div class="paragraph">
<p>拡張メソッドは、データクラスを新しい機能で拡張するため(アクセス可能なプロパティーとメソッドのセットを拡張するため)、または特定の <a href="#namespace_extension_methods">名前空間</a> のための式を解決するために使用することができます。例えば、 <em>計算されたプロパティー</em> や <em>仮想メソッド</em> を追加することができます。</p>
</div>
<div class="paragraph">
<p>値リゾルバは、 <code>@TemplateExtension</code> でアノテーションされたメソッドに対して自動的に生成されます。クラスが <code>@TemplateExtension</code> でアノテーションされている場合、そのクラスで宣言されている <em>プライベートではないスタティック・メソッド</em> ごとに値リゾルバが生成されます。メソッドレベルのアノテーションは、クラスで定義された動作をオーバーライドします。以下の要件を満たさないメソッドは無視されます。</p>
</div>
<div class="paragraph">
<p>テンプレート拡張メソッドは:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>private</code> であってはなりません</p>
</li>
<li>
<p><code>static</code> でなければなりません</p>
</li>
<li>
<p><code>void</code> を返してはいけません</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>名前空間が定義されていない限り、 <code>@TemplateAttribute</code> でアノテーションされた最初のパラメーターのクラスがベース・オブジェクトにマッチするように使用されます。そうでなければ、名前空間が式をマッチするのに使用されます。</p>
</div>
<div class="sect3">
<h4 id="matching-by-name"><a class="anchor" href="#matching-by-name"></a>4.6.1. 名前によるマッチング</h4>
<div class="paragraph">
<p>メソッド名は、デフォルトでプロパティ名と一致するように使用されます。</p>
</div>
<div class="listingblock">
<div class="title">拡張メソッドの例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme;

class Item {

    public final BigDecimal price;

    public Item(BigDecimal price) {
        this.price = price;
    }
}

@TemplateExtension
class MyExtensions {

    static BigDecimal discountedPrice(Item item) { <i class="conum" data-value="1"></i><b>(1)</b>
        return item.getPrice().multiply(new BigDecimal("0.9"));
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>このメソッドは、 <code>Item.class</code> 型のベース・オブジェクトと <code>discountedPrice</code> プロパティー名を持つ式にマッチします。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>このテンプレート拡張メソッドを使うと、以下のテンプレートをレンダリングすることができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{item.discountedPrice} <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>item</code> は <code>org.acme.Item</code> のインスタンスに解決されます。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>ただし、 <code>matchName()</code> でマッチング名を指定することは可能です。</p>
</div>
<div class="listingblock">
<div class="title"><code>TemplateInstance.createUni()</code> の例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@TemplateExtension(matchName = "discounted")
static BigDecimal discountedPrice(Item item) {
   // this method matches {item.discounted} if "item" resolves to an object assignable to "Item"
   return item.getPrice().multiply(new BigDecimal("0.9"));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>特別な定数 - <code>TemplateExtension#ANY</code> - を使用すると、エクステンションメソッドが任意の名前にマッチするように指定することができます。</p>
</div>
<div class="listingblock">
<div class="title"><code>TemplateExtension#ANY</code> の例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@TemplateExtension(matchName = TemplateExtension.ANY)
static String itemProperty(Item item, String name) { <i class="conum" data-value="1"></i><b>(1)</b>
   // this method matches {item.foo} if "item" resolves to an object assignable to "Item"
   // the value of the "name" argument is "foo"
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>追加の文字列メソッドパラメータは、実際のプロパティー名を渡すために使用されます。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>また、 <code>matchRegex()</code> で指定された正規表現と名前を照合することも可能です。</p>
</div>
<div class="listingblock">
<div class="title"><code>TemplateInstance.createUni()</code> の例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@TemplateExtension(matchRegex = "foo|bar")
static String itemProperty(Item item, String name) { <i class="conum" data-value="1"></i><b>(1)</b>
   // this method matches {item.foo} and {item.bar} if "item" resolves to an object assignable to "Item"
   // the value of the "name" argument is "foo" or "bar"
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>追加の文字列メソッドパラメータは、実際のプロパティー名を渡すために使用されます。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>最後に、 <code>matchNames()</code> を使用して、一致する名前のコレクションを指定することができます。追加の文字列メソッド・パラメータも必須です。</p>
</div>
<div class="listingblock">
<div class="title"><code>TemplateInstance.createUni()</code> の例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@TemplateExtension(matchNames = {"foo", "bar"})
static String itemProperty(Item item, String name) {
   // this method matches {item.foo} and {item.bar} if "item" resolves to an object assignable to "Item"
   // the value of the "name" argument is "foo" or "bar"
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
余分な一致条件は無視されます。優先順位の高い順に並べると、以下のようになります。 <code>matchRegex()</code> , <code>matchNames()</code> および <code>matchName()</code> 。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="method-parameters"><a class="anchor" href="#method-parameters"></a>4.6.2. メソッドパラメーター</h4>
<div class="paragraph">
<p>An extension method may declare parameters.
If no namespace is specified then the first parameter that is not annotated with <code>@TemplateAttribute</code> is used to pass the base object, i.e. <code>org.acme.Item</code> in the first example.
If matching any name or using a regular expression, then a string method parameter (not not annotated with <code>@TemplateAttribute</code>) needs to be used to pass the property name.
Parameters annotated with <code>@TemplateAttribute</code> are obtained via <code>TemplateInstance#getAttribute()</code>.
All other parameters are treated as virtual method parameters and resolved when rendering the template and passed to the extension method.</p>
</div>
<div class="listingblock">
<div class="title">複数のパラメーターの例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@TemplateExtension
class BigDecimalExtensions {

    @TemplateExtension(matchNames = {"scale", "setScale"})
    static BigDecimal scale(BigDecimal val, String ignoredName, int scale, RoundingMode mode) { <i class="conum" data-value="1"></i><b>(1)</b>
        return val.setScale(scale, mode);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This method matches an expression with base object of the type <code>BigDecimal.class</code>, with the <code>scale()</code>/<code>setScale()</code> virtual method name and two virtual method parameters - <code>scale</code> and <code>mode</code>.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{item.discountedPrice.scale(2,mode)} <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>item.discountedPrice</code> は <code>BigDecimal</code> のインスタンスに解決されます。</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="namespace_extension_methods"><a class="anchor" href="#namespace_extension_methods"></a>4.6.3. 名前空間拡張メソッド</h4>
<div class="paragraph">
<p><code>TemplateExtension#namespace()</code> が指定された場合、拡張メソッドが、指定された <a href="#expressions">namespace</a> を持つ式を解決するために使用されます。同じ名前空間を共有するテンプレート拡張メソッドは、 <code>TemplateExtension#priority()</code> で順に 1 つのリゾルバにグループ化されます。最初にマッチする拡張メソッドが式の解決に使用されます。</p>
</div>
<div class="listingblock">
<div class="title">名前空間拡張メソッド例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@TemplateExtension(namespace = "str")
public class StringExtensions {

   static String format(String fmt, Object... args) {
      return String.format(fmt, args);
   }

   static String reverse(String val) {
      return new StringBuilder(val).reverse().toString();
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>これらの拡張メソッドは、以下のように使用することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{str:format('%s %s!','Hello', 'world')} <i class="conum" data-value="1"></i><b>(1)</b>
{str:reverse('hello')} <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>出力は <code>Hello world!</code> です</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>出力は <code>olleh</code> です</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="built-in-template-extension"><a class="anchor" href="#built-in-template-extension"></a>4.6.4. 組み込みテンプレートエクステンション</h4>
<div class="paragraph">
<p>Quarkusは、組み込みの拡張メソッドのセットを提供しています。</p>
</div>
<div class="sect4">
<h5 id="maps"><a class="anchor" href="#maps"></a>4.6.4.1. マップ</h5>
<div class="ulist">
<ul>
<li>
<p><code>keys</code> または <code>keySet</code> : マップに含まれるキーのセットビューを返します。</p>
<div class="ulist">
<ul>
<li>
<p><code>{#for key in map.keySet}</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>values</code> : マップに含まれる値のコレクションビューを返します。</p>
<div class="ulist">
<ul>
<li>
<p><code>{#for value in map.values}</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>size</code> : マップ内のキーと値の対応付けの個数を返します。</p>
<div class="ulist">
<ul>
<li>
<p><code>{map.size}</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>isEmpty</code> : マップにキーと値のマッピングが含まれていない場合に true を返します。</p>
<div class="ulist">
<ul>
<li>
<p><code>{#if map.isEmpty}</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>get(key)</code> : 指定したキーがマッピングされた値を返します。</p>
<div class="ulist">
<ul>
<li>
<p><code>{map.get('foo')}</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
マップ値は、直接アクセスすることもできます : <code>{map.myKey}</code> 。正規の識別子ではないキーには大括弧表記を使用します: <code>{map['my key']}</code> 。
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="lists"><a class="anchor" href="#lists"></a>4.6.4.2. リスト</h5>
<div class="ulist">
<ul>
<li>
<p><code>get(index)</code> : リストの指定した位置の要素を返す</p>
<div class="ulist">
<ul>
<li>
<p><code>{list.get(0)}</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>reversed</code>: リストを逆にしたイテレータを返す</p>
<div class="ulist">
<ul>
<li>
<p><code>{#for r in recordsList.reversed}</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>take</code>: 与えられたリストから最初の <code>n</code> 要素を返します。 <code>n</code> が範囲外の場合は <code>IndexOutOfBoundsException</code> を投げます。</p>
<div class="ulist">
<ul>
<li>
<p><code>{#for r in recordsList.take(3)}</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>takeLast</code>: 与えられたリストから最後の <code>n</code> 要素を返します。 <code>n</code> が範囲外の場合は <code>IndexOutOfBoundsException</code> を投げます。</p>
<div class="ulist">
<ul>
<li>
<p><code>{#for r in recordsList.takeLast(3)}</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>first</code>: 指定されたリストの最初の要素を返します。リストが空の場合、 <code>NoSuchElementException</code> をスローします。</p>
<div class="ulist">
<ul>
<li>
<p><code>{recordsList.first}</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>last</code>: 指定されたリストの最後の要素を返します。リストが空の場合、 <code>NoSuchElementException</code> をスローします。</p>
<div class="ulist">
<ul>
<li>
<p><code>{recordsList.last}</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
リストの要素にはインデックス (<code>{list.10}</code> または <code>{list[10]}</code>) を介して直接アクセスすることができます。
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="integer-numbers"><a class="anchor" href="#integer-numbers"></a>4.6.4.3. 整数値</h5>
<div class="ulist">
<ul>
<li>
<p><code>mod</code> : モデューロ演算</p>
<div class="ulist">
<ul>
<li>
<p><code>{#if counter.mod(5) == 0}</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>plus</code> または <code>+</code>: 加算</p>
<div class="ulist">
<ul>
<li>
<p><code>{counter + 1}</code></p>
</li>
<li>
<p><code>{age plus 10}</code></p>
</li>
<li>
<p><code>{age.plus(10)}</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>minus</code> または <code>-</code>: 引き算</p>
<div class="ulist">
<ul>
<li>
<p><code>{counter - 1}</code></p>
</li>
<li>
<p><code>{age minus 10}</code></p>
</li>
<li>
<p><code>{age.minus(10)}</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="strings"><a class="anchor" href="#strings"></a>4.6.4.4. Strings</h5>
<div class="ulist">
<ul>
<li>
<p><code>fmt</code> または <code>format</code>: <code>java.lang.String.format()</code> によって文字列のインスタンスをフォーマットします。</p>
<div class="ulist">
<ul>
<li>
<p><code>{myStr.fmt("arg1","arg2")}</code></p>
</li>
<li>
<p><code>{myStr.format(locale,arg1)}</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>+</code>: 連結のための中置記法。<code>String</code> および <code>StringBuilder</code> 基本オブジェクトで動作します。</p>
<div class="ulist">
<ul>
<li>
<p><code>{item.name + '_' + mySuffix}</code></p>
</li>
<li>
<p><code>{name + 10}</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>str:['&lt;value&gt;']</code>: 文字列値を返します。たとえば、別の文字列値を簡単に連結できます。</p>
<div class="ulist">
<ul>
<li>
<p><code>{str:['/path/to/'] + fileName}</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>str:fmt</code> または <code>str:format</code>: 与えられた文字列値を <code>java.lang.String.format()</code> でフォーマットします。</p>
<div class="ulist">
<ul>
<li>
<p><code>{str:format("Hello %s!",name)}</code></p>
</li>
<li>
<p><code>{str:fmt(locale,'%tA',now)}</code></p>
</li>
<li>
<p><code>{str:fmt('/path/to/%s', fileName)}</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>str:concat</code>: 指定された引数の文字列表現を連結します。</p>
<div class="ulist">
<ul>
<li>
<p><code>{str:concat("Hello ",name,"!")}</code> <code>name</code> が <code>Foo</code> に解決された場合、<code>Hello Foo!</code> が返されます。</p>
</li>
<li>
<p><code>{str:concat('/path/to/', fileName)}</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>str:join</code>: 指定された引数の文字列表現を区切り文字で結合します。</p>
<div class="ulist">
<ul>
<li>
<p><code>{str:join('_','Qute','is','cool')}</code> は <code>Qute_is_cool</code> を生成します</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>str:builder</code>: 新しい文字列ビルダーを返します。</p>
<div class="ulist">
<ul>
<li>
<p><code>{str:builder('Qute').append("is").append("cool!")}</code> は <code>Qute is cool!</code> を生成します。</p>
</li>
<li>
<p><code>{str:builder('Qute') + "is" + whatisqute + "!"}</code> <code>whatisqute</code> が <code>cool</code> に解決される場合、<code>Qute is cool!</code> が生成されます。</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>str:eval</code>:<a href="#current_context_object">current context</a> で最初の引数の文字列表現をテンプレートとして評価します。</p>
<div class="ulist">
<ul>
<li>
<p><code>{str:eval('Hello {name}!')</code> は、<code>name</code> が <code>lovely</code> に解決された場合、<code>Hello lovely!</code> を返します。</p>
</li>
<li>
<p><code>{str:eval(myTemplate)}</code> <code>myTemplate</code> が <code>Hello lovely!</code> に解決された場合、<code>Hello{name}!</code> と <code>name</code> は <code>lovely</code> に対して解決されます。</p>
</li>
<li>
<p><code>{str:eval('/path/to/{fileName}')}</code> は、<code>fileName</code> が <code>file.txt</code> に解決される場合、<code>/path/to/file.txt</code> を生成します。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="config"><a class="anchor" href="#config"></a>4.6.4.5. 設定</h5>
<div class="ulist">
<ul>
<li>
<p><code>config:&lt;name&gt;</code> 又は <code>config:[&lt;name&gt;]</code> : 指定したプロパティー名の設定値を返します。</p>
<div class="ulist">
<ul>
<li>
<p><code>{config:foo}</code> または <code>{config:['property.with.dot.in.name']}</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>config:property(name)</code> : 指定したプロパティー名の設定値を返します。名前は式で動的に取得することが可能です。</p>
<div class="ulist">
<ul>
<li>
<p><code>{config:property('quarkus.foo')}</code></p>
</li>
<li>
<p><code>{config:property(foo.getPropertyName())}</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>config:boolean(name)</code>: 指定したプロパティー名の設定値をbooleanとして返します。名前は式で動的に取得することが可能です。</p>
<div class="ulist">
<ul>
<li>
<p><code>{config:boolean('quarkus.foo.boolean') ?: 'Not Found'}</code></p>
</li>
<li>
<p><code>{config:boolean(foo.getPropertyName()) ?: 'property is false'}</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>config:integer(name)</code>: 指定したプロパティー名の設定値をintegerで返します。名前は式で動的に取得することが可能です。</p>
<div class="ulist">
<ul>
<li>
<p><code>{config:integer('quarkus.foo')}</code></p>
</li>
<li>
<p><code>{config:integer(foo.getPropertyName())}</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="time"><a class="anchor" href="#time"></a>4.6.4.6. 時間</h5>
<div class="ulist">
<ul>
<li>
<p><code>format(pattern)</code> : <code>java.time</code> パッケージの一時オブジェクトをフォーマットします。</p>
<div class="ulist">
<ul>
<li>
<p><code>{dateTime.format('d MMM uuuu')}</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>format(pattern,locale)</code> : <code>java.time</code> パッケージの一時オブジェクトをフォーマットします。</p>
<div class="ulist">
<ul>
<li>
<p><code>{dateTime.format('d MMM uuuu',myLocale)}</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>format(pattern,locale,timeZone)</code> : <code>java.time</code> パッケージの一時オブジェクトをフォーマットします。</p>
<div class="ulist">
<ul>
<li>
<p><code>{dateTime.format('d MMM uuuu',myLocale,myTimeZoneId)}</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>time:format(dateTime,pattern)</code> : <code>java.time</code> パッケージ、 <code>java.util.Date</code> 、 <code>java.util.Calendar</code> 、 <code>java.lang.Number</code> の一時オブジェクトをフォーマットします。</p>
<div class="ulist">
<ul>
<li>
<p><code>{time:format(myDate,'d MMM uuuu')}</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>time:format(dateTime,pattern,locale)</code> : <code>java.time</code> パッケージ、 <code>java.util.Date</code> 、 <code>java.util.Calendar</code> 、 <code>java.lang.Number</code> の一時オブジェクトをフォーマットします。</p>
<div class="ulist">
<ul>
<li>
<p><code>{time:format(myDate,'d MMM uuuu', myLocale)}</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>time:format(dateTime,pattern,locale,timeZone)</code> : <code>java.time</code> パッケージ、 <code>java.util.Date</code> 、 <code>java.util.Calendar</code> 、 <code>java.lang.Number</code> の一時オブジェクトをフォーマットします。</p>
<div class="ulist">
<ul>
<li>
<p><code>{time:format(myDate,'d MMM uuuu',myLocale,myTimeZoneId)}</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="template_data"><a class="anchor" href="#template_data"></a>4.7. @TemplateData</h3>
<div class="paragraph">
<p>値リゾルバは、 <code>@TemplateData</code> でアノテーションされた型に対して自動的に生成されます。これにより、Quarkusでは、実行時にデータにアクセスするためのリフレクションの使用を避けることができます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
非publicのメンバー、コンストラクタ、静的イニシャライザ、静的メソッド、合成メソッド、ボイドメソッドは常に無視されます。
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme;

@TemplateData
class Item {

    public final BigDecimal price;

    public Item(BigDecimal price) {
        this.price = price;
    }

    public BigDecimal getDiscountedPrice() {
        return price.multiply(new BigDecimal("0.9"));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Item</code> の任意のインスタンスをテンプレート内で直接使用することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{#each items} <i class="conum" data-value="1"></i><b>(1)</b>
  {it.price} / {it.discountedPrice}
{/each}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>items</code> は <code>org.acme.Item</code> インスタンスのリストに解決されます。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>さらに、 <code>@TemplateData.properties()</code> と <code>@TemplateData.ignore()</code> を使用して、生成されるリゾルバを微調整することができます。最後に、アノテーションの「ターゲット」を指定することも可能です。これは、アプリケーションによって管理されないサードパーティーのクラスに便利です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@TemplateData(target = BigDecimal.class)
@TemplateData
class Item {

    public final BigDecimal price;

    public Item(BigDecimal price) {
        this.price = price;
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{#each items}
  {it.price.setScale(2, rounding)} <i class="conum" data-value="1"></i><b>(1)</b>
{/each}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>生成された値リゾルバは、 <code>BigDecimal.setScale()</code> メソッドを呼び出す方法を知っています。</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="accessing-static-fields-and-methods"><a class="anchor" href="#accessing-static-fields-and-methods"></a>4.7.1. 静的なフィールドとメソッドへのアクセス</h4>
<div class="paragraph">
<p>もし <code>@TemplateData#namespace()</code> が空でない値に設定されている場合、ターゲットクラスのパブリック静的フィールドとメソッドにアクセスするための名前空間リゾルバーが自動的に生成されます。デフォルトでは、名前空間はターゲットクラスの FQCN で、ドットやドル記号はアンダースコアに置き換えられます。たとえば、名前 <code>org.acme.Foo</code> を持つクラスの名前空間は <code>org_acme_Foo</code> となります。静的フィールド <code>Foo.AGE</code> には、 <code>{org_acme_Foo:AGE}</code> からアクセスすることができます。静的メソッド <code>Foo.computeValue(int number)</code> には、 <code>{org_acme_Foo:computeValue(10)}</code> を介してアクセスすることができます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
名前空間は、英数字とアンダースコアだけで構成されます。
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title"><code>@TemplateData</code> でアノテーションされたクラス</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package model;

@TemplateData <i class="conum" data-value="1"></i><b>(1)</b>
public class Statuses {
    public static final String ON = "on";
    public static final String OFF = "off";
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>名前空間が <code>model_Statuses</code> のネームリゾルバーが自動的に生成されます。</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">クラス定数にアクセスするテンプレート</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{#if machine.status == model_Statuses:ON}
  The machine is ON!
{/if}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="convenient-annotation-for-enums"><a class="anchor" href="#convenient-annotation-for-enums"></a>4.7.2. enum の便利なアノテーション</h4>
<div class="paragraph">
<p>また、enum 定数にアクセスするための便利なアノテーションとして、 <code>@io.quarkus.qute.TemplateEnum</code> があります。このアノテーションは、機能的には <code>@TemplateData(namespace = TemplateData.SIMPLENAME)</code> と同等です。つまり、対象の enum に対して自動的に名前空間リゾルバーが生成され、対象の enum の単純名が名前空間として使用されます。</p>
</div>
<div class="listingblock">
<div class="title"><code>@TemplateEnum</code> でアノテーションされた enum</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package model;

@TemplateEnum <i class="conum" data-value="1"></i><b>(1)</b>
public enum Status {
    ON,
    OFF
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>名前空間 <code>Status</code> を持つネームリゾルバーが自動的に生成される。</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
enum 以外のクラスで宣言された <code>@TemplateEnum</code> は無視されます。また、enum が <code>@TemplateData</code> アノテーションを宣言する場合は、 <code>@TemplateEnum</code> アノテーションは無視されます。
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">enum 定数にアクセスするテンプレート</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{#if machine.status == Status:ON}
  The machine is ON!
{/if}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Quarkus は、名前空間の競合の可能性を検出し、特定の名前空間が複数の <code>@TemplateData</code> や <code>@TemplateEnum</code> アノテーションによって定義されている場合、ビルドを失敗させます。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="global_variables"><a class="anchor" href="#global_variables"></a>4.8. グローバル変数</h3>
<div class="paragraph">
<p>アノテーション <code>io.quarkus.qute.TemplateGlobal</code> は、任意のテンプレートからアクセス可能な <em>グローバル変数</em> を提供する静的フィールドとメソッドを示すために使用できます。</p>
</div>
<div class="paragraph">
<p>グローバル変数は次のとおりです。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>初期化中に、任意の <code>TemplateInstance</code> の <em>計算データ</em> として追加されます。</p>
</li>
<li>
<p><code>global:</code> 名前空間でアクセス可能です。</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>TemplateInstance#computedData(String, Function&lt;String, Object&gt;)</code> を使用している場合、 マッピング関数は特定のキーに関連付けられ、指定されたキーの値が要求されるたびに、この関数が使用されます。グローバル変数の場合は、静的メソッドが呼び出されるか、マッピング関数で静的フィールドが読み取られます。
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">グローバル変数の定義</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">enum Color { RED, GREEN, BLUE }

@TemplateGlobal <i class="conum" data-value="1"></i><b>(1)</b>
public class Globals {

    static int age = 40;

    static Color[] myColors() {
      return new Color[] { Color.RED, Color.BLUE };
    }

    @TemplateGlobal(name = "currentUser") <i class="conum" data-value="2"></i><b>(2)</b>
    static String user() {
       return "Mia";
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>クラスが <code>@TemplateGlobal</code> でアノテーションが付けられている場合、パラメーターを宣言しないすべての非 void 非プライベート静的メソッドとすべての非プライベート静的フィールドは、グローバル変数と見なされます。名前はデフォルトです。つまり、フィールド/メソッドの名前が使用されます。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>メソッドレベルのアノテーションは、クラスレベルのアノテーションをオーバーライドします。この特別なケースでは、名前はデフォルトではなく、明示的に選択されます。</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">グローバル変数にアクセスするテンプレート</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">User: {currentUser} <i class="conum" data-value="1"></i><b>(1)</b>
Age:  {global:age} <i class="conum" data-value="2"></i><b>(2)</b>
Colors: {#each myColors}{it}{#if it_hasNext}, {/if}{/each} <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>currentUser</code> resolves to <code>Globals#user()</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>global:</code> 名前空間が使用され、 <code>age</code> は <code>Globals#age</code> に解決されます。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>myColors</code> resolves to <code>Globals#myColors()</code>.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
グローバル変数は暗黙のうちにすべてのテンプレートに <a href="#typesafe_expressions">parameter declarations</a> を追加するため、グローバル変数を参照する式はビルド時に検証されることに注意してください。
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">出力</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">User: Mia
Age:  40
Colors: RED, BLUE</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="resolving-conflicts"><a class="anchor" href="#resolving-conflicts"></a>4.8.1. 競合の解消</h4>
<div class="paragraph">
<p><code>global:</code> 名前空間経由でアクセスしない場合、グローバル変数は通常のデータオブジェクトと競合する可能性があります。
<a href="#typesafe_templates">Type-safe templates</a> は自動的にグローバル変数をオーバーライドします。
たとえば次の定義は、 <code>Globals#user()</code> メソッドが提供するグローバル変数をオーバーライドします。</p>
</div>
<div class="listingblock">
<div class="title">タイプセーフテンプレート定義</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.acme.User;

@CheckedTemplate
public class Templates {
    static native TemplateInstance hello(User currentUser); <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>currentUser</code> は <code>Globals#user()</code> が提供するグローバル変数と競合しています。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>そのため、 <code>Globals#user()</code> メソッドが <code>java.lang.String</code> を返し、それが <code>name</code> プロパティーを持たないにもかかわらず、対応するテンプレートはバリデーションエラーにはなりません。</p>
</div>
<div class="listingblock">
<div class="title"><code>templates/hello.txt</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">User name: {currentUser.name} <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>org.acme.User</code> には <code>name</code> プロパティーがあります。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>その他のテンプレートでは、明示的なパラメーター宣言が必要です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{@org.acme.User currentUser} <i class="conum" data-value="1"></i><b>(1)</b>

User name: {currentUser.name}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>このパラメーター宣言は、 <code>Globals#user()</code> メソッドが提供するグローバル変数によって追加される宣言を上書きします。</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="native_executables"><a class="anchor" href="#native_executables"></a>4.9. ネイティブ実行可能ファイル</h3>
<div class="paragraph">
<p>JVM モードでは、リフレクションベースの値リゾルバーが、プロパティーにアクセスし、モデルクラスのメソッドを呼び出すために使われる場合があります。しかし、これは <a href="building-native-image">ネイティブ実行可能ファイル</a> に対しては、そのままではうまくいきません。その結果、たとえ <code>Foo</code> クラスが関連するゲッターメソッドを宣言していたとしても、 <code>Property "name" not found on the base object "org.acme.Foo" in expression {foo.name} in template hello.html</code> といったテンプレート例外に遭遇するかも知れません。</p>
</div>
<div class="paragraph">
<p>この問題を解決するには、いくつかの方法があります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#typesafe_templates">タイプセーフテンプレート</a> または <a href="#typesafe_expressions">タイプセーフな式</a> をご利用ください。</p>
<div class="ulist">
<ul>
<li>
<p>この場合、最適化されたバリューリゾルバーが自動的に生成され、実行時に使用されます。</p>
</li>
<li>
<p>これが望ましい解決策です</p>
</li>
</ul>
</div>
</li>
<li>
<p>モデルクラスに <a href="#template_data"><code>@TemplateData</code></a> のアノテーションを付ける - 実行時に専用の値リゾルバーが生成され、使用されます。</p>
</li>
<li>
<p>リフレクションベースの値リゾルバーが機能するためには、モデルクラスにアノテーション <code>@io.quarkus.runtime.annotations.RegisterForReflection</code> が必要です。 <code>@RegisterForReflection</code> アノテーションの詳細は、<a href="writing-native-applications-tips#registerForReflection">ネイティブアプリケーションのヒント</a> ページを参照してください。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="rest_integration"><a class="anchor" href="#rest_integration"></a>4.10. <a id="resteasy_integration"></a> REST インテグレーション</h3>
<div class="paragraph">
<p>Jakarta REST アプリケーションで Qute を使用する場合は、使用している Jakarta REST スタックに応じて適切なエクステンションを最初に登録する必要があります。</p>
</div>
<div class="paragraph">
<p><code>quarkus-rest</code> エクステンションを介して Quarkus REST (旧 RESTEasy Reactive) を使用している場合は、 <code>pom.xml</code> ファイルに以下を追加します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-rest-qute&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>従来の RESTEasy Classic ベースの <code>quarkus-resteasy</code> エクステンションを使用している場合は、 <code>pom.xml</code> ファイルに以下を追加します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-resteasy-qute&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>これら両方のエクステンションは、リソースメソッドが <code>TemplateInstance</code> を返せるようにする特別な応答フィルターを登録します。そのため、ユーザーによる内部ステップの処理が不要になります。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Quarkus REST を使用する場合、 <code>TemplateInstance</code> を返すリソースメソッドはブロッキングではないと見なされます。メソッドをブロッキングとしてマークするには、メソッドにアノテーション <code>io.smallrye.common.annotation.Blocking</code> を付ける必要があります。たとえば、 <code>@RunOnVirtualThread</code> のアノテーションも付けられている場合などです。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>最終的には、Jakarta REST リソース内で Qute を使用すると、次のようにシンプルになります。</p>
</div>
<div class="listingblock">
<div class="title">HelloResource.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.quarkus.sample;

import jakarta.inject.Inject;
import jakarta.ws.rs.GET;
import jakarta.ws.rs.Path;
import jakarta.ws.rs.QueryParam;
import jakarta.ws.rs.Produces;
import jakarta.ws.rs.core.MediaType;

import io.quarkus.qute.TemplateInstance;
import io.quarkus.qute.Template;

@Path("hello")
public class HelloResource {

    @Inject
    Template hello; <i class="conum" data-value="1"></i><b>(1)</b>

    @GET
    @Produces(MediaType.TEXT_PLAIN)
    public TemplateInstance get(@QueryParam("name") String name) {
        return hello.data("name", name); <i class="conum" data-value="2"></i><b>(2)</b> <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@Location</code> の修飾子が指定されていない場合は、フィールド名がテンプレートの場所を特定するために使用されます。この特定のケースでは、パスが <code>templates/hello.txt</code> であるテンプレートを注入しています。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>Template.data()</code> は、実際のレンダリングがトリガーされる前にカスタマイズできる新しいテンプレートインスタンスを返します。この場合、名前の値をキー <code>name</code> の下に置きます。データマップはレンダリング中にアクセス可能です。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>レンダリングをトリガーしないことに注意してください - これは特別な <code>ContainerResponseFilter</code> の実装によって自動的に行われます。</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
ユーザーは、特定の Jakarta REST リソースのテンプレートを整理し、自動的に <a href="#typesafe_expressions">type-safe expressions</a> を有効化できる <a href="#typesafe_templates">Type-safe templates</a> を使用することが推奨されます。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>コンテンツネゴシエーションは自動的に実行されます。結果の出力はクライアントから受け取った <code>Accept</code> ヘッダーに依存します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Path("/detail")
class DetailResource {

    @Inject
    Template item; <i class="conum" data-value="1"></i><b>(1)</b>

    @GET
    @Produces({ MediaType.TEXT_HTML, MediaType.TEXT_PLAIN })
    public TemplateInstance item() {
        return item.data("myItem", new Item("Alpha", 1000)); <i class="conum" data-value="2"></i><b>(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>注入されたフィールドから派生したベースパスを持つバリアントテンプレートを注入します - <code>src/main/resources/templates/item</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>text/plain</code> では <code>src/main/resources/templates/item.txt</code> のテンプレートが使用されます。 <code>text/html</code> では <code>META-INF/resources/templates/item.html</code> のテンプレートが使用されます。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>RestTemplate</code> util クラスを使用すると、Jakarta REST リソースメソッドのボディからテンプレートインスタンスを取得することができます:</p>
</div>
<div class="listingblock">
<div class="title">RestTemplate の例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Path("/detail")
class DetailResource {

    @GET
    @Produces({ MediaType.TEXT_HTML, MediaType.TEXT_PLAIN })
    public TemplateInstance item() {
        return RestTemplate.data("myItem", new Item("Alpha", 1000)); <i class="conum" data-value="1"></i><b>(1)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>テンプレートの名前は、リソースクラスとメソッド名から派生しています。このケースでは、 <code>DetailResource/item</code> です。</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<code>@Inject</code> とは異なり、 <code>RestTemplate</code> 経由で取得したテンプレートは検証されません。即ち、テンプレートが存在しなくてもビルドは失敗しません。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="vertx_integration"><a class="anchor" href="#vertx_integration"></a>4.11. Vert.x インテグレーション</h3>
<div class="paragraph">
<p>テンプレートで <code>io.vertx.core.json.JsonObject</code> をデータとして使用する場合、依存関係にまだ含まれていなければ、ビルドファイルに <code>quarkus-vertx</code> エクステンションを追加する必要があります (ほとんどのアプリケーションでは、このエクステンションがデフォルトで使用されます)。</p>
</div>
<div class="listingblock primary maven-dependency">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-vertx&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary gradle-dependency">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">implementation("io.quarkus:quarkus-vertx")</code></pre>
</div>
</div>
<div class="paragraph">
<p>この依存関係を含めると、 <code>io.vertx.core.json.JsonObject</code> の特別な値リゾルバーが作成され、テンプレート内の JSON オブジェクトのプロパティーにアクセスできるようになります。</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/templates/foo.txt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">{tool.name}
{tool.fieldNames}
{tool.fields}
{tool.size}
{tool.empty}
{tool.isEmpty}
{tool.get('name')}
{tool.containsKey('name')}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">QuteVertxIntegration.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.util.HashMap;
import jakarta.inject.Inject;
import io.vertx.core.json.JsonObject;
import io.quarkus.qute.Template;

public class QuteVertxIntegration {

    @Inject
    Template foo;

    public String render() {
         HashMap&lt;String, Object&gt; toolMap = new Map&lt;String, Object&gt;();
         toolMap.put("name", "Roq");
         JsonObject jsonObject = new JsonObject(toolMap);
         return foo.data("tool", jsonObject).render();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>QuteVertxIntegration#render()</code> の出力は次のようになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">Roq
[name]
[name]
1
false
false
Roq
true</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="development-mode"><a class="anchor" href="#development-mode"></a>4.12. 開発モード</h3>
<div class="paragraph">
<p>開発モードでは、 <code>src/main/resources/templates</code> にあるすべてのファイルの変更が監視されます。
デフォルトでは、テンプレートを変更するとアプリケーションが再起動され、ビルド時の検証もトリガーされます。</p>
</div>
<div class="paragraph">
<p>ただし、 <code>quarkus.qute.dev-mode.no-restart-templates</code> 設定プロパティーを使用して、アプリケーションを再起動しないテンプレートを指定することは可能です。
設定値は、 <code>templates</code> ディレクトリーからの相対テンプレートパスに一致する正規表現であり、パス区切り文字として <code>/</code> が使用されます。
たとえば、 <code>quarkus.qute.dev-mode.no-restart-templates=templates/foo.html</code> はテンプレート <code>src/main/resources/templates/foo.html</code> と一致します。
一致するテンプレートがリロードされ、実行時の検証のみが実行されます。</p>
</div>
</div>
<div class="sect2">
<h3 id="testing"><a class="anchor" href="#testing"></a>4.13. テスト</h3>
<div class="paragraph">
<p>テストモードの場合、注入されたタイプセーフテンプレートのレンダリング結果は、CDI Bean として登録されている管理対象の <code>io.quarkus.qute.RenderedResults</code> に記録されます。
テストまたは他の CDI Bean に <code>RenderedResults</code> を注入し、結果をアサートできます。
この機能は、 <code>quarkus.qute.test-mode.record-rendered-results</code> 設定プロパティーを <code>false</code> に設定することで無効にできます。</p>
</div>
</div>
<div class="sect2">
<h3 id="type-safe-message-bundles"><a class="anchor" href="#type-safe-message-bundles"></a>4.14. タイプセーフメッセージバンドル</h3>
<div class="sect3">
<h4 id="basic-concepts"><a class="anchor" href="#basic-concepts"></a>4.14.1. 基本概念</h4>
<div class="paragraph">
<p>基本的な考え方として、すべてのメッセージを非常に単純なテンプレートである可能性があるとみなします。
タイプエラーを防ぐために、メッセージは <strong>メッセージバンドルインターフェイス</strong> のアノテーション付きメソッドとして定義されます。
Quarkus はビルド時に <strong>メッセージバンドル実装</strong> を生成します。</p>
</div>
<div class="listingblock">
<div class="title">メッセージバンドルインターフェイスの例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.quarkus.qute.i18n.Message;
import io.quarkus.qute.i18n.MessageBundle;

@MessageBundle <i class="conum" data-value="1"></i><b>(1)</b>
public interface AppMessages {

    @Message("Hello {name}!") <i class="conum" data-value="2"></i><b>(2)</b>
    String hello_name(String name); <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>メッセージバンドルインターフェイスを表します。 バンドル名のデフォルトは <code>msg</code> で、テンプレート式の名前空間として使用されます。例: <code>{msg:hello_name}</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>各メソッドには <code>@Message</code> のアノテーションが必要です。その値は qute テンプレートです。値が指定されていない場合、ローカライズされたファイルから対応する値が取得されます。該当するファイルがない場合は例外がスローされ、ビルドは失敗します。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>メソッドのパラメーターはテンプレートで使用することができます。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>メッセージバンドルは、実行時に使用することができます:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>io.quarkus.qute.i18n.MessageBundles#get()</code> を経由し、直接コードの中で使用。例: <code>MessageBundles.get(AppMessages.class).hello_name("Lucie")</code></p>
</li>
<li>
<p><code>@Inject</code> であなたのBeanに注入。 例: <code>@Inject AppMessages</code></p>
</li>
<li>
<p>メッセージ・バンドル名前空間を介してテンプレート内で参照。</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html"> {msg:hello_name('Lucie')} <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b> <i class="conum" data-value="3"></i><b>(3)</b>
 {msg:message(myKey,'Lu')} <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>msg</code> がデフォルトの名前空間です。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>hello_name</code> がメッセージキーです。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>Lucie</code> はメッセージバンドルインターフェースメソッドのパラメーターです。</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>また、予約されたキー <code>message</code> を使用して、実行時に解決されたキーのローカライズされたメッセージを取得することも可能である。この場合、検証はスキップされます。</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="default-bundle-name"><a class="anchor" href="#default-bundle-name"></a>4.14.2. デフォルトのバンドル名</h4>
<div class="paragraph">
<p><code>@MessageBundle#value()</code> で指定されていない限り、バンドル名がデフォルトになります。
最上位クラスの場合、デフォルトで <code>msg</code> 値が使用されます。
ネストされたクラスの場合、名前は階層内に含まれるすべてのクラスの単純名 (最上位クラスが最初) で設定され、その後にメッセージバンドルインターフェイスの単純名が続きます。
名前はアンダースコアで区切られます。</p>
</div>
<div class="paragraph">
<p>例えば、以下のメッセージバンドルの名前は、デフォルトで <code>Controller_index</code> になります:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class Controller {

    @MessageBundle
    interface index {

        @Message("Hello {name}!")
        String hello(String name); <i class="conum" data-value="1"></i><b>(1)</b>
   }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>このメッセージは、 <code>{Controller_index:hello(name)}</code> を介してテンプレートで使用することができます。</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
バンドル名は、ローカライズされたファイル名の一部としても使用されます。例えば、 <code>Controller_index</code> は、 <code>Controller_index_de.properties</code> となります。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="bundle-name-and-message-keys"><a class="anchor" href="#bundle-name-and-message-keys"></a>4.14.3. バンドル名とメッセージキー</h4>
<div class="paragraph">
<p>メッセージキーはテンプレート内で直接使用されます。
バンドル名はテンプレート式の名前空間として使用されます。
<code>@MessageBundle</code> は、メソッド名からメッセージキーを生成するために使用するデフォルトストラテジーを定義するために使用できます。
ただし、 <code>@Message</code> はこのストラテジーをオーバーライドし、カスタムキーを定義することもできます。
デフォルトでは、アノテーションされた要素の名前がそのまま使用されます。
他の可能性としては、以下のようなものがあります。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>キャメルケースを止め、ハイフン化したもの。 例: <code>helloName()</code> &#8594; <code>hello-name</code></p>
</li>
<li>
<p>キャメルケースを止め、パーツをアンダースコア区切りとしたもの。例: <code>helloName()</code> &#8594; <code>hello_name</code></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="validation"><a class="anchor" href="#validation"></a>4.14.4. バリデーション</h4>
<div class="ulist">
<ul>
<li>
<p>すべてのメッセージバンドルテンプレートは検証されます。</p>
<div class="ulist">
<ul>
<li>
<p>名前空間を持たない全ての式はパラメーターにマッピングする必要があります。例: <code>Hello {foo}</code> の場合、メソッドは <code>foo</code> という名前のパラメータを持つ必要があります。</p>
</li>
<li>
<p>すべての式はパラメーターの型に対して検証されます。例: <code>Hello {foo.bar}</code> で、パラメーター <code>foo</code> の型が <code>org.acme.Foo</code> の場合、 <code>org.acme.Foo</code> は <code>bar</code> という名前のプロパティーを持つ必要があります。</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<em>未使用の</em> パラメーターごとに警告メッセージが記録されます。
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><code>{msg:hello(item.name)}</code> のようなメッセージバンドルメソッドを参照する式も検証されます。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="localization"><a class="anchor" href="#localization"></a>4.14.5. ローカライゼーション</h4>
<div class="paragraph">
<p>デフォルトでは、 <code>@MessageBundle</code> インターフェイスには <code>quarkus.default-locale</code> 設定プロパティーで指定したデフォルトロケールが使用されます。しかし、 <code>io.quarkus.qute.i18n.MessageBundle#locale()</code> を使用して、カスタムのロケールを指定することができます。さらに、ローカライズされたバンドルを定義するには、以下の 2 つの方法があります。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>@Localized</code> でアノテーションされたデフォルトのインターフェイスを拡張するインターフェイスを作成します。</p>
</li>
<li>
<p>アプリケーションアーカイブの <code>src/main/resources/messages</code> ディレクトリーにある UTF-8 エンコードファイルを作成します (例: <code>msg_de.properties</code>)。</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
ローカライズされたインターフェイスはリファクタリングを容易にしますが、外部ファイルの方が便利な場面も多いかもしれません。
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">ローカライズされたインターフェースの例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.quarkus.qute.i18n.Localized;
import io.quarkus.qute.i18n.Message;

@Localized("de") <i class="conum" data-value="1"></i><b>(1)</b>
public interface GermanAppMessages extends AppMessages {

    @Override
    @Message("Hallo {name}!") <i class="conum" data-value="2"></i><b>(2)</b>
    String hello_name(String name);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>値はロケールタグ文字列(IETF)です。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>値はローカライズされたテンプレートです。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>メッセージバンドルファイルは <em>UTF-8</em> でエンコードされていなければなりません。
ファイル名は、関連するバンドル名 (例: <code>msg</code>) とアンダースコアで構成され、その後に言語タグ (IETF、たとえば <code>en-US</code>) が続きます。
言語タグは省略できます。その場合、デフォルトのバンドルロケールの言語タグが使用されます。
たとえば、バンドル <code>msg</code> のデフォルトロケールが <code>en</code> の場合、 <code>msg.properties</code> は <code>msg_en.properties</code> として扱われます。
<code>msg.properties</code> と <code>msg_en.properties</code> の両方が検出されると、例外がスローされ、ビルドは失敗します。
ファイル形式は非常にシンプルで、各行はキーと値のペア (等号を区切り文字として使用) またはコメント (行頭は <code>#</code>) を表します。
空行は無視されます。
キーは、対応するメッセージバンドルインターフェースから <em>メソッド名にマッピング</em> されます。
値は、通常 <code>io.quarkus.qute.i18n.Message#value()</code> で定義されるテンプレートを表します。
値は、隣接する複数の通常行をまたぐことがあります。
その場合、行の終端をバックスラッシュ文字 <code>\</code> でエスケープする必要があります。
動作は <code>java.util.Properties.load(Reader)</code> メソッドの動作によく似ています。</p>
</div>
<div class="listingblock">
<div class="title">ローカライズされたファイルの例 - <code>msg_de.properties</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"># This comment is ignored
hello_name=Hallo {name}! <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>ローカライズされたファイルの各行は、キーと値のペアを表します。キーは、メッセージバンドルインターフェイスで宣言されたメソッドに対応しなければなりません。値はメッセージテンプレートになります。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>キーと値は等号で区切られています。</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
この例では <code>.properties</code> という接尾辞を使用していますが、これはほとんどの IDE やテキストエディターが <code>.properties</code> ファイルのシンタックスハイライトをサポートしているからです。しかし、実際には接尾辞は何でもよいため、単に無視されます。
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
メッセージバンドルインターフェイスごとに、ターゲットディレクトリーにサンプルのプロパティーファイルが自動的に生成されます。たとえば、デフォルトで <code>@MessageBundle</code> に名前が指定されない場合、 <code>mvn clean package</code> を用いてアプリケーションをビルドすると、 <code>target/qute-i18n-examples/msg.properties</code> というファイルが生成されます。このファイルは、特定のロケールのベースとして使用することができます。単にファイル名を変更 (例: <code>msg_fr.properties</code>) して メッセージのテンプレートを変更し、これを <code>src/main/resources/messages</code> ディレクトリーに移動します。
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">複数の隣接する行にまたがる値</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">hello=Hello \
   {name} and \
   good morning!</code></pre>
</div>
</div>
<div class="paragraph">
<p>行の終端はバックスラッシュ文字 <code>\</code> でエスケープされ、次の行の先頭の空白は無視されることに注意してください。つまり、 <code>{msg:hello('Edgar')}</code> は <code>Hello Edgar and good morning!</code> とレンダリングされます。</p>
</div>
<div class="paragraph">
<p>ローカライズされたバンドルを定義した後、特定のテンプレートインスタンスに対して正しいバンドルを <em>選択</em> する方法、つまりテンプレート内のすべてのメッセージバンドル式に対してロケールを指定する方法が必要です。
デフォルトでは、 <code>quarkus.default-locale</code> 設定プロパティーで指定したロケールが、バンドルの選択に使用されます。
また、テンプレートインスタンスの <code>locale</code> 属性を指定することもできます。</p>
</div>
<div class="listingblock">
<div class="title"><code>locale</code> 属性の例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
public class MyBean {

    @Inject
    Template hello;

    String render() {
       return hello.instance().setLocale("cs").render(); <i class="conum" data-value="1"></i><b>(1)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Locale</code> インスタンスかロケールタグ文字列 (IETF) をセットすることが出来ます。</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<a href="#rest_integration"><code>quarkus-rest-qute</code></a> を使用する場合にユーザーが <code>locale</code> 属性を設定していなければ、それは <code>Accept-Language</code> ヘッダーから導出されます。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>@Localized</code> 修飾子を使用して、ローカライズされたMessage Bundleインタフェースを注入することができます。</p>
</div>
<div class="listingblock">
<div class="title">注入されたローカライズされた Message Bundle例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
public class MyBean {

    @Localized("cs") <i class="conum" data-value="1"></i><b>(1)</b>
    AppMessages msg;

    String render() {
       return msg.hello_name("Jachym");
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>アノテーションの値はロケールタグ文字列(IETF)です。</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="enums"><a class="anchor" href="#enums"></a>4.14.5.1. 列挙</h5>
<div class="paragraph">
<p>列挙は、便利な方法でローカライズできます。
列挙型の単一のパラメーターを受け入れ、メッセージテンプレートが未定義のメッセージバンドルメソッドがある場合:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Message <i class="conum" data-value="1"></i><b>(1)</b>
String methodName(MyEnum enum);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>値は意図的に提供されていません。また、ローカライズされたファイルにはこのメソッドのキー/値のペアはありません。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>次に、以下のような生成されたテンプレートを受け取ります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{#when enumParamName}
  {#is CONSTANT1}{msg:methodName_CONSTANT1}
  {#is CONSTANT2}{msg:methodName_CONSTANT2}
{/when}</code></pre>
</div>
</div>
<div class="paragraph">
<p>さらに、各列挙定数に対して特別なメッセージメソッドが生成されます。
最後に、ローカライズされた各ファイルには、すべての定数メッセージキーのキーと値が含まれている必要があります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-poperties hljs" data-lang="poperties">methodName_CONSTANT1=Value 1
methodName_CONSTANT2=Value 2</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">列挙定数のメッセージキー</div>
<div class="paragraph">
<p>デフォルトでは、メッセージキーにはメソッド名、その後に <code>_</code> 区切り文字、定数名を使用して構成されます。
特定の列挙型の定数名に <code>_</code> または <code>$</code> 文字が含まれている場合、この列挙型のすべてのメッセージキーには代わりに <code>_$</code> 区切り文字を使用する必要があります。
たとえば、 <code>methodName_$CONSTANT_1 =Value 1</code> または <code>methodName_$CONSTANT$1 =Value 1</code> などです。
ローカライズされた列挙型の定数には、 <code>_$</code> 区切り文字を含めることはできません。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>テンプレートでは、列挙定数のローカライズされたメッセージは、 <code>{msg:methodName(enumConstant)}</code> のようなメッセージバンドルメソッドで取得できます。。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<a href="#convenient-annotation-for-enums"><code>@TemplateEnum</code></a> もあります。これは、テンプレート内の列挙定数にアクセスするために使用できるアノテーションです。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="message-templates"><a class="anchor" href="#message-templates"></a>4.14.6. メッセージテンプレート</h4>
<div class="paragraph">
<p>メッセージバンドルインターフェースのすべてのメソッドは、メッセージテンプレートを定義する必要があります。
通常、値は <code>io.quarkus.qute.i18n.Message#value()</code> によって定義されますが、利便性のために、ローカライズされたファイル内で値を定義するオプションもあります。
メッセージテンプレートはビルド時に検証されます。
テンプレートが欠落していると検出された場合、例外が出力され、ビルドが失敗します。</p>
</div>
<div class="listingblock">
<div class="title">値のない Message Bundle Interface の例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.quarkus.qute.i18n.Message;
import io.quarkus.qute.i18n.MessageBundle;

@MessageBundle
public interface AppMessages {

    @Message <i class="conum" data-value="1"></i><b>(1)</b>
    String hello_name(String name);

    @Message("Goodbye {name}!") <i class="conum" data-value="2"></i><b>(2)</b>
    String goodbye(String name);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>アノテーションの値が定義されていない。この場合、ローカライズされた補足ファイルの値が使用される。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>アノテーションの値は、ローカライズされたファイルに定義された値を優先して定義される。</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">ローカライズされた補足ファイル</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">hello_name=Hello \
   {name} and \
   good morning!
goodbye=Best regards, {name} <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>io.quarkus.qute.i18n.Message#value()</code> は常に優先されるため、この値は無視されます。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>デフォルトのメッセージテンプレート</em> を定義することも可能です。
デフォルトのテンプレートは、<code>Message#value()</code> が指定されておらず、ローカライズされたファイルにも該当するメッセージテンプレートが定義されていない場合にのみ使用されます。</p>
</div>
<div class="listingblock">
<div class="title">デフォルト値があるメッセージバンドルインターフェイスの例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.quarkus.qute.i18n.Message;
import io.quarkus.qute.i18n.MessageBundle;

@MessageBundle
public interface AppMessages {

    @Message(defaultValue = "Goodbye {name}!") <i class="conum" data-value="1"></i><b>(1)</b>
    String goodbye(String name);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>アノテーション値は、ローカライズされたファイルにメッセージテンプレートが定義されていない場合にのみ使用されます。</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration-reference"><a class="anchor" href="#configuration-reference"></a>4.15. 設定リファレンス</h3>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="ビルド時に固定"></i></span>ビルド時に固定される設定プロパティ - 他のすべての設定プロパティは実行時にオーバーライド可能 <input type="search" id="config-search-0" placeholder="FILTER CONFIGURATION" disabled></p>
</div>
<table class="tableblock frame-all grid-all stretch configuration-reference searchable configuration-reference-all-rows">
<colgroup>
<col style="width: 80%;">
<col style="width: 10%;">
<col style="width: 10%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><span class="header-title">Configuration property</span></p></th>
<th class="tableblock halign-left valign-middle"><p class="tableblock">型</p></th>
<th class="tableblock halign-left valign-middle"><p class="tableblock">デフォルト</p></th>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-qute_quarkus-qute-suffixes"></a> <span class="property-path"><a href="#quarkus-qute_quarkus-qute-suffixes"><code>quarkus.qute.suffixes</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.qute.suffixes' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-1" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>The list of suffixes used when attempting to locate a template file.</p>
</div>
<div class="paragraph">
<p>By default, <code>engine.getTemplate("foo")</code> would result in several lookups: <code>foo</code>, <code>foo.html</code>, <code>foo.txt</code>, etc.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-72894">QUARKUS_QUTE_SUFFIXES</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-72894" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">list of string</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>qute.html</code>, <code>qute.txt</code>, <code>html</code>, <code>txt</code></p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-qute_quarkus-qute-content-types-file-suffix"></a> <span class="property-path"><a href="#quarkus-qute_quarkus-qute-content-types-file-suffix"><code>quarkus.qute.content-types."file-suffix"</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.qute.content-types."file-suffix"' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-2" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>The additional map of suffixes to content types. This map is used when working with template variants. By default, the <code>java.net.URLConnection#getFileNameMap()</code> is used to determine the content type of a template file.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-72895">QUARKUS_QUTE_CONTENT_TYPES__FILE_SUFFIX_</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-72895" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Map&lt;String,String&gt;</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-qute_quarkus-qute-type-check-excludes"></a> <span class="property-path"><a href="#quarkus-qute_quarkus-qute-type-check-excludes"><code>quarkus.qute.type-check-excludes</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.qute.type-check-excludes' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-3" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>The list of exclude rules used to intentionally ignore some parts of an expression when performing type-safe validation.</p>
</div>
<div class="paragraph">
<p>An element value must have at least two parts separated by dot. The last part is used to match the property/method name. The prepended parts are used to match the class name. The value <code>*</code> can be used to match any name.</p>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.acme.Foo.name</code> - exclude the property/method <code>name</code> on the <code>org.acme.Foo</code> class</p>
</li>
<li>
<p><code>org.acme.Foo.*</code> - exclude any property/method on the <code>org.acme.Foo</code> class</p>
</li>
<li>
<p><code>*.age</code> - exclude the property/method <code>age</code> on any class</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-72896">QUARKUS_QUTE_TYPE_CHECK_EXCLUDES</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-72896" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">list of string</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-qute_quarkus-qute-template-path-exclude"></a> <span class="property-path"><a href="#quarkus-qute_quarkus-qute-template-path-exclude"><code>quarkus.qute.template-path-exclude</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.qute.template-path-exclude' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-4" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>This regular expression is used to exclude template files found in template roots. Excluded templates are neither parsed nor validated during build and are not available at runtime.</p>
</div>
<div class="paragraph">
<p>The matched input is the file path relative from the root directory and the <code>/</code> is used as a path separator.</p>
</div>
<div class="paragraph">
<p>By default, the hidden files are excluded. The name of a hidden file starts with a dot.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-72897">QUARKUS_QUTE_TEMPLATE_PATH_EXCLUDE</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-72897" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/regex/Pattern.html">Pattern</a></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>^\..*|.*\/\..*$</code></p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-qute_quarkus-qute-iteration-metadata-prefix"></a> <span class="property-path"><a href="#quarkus-qute_quarkus-qute-iteration-metadata-prefix"><code>quarkus.qute.iteration-metadata-prefix</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.qute.iteration-metadata-prefix' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-5" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>The prefix is used to access the iteration metadata inside a loop section.</p>
</div>
<div class="paragraph">
<p>A valid prefix consists of alphanumeric characters and underscores. Three special constants can be used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;alias_&gt;</code> - the alias of an iterated element suffixed with an underscore is used, e.g. <code>item_hasNext</code> and <code>it_count</code></p>
</li>
<li>
<p><code>&lt;alias?&gt;</code> - the alias of an iterated element suffixed with a question mark is used, e.g. <code>item?hasNext</code> and <code>it?count</code></p>
</li>
<li>
<p><code>&lt;none&gt;</code> - no prefix is used, e.g. <code>hasNext</code> and <code>count</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, the <code>&lt;alias_&gt;</code> constant is set.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-72898">QUARKUS_QUTE_ITERATION_METADATA_PREFIX</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-72898" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code><alias_></code></p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-qute_quarkus-qute-escape-content-types"></a> <span class="property-path"><a href="#quarkus-qute_quarkus-qute-escape-content-types"><code>quarkus.qute.escape-content-types</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.qute.escape-content-types' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-6" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>The list of content types for which the <code>'</code>, <code>"</code>, <code>&lt;</code>, <code>&gt;</code> and <code>&amp;</code> characters are escaped if a template variant is set.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-72899">QUARKUS_QUTE_ESCAPE_CONTENT_TYPES</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-72899" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">list of string</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>text/html</code>, <code>text/xml</code>, <code>application/xml</code>, <code>application/xhtml+xml</code></p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-qute_quarkus-qute-default-charset"></a> <span class="property-path"><a href="#quarkus-qute_quarkus-qute-default-charset"><code>quarkus.qute.default-charset</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.qute.default-charset' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-7" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>The default charset of the templates files.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-72900">QUARKUS_QUTE_DEFAULT_CHARSET</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-72900" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/nio/charset/Charset.html">Charset</a></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>UTF-8</code></p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-qute_quarkus-qute-duplicit-templates-strategy"></a> <span class="property-path"><a href="#quarkus-qute_quarkus-qute-duplicit-templates-strategy"><code>quarkus.qute.duplicit-templates-strategy</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.qute.duplicit-templates-strategy' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-8" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>The strategy used when multiple templates with the same path are found in the application.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-72901">QUARKUS_QUTE_DUPLICIT_TEMPLATES_STRATEGY</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-72901" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p><span class="asciidoc-tooltip-wrapper"><code>prioritize</code><span class="asciidoc-tooltip">If multiple templates with the same path are found then determine the highest priority value and eliminate all templates with lowest priority. If there is exactly one template remaining then use this template. Otherwise, fail the build.  Templates from the root application archive have the priority <code>30</code>. Templates from other application archives have the priority <code>10</code>. Templates from build items can define any priority.</span></span>, <span class="asciidoc-tooltip-wrapper"><code>fail</code><span class="asciidoc-tooltip">Fail the build if multiple templates with the same path are found.</span></span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="asciidoc-tooltip-wrapper"><code>prioritize</code><span class="asciidoc-tooltip">If multiple templates with the same path are found then determine the highest priority value and eliminate all templates with lowest priority. If there is exactly one template remaining then use this template. Otherwise, fail the build.  Templates from the root application archive have the priority {@code 30}. Templates from other application archives have the priority {@code 10}. Templates from build items can define any priority.</span></span></p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-qute_quarkus-qute-dev-mode-no-restart-templates"></a> <span class="property-path"><a href="#quarkus-qute_quarkus-qute-dev-mode-no-restart-templates"><code>quarkus.qute.dev-mode.no-restart-templates</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.qute.dev-mode.no-restart-templates' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-9" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>By default, a template modification results in an application restart that triggers build-time validations.</p>
</div>
<div class="paragraph">
<p>This regular expression can be used to specify the templates for which the application is not restarted. I.e. the templates are reloaded and only runtime validations are performed.</p>
</div>
<div class="paragraph">
<p>The matched input is the template path that starts with a template root, and the <code>/</code> is used as a path separator. For example, <code>templates/foo.html</code>.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-72902">QUARKUS_QUTE_DEV_MODE_NO_RESTART_TEMPLATES</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-72902" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/regex/Pattern.html">Pattern</a></p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-qute_quarkus-qute-test-mode-record-rendered-results"></a> <span class="property-path"><a href="#quarkus-qute_quarkus-qute-test-mode-record-rendered-results"><code>quarkus.qute.test-mode.record-rendered-results</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.qute.test-mode.record-rendered-results' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-10" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>By default, the rendering results of injected and type-safe templates are recorded in the managed <code>RenderedResults</code> which is registered as a CDI bean.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-72903">QUARKUS_QUTE_TEST_MODE_RECORD_RENDERED_RESULTS</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-72903" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-qute_quarkus-qute-debug-enabled"></a> <span class="property-path"><a href="#quarkus-qute_quarkus-qute-debug-enabled"><code>quarkus.qute.debug.enabled</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.qute.debug.enabled' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-11" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>Enables or disables the Qute debug mode. This feature is experimental.</p>
</div>
<div class="paragraph">
<p>When enabled, Qute templates can be debugged directly at runtime. This includes the ability to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set breakpoints inside templates</p>
</li>
<li>
<p>Inspect the stack trace of visited template nodes during rendering</p>
</li>
<li>
<p>Evaluate expressions in the current Qute context</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This mode is intended for development and troubleshooting purposes.</p>
</div>
<div class="paragraph">
<p><strong>Default value:</strong> <code>true</code></p>
</div>
<div class="paragraph">
<p>Example configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">quarkus.qute.debug.enabled = false</code></pre>
</div>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-72904">QUARKUS_QUTE_DEBUG_ENABLED</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-72904" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-qute_quarkus-qute-property-not-found-strategy"></a> <span class="property-path"><a href="#quarkus-qute_quarkus-qute-property-not-found-strategy"><code>quarkus.qute.property-not-found-strategy</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.qute.property-not-found-strategy' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-12" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>The strategy used when a standalone expression evaluates to a "not found" value at runtime and the <code>quarkus.qute.strict-rendering</code> config property is set to <code>false</code></p>
</div>
<div class="paragraph">
<p>This strategy is never used when evaluating section parameters, e.g. <code>{#if foo.name}</code>. In such case, it&#8217;s the responsibility of the section to handle this situation appropriately.</p>
</div>
<div class="paragraph">
<p>By default, the <code>NOT_FOUND</code> constant is written to the output. However, in the development mode the <code>PropertyNotFoundStrategy#THROW_EXCEPTION</code> is used by default, i.e. when the strategy is not specified.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-72905">QUARKUS_QUTE_PROPERTY_NOT_FOUND_STRATEGY</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-72905" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p><span class="asciidoc-tooltip-wrapper"><code>default</code><span class="asciidoc-tooltip">Output the <code>NOT_FOUND</code> constant.</span></span>, <span class="asciidoc-tooltip-wrapper"><code>noop</code><span class="asciidoc-tooltip">No operation - no output.</span></span>, <span class="asciidoc-tooltip-wrapper"><code>throw-exception</code><span class="asciidoc-tooltip">Throw a <code>TemplateException</code>.</span></span>, <span class="asciidoc-tooltip-wrapper"><code>output-original</code><span class="asciidoc-tooltip">Output the original expression string, e.g. <code>{foo.name}</code>.</span></span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-qute_quarkus-qute-remove-standalone-lines"></a> <span class="property-path"><a href="#quarkus-qute_quarkus-qute-remove-standalone-lines"><code>quarkus.qute.remove-standalone-lines</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.qute.remove-standalone-lines' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-13" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>Specify whether the parser should remove standalone lines from the output. A standalone line is a line that contains at least one section tag, parameter declaration, or comment but no expression and no non-whitespace character.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-72906">QUARKUS_QUTE_REMOVE_STANDALONE_LINES</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-72906" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-qute_quarkus-qute-strict-rendering"></a> <span class="property-path"><a href="#quarkus-qute_quarkus-qute-strict-rendering"><code>quarkus.qute.strict-rendering</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.qute.strict-rendering' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-14" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>If set to <code>true</code> then any expression that is evaluated to a <code>Results.NotFound</code> value will always result in a <code>TemplateException</code> and the rendering is aborted.</p>
</div>
<div class="paragraph">
<p>Note that the <code>quarkus.qute.property-not-found-strategy</code> config property is completely ignored if strict rendering is enabled.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-72907">QUARKUS_QUTE_STRICT_RENDERING</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-72907" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-qute_quarkus-qute-timeout"></a> <span class="property-path"><a href="#quarkus-qute_quarkus-qute-timeout"><code>quarkus.qute.timeout</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.qute.timeout' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-15" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>The global rendering timeout in milliseconds. It is used if no <code>timeout</code> template instance attribute is set.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-72908">QUARKUS_QUTE_TIMEOUT</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-72908" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">長</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>10000</code></p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-qute_quarkus-qute-use-async-timeout"></a> <span class="property-path"><a href="#quarkus-qute_quarkus-qute-use-async-timeout"><code>quarkus.qute.use-async-timeout</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.qute.use-async-timeout' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-16" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>If set to <code>true</code> then the timeout should also be used for asynchronous rendering methods, such as <code>TemplateInstance#createUni()</code> and <code>TemplateInstance#renderAsync()</code>.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-72909">QUARKUS_QUTE_USE_ASYNC_TIMEOUT</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-72909" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>true</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="standalone"><a class="anchor" href="#standalone"></a>5. スタンドアローンライブラリーとして使用する場合のQute</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quteは、主にQuarkusのエクステンションとして設計されています。しかし、「スタンドアロン」のライブラリとして使用することも可能です。この場合、いくつかの機能は利用できず、いくつかの追加設定が必要となります。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">エンジン</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>まず第一に、すぐに使用できるマネージド <code>Engine</code> インスタンスはありません。新しいインスタンスを <code>Engine.builder()</code> で設定する必要があります。</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">テンプレートロケーター</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>デフォルトでは、<a href="#template-locator">テンプレートロケーター</a> は登録されていません。つまり、 <code>Engine.getTemplate(String)</code> は機能しません。</p>
</li>
<li>
<p>カスタムテンプレートロケーターは <code>EngineBuilder.addLocator()</code> を使って登録するか、テンプレートを手動で解析して、 <code>Engine.putTemplate(String, Template)</code> で結果をキャッシュに格納することができます。</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">テンプレートイニシャライザー</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>デフォルトで <code>TemplateInstance.Initializer</code> は登録されていないため、<a href="#global_variables"><code>@TemplateGlobal</code></a> アノテーションは無視されます。</p>
</li>
<li>
<p>カスタム <code>TemplateInstance.Initializer</code> は、 <code>EngineBuilder#addTemplateInstanceInitializer()</code> を使用して登録でき、任意のデータと属性を使用してテンプレートインスタンスを初期化できます。</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">セクション</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>デフォルトでは、セクションヘルパーは登録されていません。</p>
</li>
<li>
<p>デフォルトの値リゾルバーのセットは、便利な <code>EngineBuilder.addDefaultSectionHelpers()</code> メソッドと <code>EngineBuilder.addDefaults()</code> メソッドを介して、それぞれ登録することができます。</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">値リゾルバー</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#value-resolvers"><code>ValueResolver</code>s</a> は自動的に生成されません。</p>
<div class="ulist">
<ul>
<li>
<p><a href="#template_extension_methods"><code>@TemplateExtension</code> メソッド</a> は動作しません。</p>
</li>
<li>
<p><a href="#template_data"><code>@TemplateData</code></a> と <a href="#convenient-annotation-for-enums"><code>@TemplateEnum</code></a> のアノテーションは無視されます。</p>
</li>
</ul>
</div>
</li>
<li>
<p>デフォルトの値リゾルバーのセットは、便利な <code>EngineBuilder.addDefaultValueResolvers()</code> メソッドと <code>EngineBuilder.addDefaults()</code> メソッドを介して、それぞれ登録することができます。</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
組み込みの拡張メソッドによって提供されるすべての機能が、デフォルトの値リゾルバーによってカバーされているわけではありません。ただし、カスタムの値リゾルバーは <code>ValueResolver.builder()</code> を使って簡単に構築することができます。
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Qute がオブジェクトのプロパティーにアクセスし、パブリックメソッドを呼び出せるように、 <code>Engine.addValueResolver (new ReflectionValueResolver())</code> を介して <code>ReflectionValueResolver</code> インスタンスを登録することが推奨されます。</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
リフレクションは、一部の制限された環境では正しく動作しないか、GraalVM ネイティブイメージの場合の登録など、追加の設定が必要な場合があることに留意してください。
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">ユーザー定義タグ</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>ユーザー定義のタグは自動的に登録されません。</p>
</li>
<li>
<p>タグは、 <code>Engine.builder().addSectionHelper(new UserTagSectionHelper.Factory("tagName","tagTemplate.html")).build()</code> を介して手動で登録することができます。</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">タイプセーフ</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#typesafe_expressions">typeafe_expressions</a> は検証されません。</p>
</li>
<li>
<p><a href="#type-safe-message-bundles">Type-safeメッセージバンドル</a>はサポートされていません。</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">インジェクション</dt>
<dd>
<p><code>Template</code> インスタンスを注入することはできませんし、その逆もできません。テンプレートは、 <code>inject:</code> および <code>cdi:</code> の名前空間を介して <code>@Named</code> CDI Bean を注入することはできません。</p>
</dd>
</dl>
</div>
</div>
</div>
    </div>
    <div class="grid__item width-4-12 width-12-12-m tocwrapper">
      <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#the_simplest_example">1. 最も簡単な例</a></li>
<li><a href="#hello_world_example">2. ハローワールドの例</a></li>
<li><a href="#core_features">3. コア機能</a>
<ul class="sectlevel2">
<li><a href="#basic-building-blocks">3.1. 基本的なビルディングブロック</a></li>
<li><a href="#identifiers">3.2. 識別子とタグ</a></li>
<li><a href="#removing-standalone-lines-from-the-template">3.3. テンプレートから独立した行を削除する</a></li>
<li><a href="#expressions">3.4. 式</a>
<ul class="sectlevel3">
<li><a href="#literals">3.4.1. サポートされているリテラル</a></li>
<li><a href="#expression_resolution">3.4.2. 解決</a></li>
<li><a href="#current_context_object">3.4.3. カレントコンテキスト</a></li>
<li><a href="#built-in-resolvers">3.4.4. 組込Resolver</a></li>
<li><a href="#arrays">3.4.5. 配列</a></li>
<li><a href="#character-escapes">3.4.6. 文字エスケープ</a></li>
<li><a href="#virtual_methods">3.4.7. 仮想メソッド</a></li>
<li><a href="#evaluation-of-completionstage-and-uni-objects">3.4.8. <code>CompletionStage</code> と <code>Uni</code> オブジェクトの評価</a></li>
<li><a href="#missing-properties">3.4.9. 不明なプロパティ</a></li>
</ul>
</li>
<li><a href="#sections">3.5. セクション</a>
<ul class="sectlevel3">
<li><a href="#sections_params">3.5.1. パラメーター</a></li>
<li><a href="#loop_section">3.5.2. ループセクション</a></li>
<li><a href="#if_section">3.5.3. If セクション</a></li>
<li><a href="#when_section">3.5.4. When セクション</a></li>
<li><a href="#let_section">3.5.5. Let セクション</a></li>
<li><a href="#with_section">3.5.6. With セクション</a></li>
<li><a href="#include_helper">3.5.7. Include セクション</a></li>
<li><a href="#user_tags">3.5.8. ユーザー定義タグ</a></li>
<li><a href="#fragments">3.5.9. フラグメント</a></li>
<li><a href="#eval-section">3.5.10. Eval セクション</a></li>
<li><a href="#cached-section">3.5.11. キャッシュされたセクション</a></li>
</ul>
</li>
<li><a href="#rendering-output">3.6. レンダリング出力</a></li>
<li><a href="#engine-configuration">3.7. エンジン設定</a>
<ul class="sectlevel3">
<li><a href="#value-resolvers">3.7.1. 値リゾルバ</a></li>
<li><a href="#template-locator">3.7.2. テンプレートロケーター</a></li>
<li><a href="#content-filters">3.7.3. コンテンツフィルタ</a></li>
<li><a href="#strict_rendering">3.7.4. strict レンダリング</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#quarkus_integration">4. Quarkus 統合</a>
<ul class="sectlevel2">
<li><a href="#engine-customization">4.1. エンジンのカスタマイズ</a>
<ul class="sectlevel3">
<li><a href="#template-locator-registration">4.1.1. テンプレートロケーターの登録</a></li>
</ul>
</li>
<li><a href="#template-variants">4.2. テンプレートバリアント</a></li>
<li><a href="#injecting-beans-directly-in-templates">4.3. テンプレートに直接Beansを注入</a></li>
<li><a href="#typesafe_expressions">4.4. 型安全な式</a></li>
<li><a href="#typesafe_templates">4.5. タイプセーフテンプレート</a>
<ul class="sectlevel3">
<li><a href="#nested-type-safe-templates">4.5.1. ネストされたタイプセーフなテンプレート</a></li>
<li><a href="#top-level-type-safe-templates">4.5.2. トップレベルタイプセーフテンプレート</a></li>
<li><a href="#template-records">4.5.3. テンプレートレコード</a></li>
<li><a href="#customized-template-path">4.5.4. カスタマイズされたテンプレート・パス</a></li>
<li><a href="#type_safe_fragments">4.5.5. タイプセーフフラグメント</a></li>
<li><a href="#template_contents">4.5.6. テンプレートの内容</a></li>
</ul>
</li>
<li><a href="#template_extension_methods">4.6. テンプレート拡張メソッド</a>
<ul class="sectlevel3">
<li><a href="#matching-by-name">4.6.1. 名前によるマッチング</a></li>
<li><a href="#method-parameters">4.6.2. メソッドパラメーター</a></li>
<li><a href="#namespace_extension_methods">4.6.3. 名前空間拡張メソッド</a></li>
<li><a href="#built-in-template-extension">4.6.4. 組み込みテンプレートエクステンション</a></li>
</ul>
</li>
<li><a href="#template_data">4.7. @TemplateData</a>
<ul class="sectlevel3">
<li><a href="#accessing-static-fields-and-methods">4.7.1. 静的なフィールドとメソッドへのアクセス</a></li>
<li><a href="#convenient-annotation-for-enums">4.7.2. enum の便利なアノテーション</a></li>
</ul>
</li>
<li><a href="#global_variables">4.8. グローバル変数</a>
<ul class="sectlevel3">
<li><a href="#resolving-conflicts">4.8.1. 競合の解消</a></li>
</ul>
</li>
<li><a href="#native_executables">4.9. ネイティブ実行可能ファイル</a></li>
<li><a href="#rest_integration">4.10.  REST インテグレーション</a></li>
<li><a href="#vertx_integration">4.11. Vert.x インテグレーション</a></li>
<li><a href="#development-mode">4.12. 開発モード</a></li>
<li><a href="#testing">4.13. テスト</a></li>
<li><a href="#type-safe-message-bundles">4.14. タイプセーフメッセージバンドル</a>
<ul class="sectlevel3">
<li><a href="#basic-concepts">4.14.1. 基本概念</a></li>
<li><a href="#default-bundle-name">4.14.2. デフォルトのバンドル名</a></li>
<li><a href="#bundle-name-and-message-keys">4.14.3. バンドル名とメッセージキー</a></li>
<li><a href="#validation">4.14.4. バリデーション</a></li>
<li><a href="#localization">4.14.5. ローカライゼーション</a></li>
<li><a href="#message-templates">4.14.6. メッセージテンプレート</a></li>
</ul>
</li>
<li><a href="#configuration-reference">4.15. 設定リファレンス</a></li>
</ul>
</li>
<li><a href="#standalone">5. スタンドアローンライブラリーとして使用する場合のQute</a></li>
</ul></div>
    </div>
  </div>
  <h2>関連コンテンツ</h2>
  <div class="grid-wrapper relations">
    <div class="grid__item width-6-12 width-12-12-m">
      <h3>同じエクステンションについて</h3>
      <ul class="related-content">
      
        
        <li class="guide"><a href="/version/main/guides/qute">Qute テンプレートエンジン</a></li>
      </ul>
    </div>
    <div class="grid__item width-6-12 width-12-12-m">
      <h3>同じトピックについて</h3>
      <ul class="related-content">
      
        
        <li class="guide"><a href="/version/main/guides/qute">Qute テンプレートエンジン</a></li>
      
        
        <li class="guide"><a href="/version/main/guides/web">Web 向け Quarkus</a></li>
      </ul>
    </div>
    </div>
  </div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license. <i class='fab fa-creative-commons'></i><i class='fab fa-creative-commons-by'></i> <a href='https://creativecommons.org/licenses/by/3.0/' target='_blank'>CC by 3.0</a><br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>ナビゲーション</span>
        <ul class="footer-links">
          
          
            <li><a href="/" target="_blank">ホーム</a></li>
          
          
          
            <li><a href="/about" target="_blank">Quarkusについて</a></li>
          
          
          
            <li><a href="/blog" target="_blank">ブログ</a></li>
          
          
          
            <li><a href="/insights" target="_blank">ポッドキャスト</a></li>
          
          
          
            <li><a href="/events" target="_blank">イベント</a></li>
          
          
          
            <li><a href="/newsletter" target="_blank">ニュースレター</a></li>
          
          
          
            <li><a href="/userstories" target="_blank">ユーザーストーリー</a></li>
          
          
          
            <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" target="_blank">ロードマップ</a></li>
          
          
          
            <li><a href="/security" target="_blank">セキュリティ&nbsp;ポリシー</a></li>
          
          
          
            <li><a href="/usage" target="_blank">使用方法</a></li>
          
          
          
            <li><a href="/brand" target="_blank">Brand</a></li>
          
          
          
            <li><a href="/desktopwallpapers" target="_blank">Wallpapers</a></li>
          
          
          
            <li><a href="https://www.redhat.com/en/about/privacy-policy" target="_blank">Privacy Policy</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>フォローする</span>
        <ul class="footer-links">
          
          
            <li><a href="https://x.com/quarkusio" target="_blank">X</a></li>
          
          
          
            <li><a href="https://bsky.app/profile/quarkus.io" target="_blank">Bluesky</a></li>
          
          
          
            <li><a rel="me" href="https://fosstodon.org/@quarkusio" target="_blank">Mastodon</a></li>
            
          
          
            <li><a href="https://www.threads.com/@quarkusio" target="_blank">Threads</a></li>
          
          
          
            <li><a href="https://www.facebook.com/quarkusio" target="_blank">Facebook</a></li>
          
          
          
            <li><a href="https://www.linkedin.com/company/quarkusio/" target="_blank">Linkedin</a></li>
          
          
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg" target="_blank">Youtube</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio" target="_blank">GitHub</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>ヘルプ</span>
        <ul class="footer-links">
          
          
            <li><a href="/support" target="_blank">サポート</a></li>
          
          
          
            <li><a href="/guides" target="_blank">ガイド</a></li>
          
          
          
            <li><a href="/faq" target="_blank">FAQ</a></li>
          
          
          
            <li><a href="/get-started" target="_blank">入門</a></li>
          
          
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus" target="_blank">Stack Overflow</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions" target="_blank">ディスカッション</a></li>
          
          
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev" target="_blank">開発メーリングリスト</a></li>
          
          
          
            <li><a href="https://stats.uptimerobot.com/ze1PfweT2p" target="_blank">Quarkus Service Status</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>言語</span>
        <ul class="footer-links">
          
          
            <li><a href=" https://quarkus.io/ " target="_blank">English</a></li>
          
          
          
            <li><a href="https://pt.quarkus.io/" target="_blank">Português&nbsp;(Brasileiro)</a></li>
          
          
          
            <li><a href=" https://es.quarkus.io/ " target="_blank">Español</a></li>
          
          
          
            <li><a href="https://cn.quarkus.io/" target="_blank">简体中文</a></li>
          
          
          
            <li><a href=" https://ja.quarkus.io/ " target="_blank">日本語</a></li>
          
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkusはコミュニティプロジェクトで構成されています</span>
        <ul class="footer-links">
          
            <li><a blah href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a blah href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a blah href="https://hibernate.org" target="_blank">Hibernate ORM</a></li>
          
            <li><a blah href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a blah href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a blah href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a blah href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a blah href="https://code.quarkus.io/" target="_blank">その他多数...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content cf-footer">
  <div class="flexcontainer">
    <div class="cf-logo">
      <a class="cf-logo" href="https://www.commonhaus.org/" target="_blank"><img src="https://raw.githubusercontent.com/commonhaus/artwork/main/foundation/brand/svg/CF_logo_horizontal_single_reverse.svg"/></a>
    </div>
    <div class="license">
      Copyright © Quarkus. All rights reserved. For details on our trademarks, please visit our <a href="https://www.commonhaus.org/policies/trademark-policy/">Trademark Policy</a> and <a href="https://www.commonhaus.org/trademarks/">Trademark List</a>. Trademarks of third parties are owned by their respective holders and their mention here does not suggest any endorsement or association.
    </div>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
  <script src="/assets/javascript/future-date.js" type="text/javascript"></script>
  <script src="/assets/javascript/randomize.js" type="text/javascript"></script>
  <script src="/assets/javascript/time.js" type="text/javascript"></script>
</body>

</html>
