#!/usr/bin/env bash
set -eu

#
# This script machine translates untranslated messages and mark them `fuzzy`.
# `apply-tmx` script should be called beforehand because it can fill .po files with exactly matched messages loaded from tmx.
#

SCRIPT_DIR=$(cd $(dirname $0); pwd)
L10N_HOME=$(cd $(dirname $SCRIPT_DIR); pwd)
cd $L10N_HOME

export TARGET_LANG=`jq ".targetLang" config/l10n-kit.json -r`
export DEEPL_TARGET_LANG_CODE=`jq ".deepl.targetLangCode" config/l10n-kit.json -r`
export DEEPL_GLOSSARY_ID=`jq ".deepl.glossaryId" config/l10n-kit.json -r`

find l10n/po/$TARGET_LANG/_guides/    -name "*.adoc.po" | xargs java -jar vendor/doc-l10n-kit-runner.jar translate --srcLang=en --dstLang=$DEEPL_TARGET_LANG_CODE #--glossaryId=$DEEPL_GLOSSARY_ID

find l10n/po/$TARGET_LANG/_posts/     -name "*.adoc.po" | xargs java -jar vendor/doc-l10n-kit-runner.jar translate --srcLang=en --dstLang=$DEEPL_TARGET_LANG_CODE #--glossaryId=$DEEPL_GLOSSARY_ID

find l10n/po/$TARGET_LANG/_versions/  -name "*.adoc.po" | xargs java -jar vendor/doc-l10n-kit-runner.jar translate --srcLang=en --dstLang=$DEEPL_TARGET_LANG_CODE #--glossaryId=$DEEPL_GLOSSARY_ID
find l10n/po/$TARGET_LANG/_data/      -name "*.yaml.po" | xargs java -jar vendor/doc-l10n-kit-runner.jar translate --srcLang=en --dstLang=$DEEPL_TARGET_LANG_CODE #--glossaryId=$DEEPL_GLOSSARY_ID
find l10n/po/$TARGET_LANG/_includes/  -name "*.html.po" | xargs java -jar vendor/doc-l10n-kit-runner.jar translate --srcLang=en --dstLang=$DEEPL_TARGET_LANG_CODE #--glossaryId=$DEEPL_GLOSSARY_ID
find l10n/po/$TARGET_LANG/_layouts/  -name "*.html.po"  | xargs java -jar vendor/doc-l10n-kit-runner.jar translate --srcLang=en --dstLang=$DEEPL_TARGET_LANG_CODE #--glossaryId=$DEEPL_GLOSSARY_ID
find l10n/po/$TARGET_LANG/_redirects/ -name "*.md.po"   | xargs java -jar vendor/doc-l10n-kit-runner.jar translate --srcLang=en --dstLang=$DEEPL_TARGET_LANG_CODE #--glossaryId=$DEEPL_GLOSSARY_ID

bin/normalize
